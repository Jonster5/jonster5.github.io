(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const Ma=!1;var os=Array.isArray,Pu=Array.prototype.indexOf,as=Array.from,Ti=Object.defineProperty,Sn=Object.getOwnPropertyDescriptor,zu=Object.prototype,qu=Array.prototype,Bu=Object.getPrototypeOf,go=Object.isExtensible;function Ku(t){return typeof t?.then=="function"}function Da(t){for(var e=0;e<t.length;e++)t[e]()}function Fu(){var t,e,n=new Promise((r,i)=>{t=r,e=i});return{promise:n,resolve:t,reject:e}}const xe=2,La=4,Pa=8,rn=16,ht=32,Et=64,za=128,Re=256,xr=512,ce=1024,Ee=2048,ft=4096,Oe=8192,sn=16384,qa=32768,ls=65536,bo=1<<17,Uu=1<<18,Ln=1<<19,ju=1<<20,Ii=1<<21,cs=1<<22,yt=1<<23,ci=Symbol("$state"),us=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Hu(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Vu(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Ju(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Gu(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Wu(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Zu(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const Yu=1,Xu=2,Qu=16,eh=1,th=2,Y=Symbol(),nh="http://www.w3.org/1999/xhtml";let rh=!1;function Ba(t){return t===this.v}function ih(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Ka(t){return!ih(t,this.v)}let sh=!1,Ce=null;function Gt(t){Ce=t}function Pn(t,e=!1,n){Ce={p:Ce,c:null,e:null,s:t,x:null,l:null}}function zn(t){var e=Ce,n=e.e;if(n!==null){e.e=null;for(var r of n)Ah(r)}return Ce=e.p,{}}function Fa(){return!0}const oh=new WeakMap;function ah(t){var e=O;if(e===null)return M.f|=yt,t;if((e.f&qa)===0){if((e.f&za)===0)throw!e.parent&&t instanceof Error&&Ua(t),t;e.b.error(t)}else hs(t,e)}function hs(t,e){for(;e!==null;){if((e.f&za)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t instanceof Error&&Ua(t),t}function Ua(t){const e=oh.get(t);e&&(Ti(t,"message",{value:e.message}),Ti(t,"stack",{value:e.stack}))}let In=[],Ri=[];function ja(){var t=In;In=[],Da(t)}function lh(){var t=Ri;Ri=[],Da(t)}function ch(t){In.length===0&&queueMicrotask(ja),In.push(t)}function uh(){In.length>0&&ja(),Ri.length>0&&lh()}function hh(){for(var t=O.b;t!==null&&!t.has_pending_snippet();)t=t.parent;return t===null&&Hu(),t}function fs(t){var e=xe|Ee,n=M!==null&&(M.f&xe)!==0?M:null;return O===null||n!==null&&(n.f&Re)!==0?e|=Re:O.f|=Ln,{ctx:Ce,deps:null,effects:null,equals:Ba,f:e,fn:t,reactions:null,rv:0,v:Y,wv:0,parent:n??O,ac:null}}function fh(t,e){let n=O;n===null&&Vu();var r=n.b,i=void 0,s=$t(Y),o=null,a=!M;return Eh(()=>{try{var l=t();o&&Promise.resolve(l).catch(()=>{})}catch(m){l=Promise.reject(m)}var c=()=>l;i=o?.then(c,c)??Promise.resolve(l),o=i;var u=F,f=r.pending;a&&(r.update_pending_count(1),f||u.increment());const d=(m,p=void 0)=>{o=null,f||u.activate(),p?p!==us&&(s.f|=yt,vt(s,p)):((s.f&yt)!==0&&(s.f^=yt),vt(s,m)),a&&(r.update_pending_count(-1),f||u.decrement()),Ja()};if(i.then(d,m=>d(null,m||"unknown")),u)return()=>{queueMicrotask(()=>u.neuter())}}),new Promise(l=>{function c(u){function f(){u===i?l(s):c(i)}u.then(f,f)}c(i)})}function dh(t){const e=fs(t);return cl(e),e}function ph(t){const e=fs(t);return e.equals=Ka,e}function Ha(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Ye(e[n])}}function mh(t){for(var e=t.parent;e!==null;){if((e.f&xe)===0)return e;e=e.parent}return null}function ds(t){var e,n=O;Be(mh(t));try{Ha(t),e=dl(t)}finally{Be(n)}return e}function Va(t){var e=ds(t);if(t.equals(e)||(t.v=e,t.wv=hl()),!qn){var n=(lt||(t.f&Re)!==0)&&t.deps!==null?ft:ce;ke(t,n)}}function gh(t,e,n){const r=fs;if(e.length===0){n(t.map(r));return}var i=F,s=O,o=bh(),a=hh();Promise.all(e.map(l=>fh(l))).then(l=>{i?.activate(),o();try{n([...t.map(r),...l])}catch(c){(s.f&sn)===0&&hs(c,s)}i?.deactivate(),Ja()}).catch(l=>{a.error(l)})}function bh(){var t=O,e=M,n=Ce,r=F;return function(){Be(t),Ne(e),Gt(n),r?.activate()}}function Ja(){Be(null),Ne(null),Gt(null)}const ui=new Set;let F=null,pr=null,yo=new Set,wr=[];function Ga(){const t=wr.shift();wr.length>0&&queueMicrotask(Ga),t()}let wt=[],Lr=null,Oi=!1,mr=!1;class Wt{current=new Map;#l=new Map;#i=new Set;#e=0;#c=null;#u=!1;#n=[];#s=[];#r=[];#t=[];#o=[];#h=[];#f=[];skipped_effects=new Set;process(e){wt=[],pr=null;for(const i of e)this.#p(i);if(this.#n.length===0&&this.#e===0){this.#d();var n=this.#r,r=this.#t;this.#r=[],this.#t=[],this.#o=[],pr=F,F=null,vo(n),vo(r),F===null?F=this:ui.delete(this),this.#c?.resolve()}else this.#a(this.#r),this.#a(this.#t),this.#a(this.#o);for(const i of this.#n)Ht(i);for(const i of this.#s)Ht(i);this.#n=[],this.#s=[]}#p(e){e.f^=ce;for(var n=e.first;n!==null;){var r=n.f,i=(r&(ht|Et))!==0,s=i&&(r&ce)!==0,o=s||(r&Oe)!==0||this.skipped_effects.has(n);if(!o&&n.fn!==null){if(i)n.f^=ce;else if((r&La)!==0)this.#t.push(n);else if((r&ce)===0)if((r&cs)!==0){var a=n.b?.pending?this.#s:this.#n;a.push(n)}else zr(n)&&((n.f&rn)!==0&&this.#o.push(n),Ht(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)n=c.next,c=c.parent}}#a(e){for(const n of e)((n.f&Ee)!==0?this.#h:this.#f).push(n),ke(n,ce);e.length=0}capture(e,n){this.#l.has(e)||this.#l.set(e,n),this.current.set(e,e.v)}activate(){F=this}deactivate(){F=null,pr=null;for(const e of yo)if(yo.delete(e),e(),F!==null)break}neuter(){this.#u=!0}flush(){wt.length>0?Za():this.#d(),F===this&&(this.#e===0&&ui.delete(this),this.deactivate())}#d(){if(!this.#u)for(const e of this.#i)e();this.#i.clear()}increment(){this.#e+=1}decrement(){if(this.#e-=1,this.#e===0){for(const e of this.#h)ke(e,Ee),Zt(e);for(const e of this.#f)ke(e,ft),Zt(e);this.#r=[],this.#t=[],this.flush()}else this.deactivate()}add_callback(e){this.#i.add(e)}settled(){return(this.#c??=Fu()).promise}static ensure(){if(F===null){const e=F=new Wt;ui.add(F),mr||Wt.enqueue(()=>{F===e&&e.flush()})}return F}static enqueue(e){wr.length===0&&queueMicrotask(Ga),wr.unshift(e)}}function Wa(t){var e=mr;mr=!0;try{for(var n;;){if(uh(),wt.length===0&&(F?.flush(),wt.length===0))return Lr=null,n;Za()}}finally{mr=e}}function Za(){var t=jt;Oi=!0;try{var e=0;for(wo(!0);wt.length>0;){var n=Wt.ensure();if(e++>1e3){var r,i;yh()}n.process(wt),ut.clear()}}finally{Oi=!1,wo(t),Lr=null}}function yh(){try{Ju()}catch(t){hs(t,Lr)}}let gt=null;function vo(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(sn|Oe))===0&&zr(r)&&(gt=[],Ht(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?ol(r):r.fn=null),gt?.length>0)){ut.clear();for(const i of gt)Ht(i);gt=[]}}gt=null}}function Zt(t){for(var e=Lr=t;e.parent!==null;){e=e.parent;var n=e.f;if(Oi&&e===O&&(n&rn)!==0)return;if((n&(Et|ht))!==0){if((n&ce)===0)return;e.f^=ce}}wt.push(e)}const ut=new Map;function $t(t,e){var n={f:0,v:t,reactions:null,equals:Ba,rv:0,wv:0};return n}function Ae(t,e){const n=$t(t);return cl(n),n}function vh(t,e=!1,n=!0){const r=$t(t);return e||(r.equals=Ka),r}function ve(t,e,n=!1){M!==null&&(!ze||(M.f&bo)!==0)&&Fa()&&(M.f&(xe|rn|cs|bo))!==0&&!Ze?.includes(t)&&Zu();let r=n?$n(e):e;return vt(t,r)}function vt(t,e){if(!t.equals(e)){var n=t.v;qn?ut.set(t,e):ut.set(t,n),t.v=e;var r=Wt.ensure();r.capture(t,n),(t.f&xe)!==0&&((t.f&Ee)!==0&&ds(t),ke(t,(t.f&Re)===0?ce:ft)),t.wv=hl(),Ya(t,Ee),O!==null&&(O.f&ce)!==0&&(O.f&(ht|Et))===0&&(_e===null?Ih([t]):_e.push(t))}return e}function hi(t){ve(t,t.v+1)}function Ya(t,e){var n=t.reactions;if(n!==null)for(var r=n.length,i=0;i<r;i++){var s=n[i],o=s.f,a=(o&Ee)===0;a&&ke(s,e),(o&xe)!==0?Ya(s,ft):a&&((o&rn)!==0&&gt!==null&&gt.push(s),Zt(s))}}function $n(t){if(typeof t!="object"||t===null||ci in t)return t;const e=Bu(t);if(e!==zu&&e!==qu)return t;var n=new Map,r=os(t),i=Ae(0),s=kt,o=a=>{if(kt===s)return a();var l=M,c=kt;Ne(null),_o(s);var u=a();return Ne(l),_o(c),u};return r&&n.set("length",Ae(t.length)),new Proxy(t,{defineProperty(a,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Gu();var u=n.get(l);return u===void 0?u=o(()=>{var f=Ae(c.value);return n.set(l,f),f}):ve(u,c.value,!0),!0},deleteProperty(a,l){var c=n.get(l);if(c===void 0){if(l in a){const u=o(()=>Ae(Y));n.set(l,u),hi(i)}}else ve(c,Y),hi(i);return!0},get(a,l,c){if(l===ci)return t;var u=n.get(l),f=l in a;if(u===void 0&&(!f||Sn(a,l)?.writable)&&(u=o(()=>{var m=$n(f?a[l]:Y),p=Ae(m);return p}),n.set(l,u)),u!==void 0){var d=J(u);return d===Y?void 0:d}return Reflect.get(a,l,c)},getOwnPropertyDescriptor(a,l){var c=Reflect.getOwnPropertyDescriptor(a,l);if(c&&"value"in c){var u=n.get(l);u&&(c.value=J(u))}else if(c===void 0){var f=n.get(l),d=f?.v;if(f!==void 0&&d!==Y)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return c},has(a,l){if(l===ci)return!0;var c=n.get(l),u=c!==void 0&&c.v!==Y||Reflect.has(a,l);if(c!==void 0||O!==null&&(!u||Sn(a,l)?.writable)){c===void 0&&(c=o(()=>{var d=u?$n(a[l]):Y,m=Ae(d);return m}),n.set(l,c));var f=J(c);if(f===Y)return!1}return u},set(a,l,c,u){var f=n.get(l),d=l in a;if(r&&l==="length")for(var m=c;m<f.v;m+=1){var p=n.get(m+"");p!==void 0?ve(p,Y):m in a&&(p=o(()=>Ae(Y)),n.set(m+"",p))}if(f===void 0)(!d||Sn(a,l)?.writable)&&(f=o(()=>Ae(void 0)),ve(f,$n(c)),n.set(l,f));else{d=f.v!==Y;var v=o(()=>$n(c));ve(f,v)}var _=Reflect.getOwnPropertyDescriptor(a,l);if(_?.set&&_.set.call(u,c),!d){if(r&&typeof l=="string"){var E=n.get("length"),A=Number(l);Number.isInteger(A)&&A>=E.v&&ve(E,A+1)}hi(i)}return!0},ownKeys(a){J(i);var l=Reflect.ownKeys(a).filter(f=>{var d=n.get(f);return d===void 0||d.v!==Y});for(var[c,u]of n)u.v!==Y&&!(c in a)&&l.push(c);return l},setPrototypeOf(){Wu()}})}var ko,Xa,Qa,el;function kh(){if(ko===void 0){ko=window,Xa=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Qa=Sn(e,"firstChild").get,el=Sn(e,"nextSibling").get,go(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),go(n)&&(n.__t=void 0)}}function on(t=""){return document.createTextNode(t)}function at(t){return Qa.call(t)}function Pr(t){return el.call(t)}function Ci(t,e){return at(t)}function En(t,e){{var n=at(t);return n instanceof Comment&&n.data===""?Pr(n):n}}function Mi(t,e=1,n=!1){let r=t;for(;e--;)r=Pr(r);return r}function xh(t){t.textContent=""}function tl(){return!1}let xo=!1;function wh(){xo||(xo=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function ps(t){var e=M,n=O;Ne(null),Be(null);try{return t()}finally{Ne(e),Be(n)}}function $h(t,e,n,r=n){t.addEventListener(e,()=>ps(n));const i=t.__on_r;i?t.__on_r=()=>{i(),r(!0)}:t.__on_r=()=>r(!0),wh()}function _h(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Nt(t,e,n,r=!0){var i=O;i!==null&&(i.f&Oe)!==0&&(t|=Oe);var s={ctx:Ce,deps:null,nodes_start:null,nodes_end:null,f:t|Ee,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{Ht(s),s.f|=qa}catch(l){throw Ye(s),l}else e!==null&&Zt(s);if(r){var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes_start===null&&o.first===o.last&&(o.f&Ln)===0&&(o=o.first),o!==null&&(o.parent=i,i!==null&&_h(o,i),M!==null&&(M.f&xe)!==0&&(t&Et)===0)){var a=M;(a.effects??=[]).push(o)}}return s}function Ah(t){return Nt(La|ju,t,!1)}function Sh(t){Wt.ensure();const e=Nt(Et|Ln,t,!0);return(n={})=>new Promise(r=>{n.outro?Ut(e,()=>{Ye(e),r(void 0)}):(Ye(e),r(void 0))})}function Eh(t){return Nt(cs|Ln,t,!0)}function Nh(t,e=0){return Nt(Pa|e,t,!0)}function nl(t,e=[],n=[]){gh(e,n,r=>{Nt(Pa,()=>t(...r.map(J)),!0)})}function ms(t,e=0){var n=Nt(rn|e,t,!0);return n}function _t(t,e=!0){return Nt(ht|Ln,t,!0,e)}function rl(t){var e=t.teardown;if(e!==null){const n=qn,r=M;$o(!0),Ne(null);try{e.call(null)}finally{$o(n),Ne(r)}}}function il(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const i=n.ac;i!==null&&ps(()=>{i.abort(us)});var r=n.next;(n.f&Et)!==0?n.parent=null:Ye(n,e),n=r}}function Th(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&ht)===0&&Ye(e),e=n}}function Ye(t,e=!0){var n=!1;(e||(t.f&Uu)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(sl(t.nodes_start,t.nodes_end),n=!0),il(t,e&&!n),$r(t,0),ke(t,sn);var r=t.transitions;if(r!==null)for(const s of r)s.stop();rl(t);var i=t.parent;i!==null&&i.first!==null&&ol(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function sl(t,e){for(;t!==null;){var n=t===e?null:Pr(t);t.remove(),t=n}}function ol(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function Ut(t,e){var n=[];gs(t,n,!0),al(n,()=>{Ye(t),e&&e()})}function al(t,e){var n=t.length;if(n>0){var r=()=>--n||e();for(var i of t)i.out(r)}else e()}function gs(t,e,n){if((t.f&Oe)===0){if(t.f^=Oe,t.transitions!==null)for(const o of t.transitions)(o.is_global||n)&&e.push(o);for(var r=t.first;r!==null;){var i=r.next,s=(r.f&ls)!==0||(r.f&ht)!==0;gs(r,e,s?n:!1),r=i}}}function Rn(t){ll(t,!0)}function ll(t,e){if((t.f&Oe)!==0){t.f^=Oe,(t.f&ce)===0&&(ke(t,Ee),Zt(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&ls)!==0||(n.f&ht)!==0;ll(n,i?e:!1),n=r}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||e)&&s.in()}}let jt=!1;function wo(t){jt=t}let qn=!1;function $o(t){qn=t}let M=null,ze=!1;function Ne(t){M=t}let O=null;function Be(t){O=t}let Ze=null;function cl(t){M!==null&&(Ze===null?Ze=[t]:Ze.push(t))}let le=null,ye=0,_e=null;function Ih(t){_e=t}let ul=1,On=0,kt=On;function _o(t){kt=t}let lt=!1;function hl(){return++ul}function zr(t){var e=t.f;if((e&Ee)!==0)return!0;if((e&ft)!==0){var n=t.deps,r=(e&Re)!==0;if(n!==null){var i,s,o=(e&xr)!==0,a=r&&O!==null&&!lt,l=n.length;if((o||a)&&(O===null||(O.f&sn)===0)){var c=t,u=c.parent;for(i=0;i<l;i++)s=n[i],(o||!s?.reactions?.includes(c))&&(s.reactions??=[]).push(c);o&&(c.f^=xr),a&&u!==null&&(u.f&Re)===0&&(c.f^=Re)}for(i=0;i<l;i++)if(s=n[i],zr(s)&&Va(s),s.wv>t.wv)return!0}(!r||O!==null&&!lt)&&ke(t,ce)}return!1}function fl(t,e,n=!0){var r=t.reactions;if(r!==null&&!Ze?.includes(t))for(var i=0;i<r.length;i++){var s=r[i];(s.f&xe)!==0?fl(s,e,!1):e===s&&(n?ke(s,Ee):(s.f&ce)!==0&&ke(s,ft),Zt(s))}}function dl(t){var e=le,n=ye,r=_e,i=M,s=lt,o=Ze,a=Ce,l=ze,c=kt,u=t.f;le=null,ye=0,_e=null,lt=(u&Re)!==0&&(ze||!jt||M===null),M=(u&(ht|Et))===0?t:null,Ze=null,Gt(t.ctx),ze=!1,kt=++On,t.ac!==null&&(ps(()=>{t.ac.abort(us)}),t.ac=null);try{t.f|=Ii;var f=t.fn,d=f(),m=t.deps;if(le!==null){var p;if($r(t,ye),m!==null&&ye>0)for(m.length=ye+le.length,p=0;p<le.length;p++)m[ye+p]=le[p];else t.deps=m=le;if(!lt||(u&xe)!==0&&t.reactions!==null)for(p=ye;p<m.length;p++)(m[p].reactions??=[]).push(t)}else m!==null&&ye<m.length&&($r(t,ye),m.length=ye);if(Fa()&&_e!==null&&!ze&&m!==null&&(t.f&(xe|ft|Ee))===0)for(p=0;p<_e.length;p++)fl(_e[p],t);return i!==null&&i!==t&&(On++,_e!==null&&(r===null?r=_e:r.push(..._e))),(t.f&yt)!==0&&(t.f^=yt),d}catch(v){return ah(v)}finally{t.f^=Ii,le=e,ye=n,_e=r,M=i,lt=s,Ze=o,Gt(a),ze=l,kt=c}}function Rh(t,e){let n=e.reactions;if(n!==null){var r=Pu.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}n===null&&(e.f&xe)!==0&&(le===null||!le.includes(e))&&(ke(e,ft),(e.f&(Re|xr))===0&&(e.f^=xr),Ha(e),$r(e,0))}function $r(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)Rh(t,n[r])}function Ht(t){var e=t.f;if((e&sn)===0){ke(t,ce);var n=O,r=jt;O=t,jt=!0;try{(e&rn)!==0?Th(t):il(t),rl(t);var i=dl(t);t.teardown=typeof i=="function"?i:null,t.wv=ul;var s;Ma&&sh&&(t.f&Ee)!==0&&t.deps}finally{jt=r,O=n}}}async function Oh(){await Promise.resolve(),Wa()}function J(t){var e=t.f,n=(e&xe)!==0;if(M!==null&&!ze){var r=O!==null&&(O.f&sn)!==0;if(!r&&!Ze?.includes(t)){var i=M.deps;if((M.f&Ii)!==0)t.rv<On&&(t.rv=On,le===null&&i!==null&&i[ye]===t?ye++:le===null?le=[t]:(!lt||!le.includes(t))&&le.push(t));else{(M.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[M]:s.includes(M)||s.push(M)}}}else if(n&&t.deps===null&&t.effects===null){var o=t,a=o.parent;a!==null&&(a.f&Re)===0&&(o.f^=Re)}if(qn){if(ut.has(t))return ut.get(t);if(n){o=t;var l=o.v;return((o.f&ce)===0&&o.reactions!==null||pl(o))&&(l=ds(o)),ut.set(o,l),l}}else n&&(o=t,zr(o)&&Va(o));if((t.f&yt)!==0)throw t.v;return t.v}function pl(t){if(t.v===Y)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(ut.has(e)||(e.f&xe)!==0&&pl(e))return!0;return!1}function Ch(t){var e=ze;try{return ze=!0,t()}finally{ze=e}}const Mh=-7169;function ke(t,e){t.f=t.f&Mh|e}const Dh=["touchstart","touchmove"];function Lh(t){return Dh.includes(t)}const ml=new Set,Di=new Set;function Ph(t){for(var e=0;e<t.length;e++)ml.add(t[e]);for(var n of Di)n(t)}let Ao=null;function or(t){var e=this,n=e.ownerDocument,r=t.type,i=t.composedPath?.()||[],s=i[0]||t.target;Ao=t;var o=0,a=Ao===t&&t.__root;if(a){var l=i.indexOf(a);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=i.indexOf(e);if(c===-1)return;l<=c&&(o=l)}if(s=i[o]||t.target,s!==e){Ti(t,"currentTarget",{configurable:!0,get(){return s||n}});var u=M,f=O;Ne(null),Be(null);try{for(var d,m=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var v=s["__"+r];if(v!=null&&(!s.disabled||t.target===s))if(os(v)){var[_,...E]=v;_.apply(s,[t,...E])}else v.call(s,t)}catch(A){d?m.push(A):d=A}if(t.cancelBubble||p===e||p===null)break;s=p}if(d){for(let A of m)queueMicrotask(()=>{throw A});throw d}}finally{t.__root=e,delete t.currentTarget,Ne(u),Be(f)}}}function gl(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Cn(t,e){var n=O;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function Bn(t,e){var n=(e&eh)!==0,r=(e&th)!==0,i,s=!t.startsWith("<!>");return()=>{i===void 0&&(i=gl(s?t:"<!>"+t),n||(i=at(i)));var o=r||Xa?document.importNode(i,!0):i.cloneNode(!0);if(n){var a=at(o),l=o.lastChild;Cn(a,l)}else Cn(o,o);return o}}function zh(t=""){{var e=on(t+"");return Cn(e,e),e}}function gr(){var t=document.createDocumentFragment(),e=document.createComment(""),n=on();return t.append(e,n),Cn(e,n),t}function qe(t,e){t!==null&&t.before(e)}function qh(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function Bh(t,e){return Kh(t,e)}const qt=new Map;function Kh(t,{target:e,anchor:n,props:r={},events:i,context:s,intro:o=!0}){kh();var a=new Set,l=f=>{for(var d=0;d<f.length;d++){var m=f[d];if(!a.has(m)){a.add(m);var p=Lh(m);e.addEventListener(m,or,{passive:p});var v=qt.get(m);v===void 0?(document.addEventListener(m,or,{passive:p}),qt.set(m,1)):qt.set(m,v+1)}}};l(as(ml)),Di.add(l);var c=void 0,u=Sh(()=>{var f=n??e.appendChild(on());return _t(()=>{if(s){Pn({});var d=Ce;d.c=s}i&&(r.$$events=i),c=t(f,r)||{},s&&zn()}),()=>{for(var d of a){e.removeEventListener(d,or);var m=qt.get(d);--m===0?(document.removeEventListener(d,or),qt.delete(d)):qt.set(d,m)}Di.delete(l),f!==n&&f.parentNode?.removeChild(f)}});return Fh.set(c,u),c}let Fh=new WeakMap;const fi=0,ar=1,di=2;function bl(t,e,n,r,i){var s=t,o=Ce,a=Y,l,c,u,f=$t(void 0),d=$t(void 0),m=!1;function p(_,E){m=!0,E&&(Be(v),Ne(v),Gt(o));try{_===fi&&n&&(l?Rn(l):l=_t(()=>n(s))),_===ar&&r&&(c?Rn(c):c=_t(()=>r(s,f))),_!==fi&&l&&Ut(l,()=>l=null),_!==ar&&c&&Ut(c,()=>c=null),_!==di&&u&&Ut(u,()=>u=null)}finally{E&&(Gt(null),Ne(null),Be(null),Wa())}}var v=ms(()=>{if(a!==(a=e())){if(Ku(a)){var _=a;m=!1,_.then(E=>{_===a&&(vt(f,E),p(ar,!0))},E=>{if(_===a)throw vt(d,E),p(di,!0),d.v}),ch(()=>{m||p(fi,!0)})}else vt(f,a),p(ar,!1);return()=>a=Y}})}function So(t,e,n=!1){var r=t,i=null,s=null,o=Y,a=n?ls:0,l=!1;const c=(m,p=!0)=>{l=!0,d(p,m)};var u=null;function f(){u!==null&&(u.lastChild.remove(),r.before(u),u=null);var m=o?i:s,p=o?s:i;m&&Rn(m),p&&Ut(p,()=>{o?s=null:i=null})}const d=(m,p)=>{if(o!==(o=m)){var v=tl(),_=r;if(v&&(u=document.createDocumentFragment(),u.append(_=on())),o?i??=p&&_t(()=>p(_)):s??=p&&_t(()=>p(_)),v){var E=F,A=o?i:s,N=o?s:i;A&&E.skipped_effects.delete(A),N&&E.skipped_effects.add(N),E.add_callback(f)}else f()}};ms(()=>{l=!1,e(c),l||d(null,null)},a)}function Uh(t,e){return e}function jh(t,e,n){for(var r=t.items,i=[],s=e.length,o=0;o<s;o++)gs(e[o].e,i,!0);var a=s>0&&i.length===0&&n!==null;if(a){var l=n.parentNode;xh(l),l.append(n),r.clear(),Pe(t,e[0].prev,e[s-1].next)}al(i,()=>{for(var c=0;c<s;c++){var u=e[c];a||(r.delete(u.k),Pe(t,u.prev,u.next)),Ye(u.e,!a)}})}function Hh(t,e,n,r,i,s=null){var o=t,a={flags:e,items:new Map,first:null};{var l=t;o=l.appendChild(on())}var c=null,u=!1,f=new Map,d=ph(()=>{var _=n();return os(_)?_:_==null?[]:as(_)}),m,p;function v(){Vh(p,m,a,f,o,i,e,r,n),s!==null&&(m.length===0?c?Rn(c):c=_t(()=>s(o)):c!==null&&Ut(c,()=>{c=null}))}ms(()=>{p??=O,m=J(d);var _=m.length;if(!(u&&_===0)){u=_===0;var E,A,N,I;if(tl()){var j=new Set,be=F;for(A=0;A<_;A+=1){N=m[A],I=r(N,A);var we=a.items.get(I)??f.get(I);we?yl(we,N,A):(E=vl(null,a,null,null,N,I,A,i,e,n,!0),f.set(I,E)),j.add(I)}for(const[it,$e]of a.items)j.has(it)||be.skipped_effects.add($e.e);be.add_callback(v)}else v();J(d)}})}function Vh(t,e,n,r,i,s,o,a,l){var c=e.length,u=n.items,f=n.first,d=f,m,p=null,v=[],_=[],E,A,N,I;for(I=0;I<c;I+=1){if(E=e[I],A=a(E,I),N=u.get(A),N===void 0){var j=r.get(A);if(j!==void 0){r.delete(A),u.set(A,j);var be=p?p.next:d;Pe(n,p,j),Pe(n,j,be),pi(j,be,i),p=j}else{var we=d?d.e.nodes_start:i;p=vl(we,n,p,p===null?n.first:p.next,E,A,I,s,o,l)}u.set(A,p),v=[],_=[],d=p.next;continue}if(yl(N,E,I),(N.e.f&Oe)!==0&&Rn(N.e),N!==d){if(m!==void 0&&m.has(N)){if(v.length<_.length){var it=_[0],$e;p=it.prev;var Xn=v[0],W=v[v.length-1];for($e=0;$e<v.length;$e+=1)pi(v[$e],it,i);for($e=0;$e<_.length;$e+=1)m.delete(_[$e]);Pe(n,Xn.prev,W.next),Pe(n,p,Xn),Pe(n,W,it),d=it,p=W,I-=1,v=[],_=[]}else m.delete(N),pi(N,d,i),Pe(n,N.prev,N.next),Pe(n,N,p===null?n.first:p.next),Pe(n,p,N),p=N;continue}for(v=[],_=[];d!==null&&d.k!==A;)(d.e.f&Oe)===0&&(m??=new Set).add(d),_.push(d),d=d.next;if(d===null)continue;N=d}v.push(N),p=N,d=N.next}if(d!==null||m!==void 0){for(var dt=m===void 0?[]:as(m);d!==null;)(d.e.f&Oe)===0&&dt.push(d),d=d.next;var un=dt.length;if(un>0){var hn=c===0?i:null;jh(n,dt,hn)}}t.first=n.first&&n.first.e,t.last=p&&p.e;for(var Yr of r.values())Ye(Yr.e);r.clear()}function yl(t,e,n,r){vt(t.v,e),t.i=n}function vl(t,e,n,r,i,s,o,a,l,c,u){var f=(l&Yu)!==0,d=(l&Qu)===0,m=f?d?vh(i,!1,!1):$t(i):i,p=(l&Xu)===0?o:$t(o),v={i:p,v:m,k:s,a:null,e:null,prev:n,next:r};try{if(t===null){var _=document.createDocumentFragment();_.append(t=on())}return v.e=_t(()=>a(t,m,p,c),rh),v.e.prev=n&&n.e,v.e.next=r&&r.e,n===null?u||(e.first=v):(n.next=v,n.e.next=v.e),r!==null&&(r.prev=v,r.e.prev=v.e),v}finally{}}function pi(t,e,n){for(var r=t.next?t.next.e.nodes_start:n,i=e?e.e.nodes_start:n,s=t.e.nodes_start;s!==null&&s!==r;){var o=Pr(s);i.before(s),s=o}}function Pe(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function Jh(t,e,n=!1,r=!1,i=!1){var s=t,o="";nl(()=>{var a=O;if(o!==(o=e()??"")&&(a.nodes_start!==null&&(sl(a.nodes_start,a.nodes_end),a.nodes_start=a.nodes_end=null),o!=="")){var l=o+"";n?l=`<svg>${l}</svg>`:r&&(l=`<math>${l}</math>`);var c=gl(l);if((n||r)&&(c=at(c)),Cn(at(c),c.lastChild),n||r)for(;at(c);)s.before(at(c));else s.before(c)}})}const Gh=Symbol("is custom element"),Wh=Symbol("is html");function Zh(t,e,n,r){var i=Yh(t);i[e]!==(i[e]=n)&&t.setAttribute(e,n)}function Yh(t){return t.__attributes??={[Gh]:t.nodeName.includes("-"),[Wh]:t.namespaceURI===nh}}function Xh(t,e,n=e){var r=new WeakSet;$h(t,"input",async i=>{var s=i?t.defaultValue:t.value;if(s=mi(t)?gi(s):s,n(s),F!==null&&r.add(F),await Oh(),s!==(s=e())){var o=t.selectionStart,a=t.selectionEnd;t.value=s??"",a!==null&&(t.selectionStart=o,t.selectionEnd=Math.min(a,t.value.length))}}),Ch(e)==null&&t.value&&(n(mi(t)?gi(t.value):t.value),F!==null&&r.add(F)),Nh(()=>{var i=e();if(t===document.activeElement){var s=pr??F;if(r.has(s))return}mi(t)&&i===gi(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function mi(t){var e=t.type;return e==="number"||e==="range"}function gi(t){return t===""?null:+t}const Qh="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Qh);function bs(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Tt=bs();function kl(t){Tt=t}var Nn={exec:()=>null};function C(t,e=""){let n=typeof t=="string"?t:t.source,r={replace:(i,s)=>{let o=typeof s=="string"?s:s.source;return o=o.replace(he.caret,"$1"),n=n.replace(i,o),r},getRegex:()=>new RegExp(n,e)};return r}var he={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},ef=/^(?:[ \t]*(?:\n|$))+/,tf=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,nf=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Kn=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,rf=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,ys=/(?:[*+-]|\d{1,9}[.)])/,xl=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,wl=C(xl).replace(/bull/g,ys).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),sf=C(xl).replace(/bull/g,ys).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),vs=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,of=/^[^\n]+/,ks=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,af=C(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ks).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),lf=C(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,ys).getRegex(),qr="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",xs=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,cf=C("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",xs).replace("tag",qr).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),$l=C(vs).replace("hr",Kn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qr).getRegex(),uf=C(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",$l).getRegex(),ws={blockquote:uf,code:tf,def:af,fences:nf,heading:rf,hr:Kn,html:cf,lheading:wl,list:lf,newline:ef,paragraph:$l,table:Nn,text:of},Eo=C("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Kn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qr).getRegex(),hf={...ws,lheading:sf,table:Eo,paragraph:C(vs).replace("hr",Kn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Eo).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qr).getRegex()},ff={...ws,html:C(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",xs).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Nn,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:C(vs).replace("hr",Kn).replace("heading",` *#{1,6} *[^
]`).replace("lheading",wl).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},df=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,pf=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,_l=/^( {2,}|\\)\n(?!\s*$)/,mf=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Br=/[\p{P}\p{S}]/u,$s=/[\s\p{P}\p{S}]/u,Al=/[^\s\p{P}\p{S}]/u,gf=C(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,$s).getRegex(),Sl=/(?!~)[\p{P}\p{S}]/u,bf=/(?!~)[\s\p{P}\p{S}]/u,yf=/(?:[^\s\p{P}\p{S}]|~)/u,vf=/\[[^\[\]]*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)|`[^`]*?`|<(?! )[^<>]*?>/g,El=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,kf=C(El,"u").replace(/punct/g,Br).getRegex(),xf=C(El,"u").replace(/punct/g,Sl).getRegex(),Nl="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",wf=C(Nl,"gu").replace(/notPunctSpace/g,Al).replace(/punctSpace/g,$s).replace(/punct/g,Br).getRegex(),$f=C(Nl,"gu").replace(/notPunctSpace/g,yf).replace(/punctSpace/g,bf).replace(/punct/g,Sl).getRegex(),_f=C("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Al).replace(/punctSpace/g,$s).replace(/punct/g,Br).getRegex(),Af=C(/\\(punct)/,"gu").replace(/punct/g,Br).getRegex(),Sf=C(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ef=C(xs).replace("(?:-->|$)","-->").getRegex(),Nf=C("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ef).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),_r=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`[^`]*`|[^\[\]\\`])*?/,Tf=C(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",_r).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Tl=C(/^!?\[(label)\]\[(ref)\]/).replace("label",_r).replace("ref",ks).getRegex(),Il=C(/^!?\[(ref)\](?:\[\])?/).replace("ref",ks).getRegex(),If=C("reflink|nolink(?!\\()","g").replace("reflink",Tl).replace("nolink",Il).getRegex(),_s={_backpedal:Nn,anyPunctuation:Af,autolink:Sf,blockSkip:vf,br:_l,code:pf,del:Nn,emStrongLDelim:kf,emStrongRDelimAst:wf,emStrongRDelimUnd:_f,escape:df,link:Tf,nolink:Il,punctuation:gf,reflink:Tl,reflinkSearch:If,tag:Nf,text:mf,url:Nn},Rf={..._s,link:C(/^!?\[(label)\]\((.*?)\)/).replace("label",_r).getRegex(),reflink:C(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",_r).getRegex()},Li={..._s,emStrongRDelimAst:$f,emStrongLDelim:xf,url:C(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Of={...Li,br:C(_l).replace("{2,}","*").getRegex(),text:C(Li.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},lr={normal:ws,gfm:hf,pedantic:ff},gn={normal:_s,gfm:Li,breaks:Of,pedantic:Rf},Cf={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},No=t=>Cf[t];function Le(t,e){if(e){if(he.escapeTest.test(t))return t.replace(he.escapeReplace,No)}else if(he.escapeTestNoEncode.test(t))return t.replace(he.escapeReplaceNoEncode,No);return t}function To(t){try{t=encodeURI(t).replace(he.percentDecode,"%")}catch{return null}return t}function Io(t,e){let n=t.replace(he.findPipe,(s,o,a)=>{let l=!1,c=o;for(;--c>=0&&a[c]==="\\";)l=!l;return l?"|":" |"}),r=n.split(he.splitPipe),i=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(he.slashPipe,"|");return r}function bn(t,e,n){let r=t.length;if(r===0)return"";let i=0;for(;i<r&&t.charAt(r-i-1)===e;)i++;return t.slice(0,r-i)}function Mf(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return n>0?-2:-1}function Ro(t,e,n,r,i){let s=e.href,o=e.title||null,a=t[1].replace(i.other.outputLinkReplace,"$1");r.state.inLink=!0;let l={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:s,title:o,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,l}function Df(t,e,n){let r=t.match(n.other.indentCodeCompensation);if(r===null)return e;let i=r[1];return e.split(`
`).map(s=>{let o=s.match(n.other.beginningSpace);if(o===null)return s;let[a]=o;return a.length>=i.length?s.slice(i.length):s}).join(`
`)}var Ar=class{options;rules;lexer;constructor(t){this.options=t||Tt}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:bn(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],r=Df(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let r=bn(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:bn(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=bn(e[0],`
`).split(`
`),r="",i="",s=[];for(;n.length>0;){let o=!1,a=[],l;for(l=0;l<n.length;l++)if(this.rules.other.blockquoteStart.test(n[l]))a.push(n[l]),o=!0;else if(!o)a.push(n[l]);else break;n=n.slice(l);let c=a.join(`
`),u=c.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${c}`:c,i=i?`${i}
${u}`:u;let f=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,s,!0),this.lexer.state.top=f,n.length===0)break;let d=s.at(-1);if(d?.type==="code")break;if(d?.type==="blockquote"){let m=d,p=m.raw+`
`+n.join(`
`),v=this.blockquote(p);s[s.length-1]=v,r=r.substring(0,r.length-m.raw.length)+v.raw,i=i.substring(0,i.length-m.text.length)+v.text;break}else if(d?.type==="list"){let m=d,p=m.raw+`
`+n.join(`
`),v=this.list(p);s[s.length-1]=v,r=r.substring(0,r.length-d.raw.length)+v.raw,i=i.substring(0,i.length-m.raw.length)+v.raw,n=p.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:i}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim(),r=n.length>1,i={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");let s=this.rules.other.listItemRegex(n),o=!1;for(;t;){let l=!1,c="",u="";if(!(e=s.exec(t))||this.rules.block.hr.test(t))break;c=e[0],t=t.substring(c.length);let f=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,E=>" ".repeat(3*E.length)),d=t.split(`
`,1)[0],m=!f.trim(),p=0;if(this.options.pedantic?(p=2,u=f.trimStart()):m?p=e[1].length+1:(p=e[2].search(this.rules.other.nonSpaceChar),p=p>4?1:p,u=f.slice(p),p+=e[1].length),m&&this.rules.other.blankLine.test(d)&&(c+=d+`
`,t=t.substring(d.length+1),l=!0),!l){let E=this.rules.other.nextBulletRegex(p),A=this.rules.other.hrRegex(p),N=this.rules.other.fencesBeginRegex(p),I=this.rules.other.headingBeginRegex(p),j=this.rules.other.htmlBeginRegex(p);for(;t;){let be=t.split(`
`,1)[0],we;if(d=be,this.options.pedantic?(d=d.replace(this.rules.other.listReplaceNesting,"  "),we=d):we=d.replace(this.rules.other.tabCharGlobal,"    "),N.test(d)||I.test(d)||j.test(d)||E.test(d)||A.test(d))break;if(we.search(this.rules.other.nonSpaceChar)>=p||!d.trim())u+=`
`+we.slice(p);else{if(m||f.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||N.test(f)||I.test(f)||A.test(f))break;u+=`
`+d}!m&&!d.trim()&&(m=!0),c+=be+`
`,t=t.substring(be.length+1),f=we.slice(p)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(c)&&(o=!0));let v=null,_;this.options.gfm&&(v=this.rules.other.listIsTask.exec(u),v&&(_=v[0]!=="[ ] ",u=u.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:c,task:!!v,checked:_,loose:!1,text:u,tokens:[]}),i.raw+=c}let a=i.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let l=0;l<i.items.length;l++)if(this.lexer.state.top=!1,i.items[l].tokens=this.lexer.blockTokens(i.items[l].text,[]),!i.loose){let c=i.items[l].tokens.filter(f=>f.type==="space"),u=c.length>0&&c.some(f=>this.rules.other.anyLine.test(f.raw));i.loose=u}if(i.loose)for(let l=0;l<i.items.length;l++)i.items[l].loose=!0;return i}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:r,title:i}}}table(t){let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=Io(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let o of r)this.rules.other.tableAlignRight.test(o)?s.align.push("right"):this.rules.other.tableAlignCenter.test(o)?s.align.push("center"):this.rules.other.tableAlignLeft.test(o)?s.align.push("left"):s.align.push(null);for(let o=0;o<n.length;o++)s.header.push({text:n[o],tokens:this.lexer.inline(n[o]),header:!0,align:s.align[o]});for(let o of i)s.rows.push(Io(o,s.header.length).map((a,l)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:s.align[l]})));return s}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let s=bn(n.slice(0,-1),"\\");if((n.length-s.length)%2===0)return}else{let s=Mf(e[2],"()");if(s===-2)return;if(s>-1){let o=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,o).trim(),e[3]=""}}let r=e[2],i="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],i=s[3])}else i=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),Ro(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[r.toLowerCase()];if(!i){let s=n[0].charAt(0);return{type:"text",raw:s,text:s}}return Ro(n,i,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let i=[...r[0]].length-1,s,o,a=i,l=0,c=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(c.lastIndex=0,e=e.slice(-1*t.length+i);(r=c.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(o=[...s].length,r[3]||r[4]){a+=o;continue}else if((r[5]||r[6])&&i%3&&!((i+o)%3)){l+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+l);let u=[...r[0]][0].length,f=t.slice(0,i+r.index+u+o);if(Math.min(i,o)%2){let m=f.slice(1,-1);return{type:"em",raw:f,text:m,tokens:this.lexer.inlineTokens(m)}}let d=f.slice(2,-2);return{type:"strong",raw:f,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),i=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&i&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,r;return e[2]==="@"?(n=e[1],r="mailto:"+n):(n=e[1],r=n),{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(t){let e;if(e=this.rules.inline.url.exec(t)){let n,r;if(e[2]==="@")n=e[0],r="mailto:"+n;else{let i;do i=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(i!==e[0]);n=e[0],e[1]==="www."?r="http://"+e[0]:r=e[0]}return{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},Ge=class Pi{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Tt,this.options.tokenizer=this.options.tokenizer||new Ar,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:he,block:lr.normal,inline:gn.normal};this.options.pedantic?(n.block=lr.pedantic,n.inline=gn.pedantic):this.options.gfm&&(n.block=lr.gfm,this.options.breaks?n.inline=gn.breaks:n.inline=gn.gfm),this.tokenizer.rules=n}static get rules(){return{block:lr,inline:gn}}static lex(e,n){return new Pi(n).lex(e)}static lexInline(e,n){return new Pi(n).inlineTokens(e)}lex(e){e=e.replace(he.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],r=!1){for(this.options.pedantic&&(e=e.replace(he.tabCharGlobal,"    ").replace(he.spaceLine,""));e;){let i;if(this.options.extensions?.block?.some(o=>(i=o.call({lexer:this},e,n))?(e=e.substring(i.raw.length),n.push(i),!0):!1))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let o=n.at(-1);i.raw.length===1&&o!==void 0?o.raw+=`
`:n.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let o=n.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.at(-1).src=o.text):n.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let o=n.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},n.push(i));continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),n.push(i);continue}let s=e;if(this.options.extensions?.startBlock){let o=1/0,a=e.slice(1),l;this.options.extensions.startBlock.forEach(c=>{l=c.call({lexer:this},a),typeof l=="number"&&l>=0&&(o=Math.min(o,l))}),o<1/0&&o>=0&&(s=e.substring(0,o+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){let o=n.at(-1);r&&o?.type==="paragraph"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):n.push(i),r=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let o=n.at(-1);o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):n.push(i);continue}if(e){let o="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){let r=e,i=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)a.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,i.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(i=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let s=!1,o="";for(;e;){s||(o=""),s=!1;let a;if(this.options.extensions?.inline?.some(c=>(a=c.call({lexer:this},e,n))?(e=e.substring(a.raw.length),n.push(a),!0):!1))continue;if(a=this.tokenizer.escape(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.tag(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.link(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(a.raw.length);let c=n.at(-1);a.type==="text"&&c?.type==="text"?(c.raw+=a.raw,c.text+=a.text):n.push(a);continue}if(a=this.tokenizer.emStrong(e,r,o)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.codespan(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.br(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.del(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.autolink(e)){e=e.substring(a.raw.length),n.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(e))){e=e.substring(a.raw.length),n.push(a);continue}let l=e;if(this.options.extensions?.startInline){let c=1/0,u=e.slice(1),f;this.options.extensions.startInline.forEach(d=>{f=d.call({lexer:this},u),typeof f=="number"&&f>=0&&(c=Math.min(c,f))}),c<1/0&&c>=0&&(l=e.substring(0,c+1))}if(a=this.tokenizer.inlineText(l)){e=e.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(o=a.raw.slice(-1)),s=!0;let c=n.at(-1);c?.type==="text"?(c.raw+=a.raw,c.text+=a.text):n.push(a);continue}if(e){let c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return n}},Sr=class{options;parser;constructor(t){this.options=t||Tt}space(t){return""}code({text:t,lang:e,escaped:n}){let r=(e||"").match(he.notSpaceStart)?.[0],i=t.replace(he.endingNewline,"")+`
`;return r?'<pre><code class="language-'+Le(r)+'">'+(n?i:Le(i,!0))+`</code></pre>
`:"<pre><code>"+(n?i:Le(i,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,r="";for(let o=0;o<t.items.length;o++){let a=t.items[o];r+=this.listitem(a)}let i=e?"ol":"ul",s=e&&n!==1?' start="'+n+'"':"";return"<"+i+s+`>
`+r+"</"+i+`>
`}listitem(t){let e="";if(t.task){let n=this.checkbox({checked:!!t.checked});t.loose?t.tokens[0]?.type==="paragraph"?(t.tokens[0].text=n+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&t.tokens[0].tokens[0].type==="text"&&(t.tokens[0].tokens[0].text=n+" "+Le(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):e+=n+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let i=0;i<t.header.length;i++)n+=this.tablecell(t.header[i]);e+=this.tablerow({text:n});let r="";for(let i=0;i<t.rows.length;i++){let s=t.rows[i];n="";for(let o=0;o<s.length;o++)n+=this.tablecell(s[o]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Le(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let r=this.parser.parseInline(n),i=To(t);if(i===null)return r;t=i;let s='<a href="'+t+'"';return e&&(s+=' title="'+Le(e)+'"'),s+=">"+r+"</a>",s}image({href:t,title:e,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let i=To(t);if(i===null)return Le(n);t=i;let s=`<img src="${t}" alt="${n}"`;return e&&(s+=` title="${Le(e)}"`),s+=">",s}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Le(t.text)}},As=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},We=class zi{options;renderer;textRenderer;constructor(e){this.options=e||Tt,this.options.renderer=this.options.renderer||new Sr,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new As}static parse(e,n){return new zi(n).parse(e)}static parseInline(e,n){return new zi(n).parseInline(e)}parse(e,n=!0){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=s,l=this.options.extensions.renderers[a.type].call({parser:this},a);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){r+=l||"";continue}}let o=s;switch(o.type){case"space":{r+=this.renderer.space(o);continue}case"hr":{r+=this.renderer.hr(o);continue}case"heading":{r+=this.renderer.heading(o);continue}case"code":{r+=this.renderer.code(o);continue}case"table":{r+=this.renderer.table(o);continue}case"blockquote":{r+=this.renderer.blockquote(o);continue}case"list":{r+=this.renderer.list(o);continue}case"html":{r+=this.renderer.html(o);continue}case"def":{r+=this.renderer.def(o);continue}case"paragraph":{r+=this.renderer.paragraph(o);continue}case"text":{let a=o,l=this.renderer.text(a);for(;i+1<e.length&&e[i+1].type==="text";)a=e[++i],l+=`
`+this.renderer.text(a);n?r+=this.renderer.paragraph({type:"paragraph",raw:l,text:l,tokens:[{type:"text",raw:l,text:l,escaped:!0}]}):r+=l;continue}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}parseInline(e,n=this.renderer){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){r+=a||"";continue}}let o=s;switch(o.type){case"escape":{r+=n.text(o);break}case"html":{r+=n.html(o);break}case"link":{r+=n.link(o);break}case"image":{r+=n.image(o);break}case"strong":{r+=n.strong(o);break}case"em":{r+=n.em(o);break}case"codespan":{r+=n.codespan(o);break}case"br":{r+=n.br(o);break}case"del":{r+=n.del(o);break}case"text":{r+=n.text(o);break}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}},br=class{options;block;constructor(t){this.options=t||Tt}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?Ge.lex:Ge.lexInline}provideParser(){return this.block?We.parse:We.parseInline}},Lf=class{defaults=bs();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=We;Renderer=Sr;TextRenderer=As;Lexer=Ge;Tokenizer=Ar;Hooks=br;constructor(...t){this.use(...t)}walkTokens(t,e){let n=[];for(let r of t)switch(n=n.concat(e.call(this,r)),r.type){case"table":{let i=r;for(let s of i.header)n=n.concat(this.walkTokens(s.tokens,e));for(let s of i.rows)for(let o of s)n=n.concat(this.walkTokens(o.tokens,e));break}case"list":{let i=r;n=n.concat(this.walkTokens(i.items,e));break}default:{let i=r;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(s=>{let o=i[s].flat(1/0);n=n.concat(this.walkTokens(o,e))}):i.tokens&&(n=n.concat(this.walkTokens(i.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let s=e.renderers[i.name];s?e.renderers[i.name]=function(...o){let a=i.renderer.apply(this,o);return a===!1&&(a=s.apply(this,o)),a}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[i.level];s?s.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),r.extensions=e),n.renderer){let i=this.defaults.renderer||new Sr(this.defaults);for(let s in n.renderer){if(!(s in i))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let o=s,a=n.renderer[o],l=i[o];i[o]=(...c)=>{let u=a.apply(i,c);return u===!1&&(u=l.apply(i,c)),u||""}}r.renderer=i}if(n.tokenizer){let i=this.defaults.tokenizer||new Ar(this.defaults);for(let s in n.tokenizer){if(!(s in i))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let o=s,a=n.tokenizer[o],l=i[o];i[o]=(...c)=>{let u=a.apply(i,c);return u===!1&&(u=l.apply(i,c)),u}}r.tokenizer=i}if(n.hooks){let i=this.defaults.hooks||new br;for(let s in n.hooks){if(!(s in i))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let o=s,a=n.hooks[o],l=i[o];br.passThroughHooks.has(s)?i[o]=c=>{if(this.defaults.async)return Promise.resolve(a.call(i,c)).then(f=>l.call(i,f));let u=a.call(i,c);return l.call(i,u)}:i[o]=(...c)=>{let u=a.apply(i,c);return u===!1&&(u=l.apply(i,c)),u}}r.hooks=i}if(n.walkTokens){let i=this.defaults.walkTokens,s=n.walkTokens;r.walkTokens=function(o){let a=[];return a.push(s.call(this,o)),i&&(a=a.concat(i.call(this,o))),a}}this.defaults={...this.defaults,...r}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Ge.lex(t,e??this.defaults)}parser(t,e){return We.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let r={...n},i={...this.defaults,...r},s=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&r.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));i.hooks&&(i.hooks.options=i,i.hooks.block=t);let o=i.hooks?i.hooks.provideLexer():t?Ge.lex:Ge.lexInline,a=i.hooks?i.hooks.provideParser():t?We.parse:We.parseInline;if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(e):e).then(l=>o(l,i)).then(l=>i.hooks?i.hooks.processAllTokens(l):l).then(l=>i.walkTokens?Promise.all(this.walkTokens(l,i.walkTokens)).then(()=>l):l).then(l=>a(l,i)).then(l=>i.hooks?i.hooks.postprocess(l):l).catch(s);try{i.hooks&&(e=i.hooks.preprocess(e));let l=o(e,i);i.hooks&&(l=i.hooks.processAllTokens(l)),i.walkTokens&&this.walkTokens(l,i.walkTokens);let c=a(l,i);return i.hooks&&(c=i.hooks.postprocess(c)),c}catch(l){return s(l)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let r="<p>An error occurred:</p><pre>"+Le(n.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(n);throw n}}},At=new Lf;function D(t,e){return At.parse(t,e)}D.options=D.setOptions=function(t){return At.setOptions(t),D.defaults=At.defaults,kl(D.defaults),D};D.getDefaults=bs;D.defaults=Tt;D.use=function(...t){return At.use(...t),D.defaults=At.defaults,kl(D.defaults),D};D.walkTokens=function(t,e){return At.walkTokens(t,e)};D.parseInline=At.parseInline;D.Parser=We;D.parser=We.parse;D.Renderer=Sr;D.TextRenderer=As;D.Lexer=Ge;D.lexer=Ge.lex;D.Tokenizer=Ar;D.Hooks=br;D.parse=D;D.options;D.setOptions;D.use;D.walkTokens;D.parseInline;We.parse;Ge.lex;/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:Rl,setPrototypeOf:Oo,isFrozen:Pf,getPrototypeOf:zf,getOwnPropertyDescriptor:qf}=Object;let{freeze:de,seal:Te,create:Ol}=Object,{apply:qi,construct:Bi}=typeof Reflect<"u"&&Reflect;de||(de=function(e){return e});Te||(Te=function(e){return e});qi||(qi=function(e,n,r){return e.apply(n,r)});Bi||(Bi=function(e,n){return new e(...n)});const cr=pe(Array.prototype.forEach),Bf=pe(Array.prototype.lastIndexOf),Co=pe(Array.prototype.pop),yn=pe(Array.prototype.push),Kf=pe(Array.prototype.splice),yr=pe(String.prototype.toLowerCase),bi=pe(String.prototype.toString),Mo=pe(String.prototype.match),vn=pe(String.prototype.replace),Ff=pe(String.prototype.indexOf),Uf=pe(String.prototype.trim),Ie=pe(Object.prototype.hasOwnProperty),ae=pe(RegExp.prototype.test),kn=jf(TypeError);function pe(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return qi(t,e,r)}}function jf(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Bi(t,n)}}function T(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:yr;Oo&&Oo(t,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){const s=n(i);s!==i&&(Pf(e)||(e[r]=s),i=s)}t[i]=!0}return t}function Hf(t){for(let e=0;e<t.length;e++)Ie(t,e)||(t[e]=null);return t}function Ve(t){const e=Ol(null);for(const[n,r]of Rl(t))Ie(t,n)&&(Array.isArray(r)?e[n]=Hf(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=Ve(r):e[n]=r);return e}function xn(t,e){for(;t!==null;){const r=qf(t,e);if(r){if(r.get)return pe(r.get);if(typeof r.value=="function")return pe(r.value)}t=zf(t)}function n(){return null}return n}const Do=de(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),yi=de(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),vi=de(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Vf=de(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ki=de(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Jf=de(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Lo=de(["#text"]),Po=de(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),xi=de(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),zo=de(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ur=de(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Gf=Te(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Wf=Te(/<%[\w\W]*|[\w\W]*%>/gm),Zf=Te(/\$\{[\w\W]*/gm),Yf=Te(/^data-[\-\w.\u00B7-\uFFFF]+$/),Xf=Te(/^aria-[\-\w]+$/),Cl=Te(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Qf=Te(/^(?:\w+script|data):/i),ed=Te(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ml=Te(/^html$/i),td=Te(/^[a-z][.\w]*(-[.\w]+)+$/i);var qo=Object.freeze({__proto__:null,ARIA_ATTR:Xf,ATTR_WHITESPACE:ed,CUSTOM_ELEMENT:td,DATA_ATTR:Yf,DOCTYPE_NAME:Ml,ERB_EXPR:Wf,IS_ALLOWED_URI:Cl,IS_SCRIPT_OR_DATA:Qf,MUSTACHE_EXPR:Gf,TMPLIT_EXPR:Zf});const wn={element:1,text:3,progressingInstruction:7,comment:8,document:9},nd=function(){return typeof window>"u"?null:window},rd=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";n&&n.hasAttribute(i)&&(r=n.getAttribute(i));const s="dompurify"+(r?"#"+r:"");try{return e.createPolicy(s,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},Bo=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Dl(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:nd();const e=w=>Dl(w);if(e.version="3.2.6",e.removed=[],!t||!t.document||t.document.nodeType!==wn.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,i=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:c,NamedNodeMap:u=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:f,DOMParser:d,trustedTypes:m}=t,p=l.prototype,v=xn(p,"cloneNode"),_=xn(p,"remove"),E=xn(p,"nextSibling"),A=xn(p,"childNodes"),N=xn(p,"parentNode");if(typeof o=="function"){const w=n.createElement("template");w.content&&w.content.ownerDocument&&(n=w.content.ownerDocument)}let I,j="";const{implementation:be,createNodeIterator:we,createDocumentFragment:it,getElementsByTagName:$e}=n,{importNode:Xn}=r;let W=Bo();e.isSupported=typeof Rl=="function"&&typeof N=="function"&&be&&be.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:dt,ERB_EXPR:un,TMPLIT_EXPR:hn,DATA_ATTR:Yr,ARIA_ATTR:Su,IS_SCRIPT_OR_DATA:Eu,ATTR_WHITESPACE:js,CUSTOM_ELEMENT:Nu}=qo;let{IS_ALLOWED_URI:Hs}=qo,Q=null;const Vs=T({},[...Do,...yi,...vi,...ki,...Lo]);let re=null;const Js=T({},[...Po,...xi,...zo,...ur]);let H=Object.seal(Ol(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),fn=null,Xr=null,Gs=!0,Qr=!0,Ws=!1,Zs=!0,Ot=!1,Qn=!0,pt=!1,ei=!1,ti=!1,Ct=!1,er=!1,tr=!1,Ys=!0,Xs=!1;const Tu="user-content-";let ni=!0,dn=!1,Mt={},Dt=null;const Qs=T({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let eo=null;const to=T({},["audio","video","img","source","image","track"]);let ri=null;const no=T({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),nr="http://www.w3.org/1998/Math/MathML",rr="http://www.w3.org/2000/svg",Ue="http://www.w3.org/1999/xhtml";let Lt=Ue,ii=!1,si=null;const Iu=T({},[nr,rr,Ue],bi);let ir=T({},["mi","mo","mn","ms","mtext"]),sr=T({},["annotation-xml"]);const Ru=T({},["title","style","font","a","script"]);let pn=null;const Ou=["application/xhtml+xml","text/html"],Cu="text/html";let ee=null,Pt=null;const Mu=n.createElement("form"),ro=function(h){return h instanceof RegExp||h instanceof Function},oi=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Pt&&Pt===h)){if((!h||typeof h!="object")&&(h={}),h=Ve(h),pn=Ou.indexOf(h.PARSER_MEDIA_TYPE)===-1?Cu:h.PARSER_MEDIA_TYPE,ee=pn==="application/xhtml+xml"?bi:yr,Q=Ie(h,"ALLOWED_TAGS")?T({},h.ALLOWED_TAGS,ee):Vs,re=Ie(h,"ALLOWED_ATTR")?T({},h.ALLOWED_ATTR,ee):Js,si=Ie(h,"ALLOWED_NAMESPACES")?T({},h.ALLOWED_NAMESPACES,bi):Iu,ri=Ie(h,"ADD_URI_SAFE_ATTR")?T(Ve(no),h.ADD_URI_SAFE_ATTR,ee):no,eo=Ie(h,"ADD_DATA_URI_TAGS")?T(Ve(to),h.ADD_DATA_URI_TAGS,ee):to,Dt=Ie(h,"FORBID_CONTENTS")?T({},h.FORBID_CONTENTS,ee):Qs,fn=Ie(h,"FORBID_TAGS")?T({},h.FORBID_TAGS,ee):Ve({}),Xr=Ie(h,"FORBID_ATTR")?T({},h.FORBID_ATTR,ee):Ve({}),Mt=Ie(h,"USE_PROFILES")?h.USE_PROFILES:!1,Gs=h.ALLOW_ARIA_ATTR!==!1,Qr=h.ALLOW_DATA_ATTR!==!1,Ws=h.ALLOW_UNKNOWN_PROTOCOLS||!1,Zs=h.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ot=h.SAFE_FOR_TEMPLATES||!1,Qn=h.SAFE_FOR_XML!==!1,pt=h.WHOLE_DOCUMENT||!1,Ct=h.RETURN_DOM||!1,er=h.RETURN_DOM_FRAGMENT||!1,tr=h.RETURN_TRUSTED_TYPE||!1,ti=h.FORCE_BODY||!1,Ys=h.SANITIZE_DOM!==!1,Xs=h.SANITIZE_NAMED_PROPS||!1,ni=h.KEEP_CONTENT!==!1,dn=h.IN_PLACE||!1,Hs=h.ALLOWED_URI_REGEXP||Cl,Lt=h.NAMESPACE||Ue,ir=h.MATHML_TEXT_INTEGRATION_POINTS||ir,sr=h.HTML_INTEGRATION_POINTS||sr,H=h.CUSTOM_ELEMENT_HANDLING||{},h.CUSTOM_ELEMENT_HANDLING&&ro(h.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(H.tagNameCheck=h.CUSTOM_ELEMENT_HANDLING.tagNameCheck),h.CUSTOM_ELEMENT_HANDLING&&ro(h.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(H.attributeNameCheck=h.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),h.CUSTOM_ELEMENT_HANDLING&&typeof h.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(H.allowCustomizedBuiltInElements=h.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ot&&(Qr=!1),er&&(Ct=!0),Mt&&(Q=T({},Lo),re=[],Mt.html===!0&&(T(Q,Do),T(re,Po)),Mt.svg===!0&&(T(Q,yi),T(re,xi),T(re,ur)),Mt.svgFilters===!0&&(T(Q,vi),T(re,xi),T(re,ur)),Mt.mathMl===!0&&(T(Q,ki),T(re,zo),T(re,ur))),h.ADD_TAGS&&(Q===Vs&&(Q=Ve(Q)),T(Q,h.ADD_TAGS,ee)),h.ADD_ATTR&&(re===Js&&(re=Ve(re)),T(re,h.ADD_ATTR,ee)),h.ADD_URI_SAFE_ATTR&&T(ri,h.ADD_URI_SAFE_ATTR,ee),h.FORBID_CONTENTS&&(Dt===Qs&&(Dt=Ve(Dt)),T(Dt,h.FORBID_CONTENTS,ee)),ni&&(Q["#text"]=!0),pt&&T(Q,["html","head","body"]),Q.table&&(T(Q,["tbody"]),delete fn.tbody),h.TRUSTED_TYPES_POLICY){if(typeof h.TRUSTED_TYPES_POLICY.createHTML!="function")throw kn('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof h.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw kn('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');I=h.TRUSTED_TYPES_POLICY,j=I.createHTML("")}else I===void 0&&(I=rd(m,i)),I!==null&&typeof j=="string"&&(j=I.createHTML(""));de&&de(h),Pt=h}},io=T({},[...yi,...vi,...Vf]),so=T({},[...ki,...Jf]),Du=function(h){let g=N(h);(!g||!g.tagName)&&(g={namespaceURI:Lt,tagName:"template"});const k=yr(h.tagName),K=yr(g.tagName);return si[h.namespaceURI]?h.namespaceURI===rr?g.namespaceURI===Ue?k==="svg":g.namespaceURI===nr?k==="svg"&&(K==="annotation-xml"||ir[K]):!!io[k]:h.namespaceURI===nr?g.namespaceURI===Ue?k==="math":g.namespaceURI===rr?k==="math"&&sr[K]:!!so[k]:h.namespaceURI===Ue?g.namespaceURI===rr&&!sr[K]||g.namespaceURI===nr&&!ir[K]?!1:!so[k]&&(Ru[k]||!io[k]):!!(pn==="application/xhtml+xml"&&si[h.namespaceURI]):!1},De=function(h){yn(e.removed,{element:h});try{N(h).removeChild(h)}catch{_(h)}},zt=function(h,g){try{yn(e.removed,{attribute:g.getAttributeNode(h),from:g})}catch{yn(e.removed,{attribute:null,from:g})}if(g.removeAttribute(h),h==="is")if(Ct||er)try{De(g)}catch{}else try{g.setAttribute(h,"")}catch{}},oo=function(h){let g=null,k=null;if(ti)h="<remove></remove>"+h;else{const Z=Mo(h,/^[\r\n\t ]+/);k=Z&&Z[0]}pn==="application/xhtml+xml"&&Lt===Ue&&(h='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+h+"</body></html>");const K=I?I.createHTML(h):h;if(Lt===Ue)try{g=new d().parseFromString(K,pn)}catch{}if(!g||!g.documentElement){g=be.createDocument(Lt,"template",null);try{g.documentElement.innerHTML=ii?j:K}catch{}}const ie=g.body||g.documentElement;return h&&k&&ie.insertBefore(n.createTextNode(k),ie.childNodes[0]||null),Lt===Ue?$e.call(g,pt?"html":"body")[0]:pt?g.documentElement:ie},ao=function(h){return we.call(h.ownerDocument||h,h,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},ai=function(h){return h instanceof f&&(typeof h.nodeName!="string"||typeof h.textContent!="string"||typeof h.removeChild!="function"||!(h.attributes instanceof u)||typeof h.removeAttribute!="function"||typeof h.setAttribute!="function"||typeof h.namespaceURI!="string"||typeof h.insertBefore!="function"||typeof h.hasChildNodes!="function")},lo=function(h){return typeof a=="function"&&h instanceof a};function je(w,h,g){cr(w,k=>{k.call(e,h,g,Pt)})}const co=function(h){let g=null;if(je(W.beforeSanitizeElements,h,null),ai(h))return De(h),!0;const k=ee(h.nodeName);if(je(W.uponSanitizeElement,h,{tagName:k,allowedTags:Q}),Qn&&h.hasChildNodes()&&!lo(h.firstElementChild)&&ae(/<[/\w!]/g,h.innerHTML)&&ae(/<[/\w!]/g,h.textContent)||h.nodeType===wn.progressingInstruction||Qn&&h.nodeType===wn.comment&&ae(/<[/\w]/g,h.data))return De(h),!0;if(!Q[k]||fn[k]){if(!fn[k]&&ho(k)&&(H.tagNameCheck instanceof RegExp&&ae(H.tagNameCheck,k)||H.tagNameCheck instanceof Function&&H.tagNameCheck(k)))return!1;if(ni&&!Dt[k]){const K=N(h)||h.parentNode,ie=A(h)||h.childNodes;if(ie&&K){const Z=ie.length;for(let me=Z-1;me>=0;--me){const He=v(ie[me],!0);He.__removalCount=(h.__removalCount||0)+1,K.insertBefore(He,E(h))}}}return De(h),!0}return h instanceof l&&!Du(h)||(k==="noscript"||k==="noembed"||k==="noframes")&&ae(/<\/no(script|embed|frames)/i,h.innerHTML)?(De(h),!0):(Ot&&h.nodeType===wn.text&&(g=h.textContent,cr([dt,un,hn],K=>{g=vn(g,K," ")}),h.textContent!==g&&(yn(e.removed,{element:h.cloneNode()}),h.textContent=g)),je(W.afterSanitizeElements,h,null),!1)},uo=function(h,g,k){if(Ys&&(g==="id"||g==="name")&&(k in n||k in Mu))return!1;if(!(Qr&&!Xr[g]&&ae(Yr,g))){if(!(Gs&&ae(Su,g))){if(!re[g]||Xr[g]){if(!(ho(h)&&(H.tagNameCheck instanceof RegExp&&ae(H.tagNameCheck,h)||H.tagNameCheck instanceof Function&&H.tagNameCheck(h))&&(H.attributeNameCheck instanceof RegExp&&ae(H.attributeNameCheck,g)||H.attributeNameCheck instanceof Function&&H.attributeNameCheck(g))||g==="is"&&H.allowCustomizedBuiltInElements&&(H.tagNameCheck instanceof RegExp&&ae(H.tagNameCheck,k)||H.tagNameCheck instanceof Function&&H.tagNameCheck(k))))return!1}else if(!ri[g]){if(!ae(Hs,vn(k,js,""))){if(!((g==="src"||g==="xlink:href"||g==="href")&&h!=="script"&&Ff(k,"data:")===0&&eo[h])){if(!(Ws&&!ae(Eu,vn(k,js,"")))){if(k)return!1}}}}}}return!0},ho=function(h){return h!=="annotation-xml"&&Mo(h,Nu)},fo=function(h){je(W.beforeSanitizeAttributes,h,null);const{attributes:g}=h;if(!g||ai(h))return;const k={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:re,forceKeepAttr:void 0};let K=g.length;for(;K--;){const ie=g[K],{name:Z,namespaceURI:me,value:He}=ie,mn=ee(Z),li=He;let se=Z==="value"?li:Uf(li);if(k.attrName=mn,k.attrValue=se,k.keepAttr=!0,k.forceKeepAttr=void 0,je(W.uponSanitizeAttribute,h,k),se=k.attrValue,Xs&&(mn==="id"||mn==="name")&&(zt(Z,h),se=Tu+se),Qn&&ae(/((--!?|])>)|<\/(style|title)/i,se)){zt(Z,h);continue}if(k.forceKeepAttr)continue;if(!k.keepAttr){zt(Z,h);continue}if(!Zs&&ae(/\/>/i,se)){zt(Z,h);continue}Ot&&cr([dt,un,hn],mo=>{se=vn(se,mo," ")});const po=ee(h.nodeName);if(!uo(po,mn,se)){zt(Z,h);continue}if(I&&typeof m=="object"&&typeof m.getAttributeType=="function"&&!me)switch(m.getAttributeType(po,mn)){case"TrustedHTML":{se=I.createHTML(se);break}case"TrustedScriptURL":{se=I.createScriptURL(se);break}}if(se!==li)try{me?h.setAttributeNS(me,Z,se):h.setAttribute(Z,se),ai(h)?De(h):Co(e.removed)}catch{zt(Z,h)}}je(W.afterSanitizeAttributes,h,null)},Lu=function w(h){let g=null;const k=ao(h);for(je(W.beforeSanitizeShadowDOM,h,null);g=k.nextNode();)je(W.uponSanitizeShadowNode,g,null),co(g),fo(g),g.content instanceof s&&w(g.content);je(W.afterSanitizeShadowDOM,h,null)};return e.sanitize=function(w){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=null,k=null,K=null,ie=null;if(ii=!w,ii&&(w="<!-->"),typeof w!="string"&&!lo(w))if(typeof w.toString=="function"){if(w=w.toString(),typeof w!="string")throw kn("dirty is not a string, aborting")}else throw kn("toString is not a function");if(!e.isSupported)return w;if(ei||oi(h),e.removed=[],typeof w=="string"&&(dn=!1),dn){if(w.nodeName){const He=ee(w.nodeName);if(!Q[He]||fn[He])throw kn("root node is forbidden and cannot be sanitized in-place")}}else if(w instanceof a)g=oo("<!---->"),k=g.ownerDocument.importNode(w,!0),k.nodeType===wn.element&&k.nodeName==="BODY"||k.nodeName==="HTML"?g=k:g.appendChild(k);else{if(!Ct&&!Ot&&!pt&&w.indexOf("<")===-1)return I&&tr?I.createHTML(w):w;if(g=oo(w),!g)return Ct?null:tr?j:""}g&&ti&&De(g.firstChild);const Z=ao(dn?w:g);for(;K=Z.nextNode();)co(K),fo(K),K.content instanceof s&&Lu(K.content);if(dn)return w;if(Ct){if(er)for(ie=it.call(g.ownerDocument);g.firstChild;)ie.appendChild(g.firstChild);else ie=g;return(re.shadowroot||re.shadowrootmode)&&(ie=Xn.call(r,ie,!0)),ie}let me=pt?g.outerHTML:g.innerHTML;return pt&&Q["!doctype"]&&g.ownerDocument&&g.ownerDocument.doctype&&g.ownerDocument.doctype.name&&ae(Ml,g.ownerDocument.doctype.name)&&(me="<!DOCTYPE "+g.ownerDocument.doctype.name+`>
`+me),Ot&&cr([dt,un,hn],He=>{me=vn(me,He," ")}),I&&tr?I.createHTML(me):me},e.setConfig=function(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};oi(w),ei=!0},e.clearConfig=function(){Pt=null,ei=!1},e.isValidAttribute=function(w,h,g){Pt||oi({});const k=ee(w),K=ee(h);return uo(k,K,g)},e.addHook=function(w,h){typeof h=="function"&&yn(W[w],h)},e.removeHook=function(w,h){if(h!==void 0){const g=Bf(W[w],h);return g===-1?void 0:Kf(W[w],g,1)[0]}return Co(W[w])},e.removeHooks=function(w){W[w]=[]},e.removeAllHooks=function(){W=Bo()},e}var id=Dl();const sd="What's my name? ⛈️🌪️🌞🌗🪐",Ll=new URL("/sunshine/",window.location.href),Fn=t=>Array.isArray(t)?t:[t],od=(t,e)=>{const n=[[],[]];for(const r of t)e(r)?n[0].push(r):n[1].push(r);return n},Pl=Array,mt=(t,e)=>t.includes(e),ad=(t,e=0)=>[...new Array(t)].map((n,r)=>r+e),P=(t,e,n)=>t===void 0?e===void 0?[]:Array.isArray(e)?e:[e]:(Array.isArray(e)?t.push(...e):t.push(e),t),bt=(t,e)=>e==null?t??[]:t==null?Fn(e):t.concat(e),ld=(...t)=>t.reduce(bt,[]),xt=(t,e,n)=>{if(t===void 0)return Array.isArray(e)?e:[e];const r=n?.isEqual??((i,s)=>i===s);for(const i of Fn(e))t.some(s=>r(s,i))||t.push(i);return t},cd=(t,e)=>t.reduce((n,r)=>{const i=r[e];return n[i]=P(n[i],r),n},{}),Yt=(t,e,n)=>t.length===e.length&&t.every(n?.isEqual?(r,i)=>n.isEqual(r,e[i]):(r,i)=>r===e[i]),It=(t,e)=>Me(t)===e,Me=t=>{const e=typeof t;return e==="object"?t===null?"null":"object":e==="function"?"object":e},Xe={boolean:"boolean",null:"null",undefined:"undefined",bigint:"a bigint",number:"a number",object:"an object",string:"a string",symbol:"a symbol"},ud={...Xe,function:"a function"};class hd extends Error{}const G=t=>Xt(t,hd),Xt=(t,e=Error)=>{throw new e(t)};class fd extends Error{name="ParseError"}const b=t=>Xt(t,fd),zl=t=>` ${t}`,z=(t,e)=>{const n={},r=Array.isArray(t);let i=!1;for(const[s,o]of Object.entries(t).entries()){const a=r?e(s,o[1]):e(...o,s);i||=typeof a[0]=="number";const l=Array.isArray(a[0])||a.length===0?a:[a];for(const[c,u]of l)typeof c=="object"?n[c.group]=P(n[c.group],u):n[c]=u}return i?Object.values(n):n},ql=Object.entries,Ke=(t,e)=>t in e,Ss=(t,e)=>e in t;class dd{constructor(e){Object.assign(this,e)}}const pd=class{};class Bl extends pd{}const md=(t,e)=>{const n={},r={};let i;for(i in t)i in e?n[i]=t[i]:r[i]=t[i];return[n,r]},gd=(t,e)=>md(t,e)[1],Un=t=>Object.keys(t).length===0,Er=t=>[...Object.entries(t),...Object.getOwnPropertySymbols(t).map(e=>[e,t[e]])],bd=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),yd=t=>{const e=Object.keys(t).sort(),n={};for(let r=0;r<e.length;r++)n[e[r]]=t[e[r]];return n},Je=zl("represents an uninitialized value"),vd=t=>Object.values(t).filter(e=>typeof e=="number"?!0:typeof t[e]!="number"),Kl={Array,Boolean,Date,Error,Function,Map,Number,Promise,RegExp,Set,String,WeakMap,WeakSet},Fl=globalThis.File??Blob,Ul={ArrayBuffer,Blob,File:Fl,FormData,Headers,Request,Response,URL},kd={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array},Qt={...Kl,...Ul,...kd,String,Number,Boolean},Es=t=>{let e=Object.getPrototypeOf(t);for(;e?.constructor&&(!Ke(e.constructor.name,Qt)||!(t instanceof Qt[e.constructor.name]));)e=Object.getPrototypeOf(e);const n=e?.constructor?.name;if(!(n===void 0||n==="Object"))return n},Ki=t=>typeof t=="object"&&t!==null?Es(t)??"object":Me(t),oe=Array.isArray,xd={Array:"an array",Function:"a function",Date:"a Date",RegExp:"a RegExp",Error:"an Error",Map:"a Map",Set:"a Set",String:"a String object",Number:"a Number object",Boolean:"a Boolean object",Promise:"a Promise",WeakMap:"a WeakMap",WeakSet:"a WeakSet"},wd={ArrayBuffer:"an ArrayBuffer instance",Blob:"a Blob instance",File:"a File instance",FormData:"a FormData instance",Headers:"a Headers instance",Request:"a Request instance",Response:"a Response instance",URL:"a URL instance"},$d={Int8Array:"an Int8Array",Uint8Array:"a Uint8Array",Uint8ClampedArray:"a Uint8ClampedArray",Int16Array:"an Int16Array",Uint16Array:"a Uint16Array",Int32Array:"an Int32Array",Uint32Array:"a Uint32Array",Float32Array:"a Float32Array",Float64Array:"a Float64Array",BigInt64Array:"a BigInt64Array",BigUint64Array:"a BigUint64Array"},_d={...xd,...wd,...$d},Ns=t=>{const e=Object(t).name??null;return e&&Ke(e,Qt)&&Qt[e]===t?e:null},Ko=(t,e)=>{let n=t.prototype;for(;n!==null;){if(n===e.prototype)return!0;n=Object.getPrototypeOf(n)}return!1},Ad=t=>jl(t,new Map),jl=(t,e)=>{if(typeof t!="object"||t===null)return t;if(e?.has(t))return e.get(t);const n=Ns(t.constructor);if(n==="Date")return new Date(t.getTime());if(n&&n!=="Array")return t;const r=Array.isArray(t)?t.slice():Object.create(Object.getPrototypeOf(t)),i=Object.getOwnPropertyDescriptors(t);if(e){e.set(t,r);for(const s in i){const o=i[s];"get"in o||"set"in o||(o.value=jl(o.value,e))}}return Object.defineProperties(r,i),r},Sd=t=>{let e=Je;return()=>e===Je?e=t():e},Kr=t=>typeof t=="function"&&t.length===0,Ed=class extends Function{constructor(...t){const e=t.slice(0,-1),n=t.at(-1);try{super(...e,n)}catch(r){return G(`Encountered an unexpected error while compiling your definition:
                Message: ${r} 
                Source: (${t.slice(0,-1)}) => {
                    ${t.at(-1)}
                }`)}}};class an{constructor(e,...[n]){return Object.assign(Object.setPrototypeOf(e.bind(n?.bind??this),this.constructor.prototype),n?.attach)}}const Nd=Sd(()=>{try{return new Function("return false")()}catch{return!0}});class Fe{constructor(){}}var Td={};const Id=()=>{try{return((new Error().stack?.split(`
`)[2]?.trim()||"").match(/\(?(.+?)(?::\d+:\d+)?\)?$/)?.[1]||"unknown").replace(/^file:\/\//,"")}catch{return"unknown"}},Rd=Td??{},Od={fileName:Id,env:Rd},Cd=t=>t[0].toUpperCase()+t.slice(1),Hl=t=>new RegExp(Md(t),typeof t=="string"?"":t.flags),Md=t=>`^(?:${typeof t=="string"?t:t.source})$`,ot={negativeLookahead:t=>`(?!${t})`,nonCapturingGroup:t=>`(?:${t})`},Fi="\\",Fr={" ":1,"\n":1,"	":1},Dd=/^-0\.?0*$/.source,Vl=/[1-9]\d*/.source,Ld=/\.\d+/.source,Pd=/\.\d*[1-9]/.source,Jl=t=>Hl(ot.negativeLookahead(Dd)+ot.nonCapturingGroup("-?"+ot.nonCapturingGroup(ot.nonCapturingGroup("0|"+Vl)+ot.nonCapturingGroup(t.decimalPattern)+"?")+(t.allowDecimalOnly?"|"+t.decimalPattern:"")+"?")),Fo=Jl({decimalPattern:Pd,allowDecimalOnly:!1}),zd=Fo.test.bind(Fo),Ui=Jl({decimalPattern:Ld,allowDecimalOnly:!0});Ui.test.bind(Ui);const qd=/^-?\d*\.?\d*$/,Bd=t=>t.length!==0&&qd.test(t),Nr=Hl(ot.negativeLookahead("^-0$")+"-?"+ot.nonCapturingGroup(ot.nonCapturingGroup("0|"+Vl))),Kd=Nr.test.bind(Nr),ji=/^-?\d+$/,Fd=ji.test.bind(ji),Gl={number:"a number",bigint:"a bigint",integer:"an integer"},Wl=(t,e)=>`'${t}' was parsed as ${Gl[e]} but could not be narrowed to a literal value. Avoid unnecessary leading or trailing zeros and other abnormal notation`,Ud=(t,e)=>e==="number"?zd(t):Kd(t),jd=(t,e)=>e==="number"?Number(t):Number.parseInt(t),Hd=(t,e)=>e==="number"?Bd(t):Fd(t),Vd=(t,e)=>Ts(t,"number",e),Jd=(t,e)=>Ts(t,"number",{...e,strict:!0}),Gd=(t,e)=>Ts(t,"integer",e),Ts=(t,e,n)=>{const r=jd(t,e);return!Number.isNaN(r)&&Hd(t,e)?n?.strict?Ud(t,e)?r:b(Wl(t,e)):r:n?.errorOnFail?b(n?.errorOnFail===!0?`Failed to parse ${Gl[e]} from '${t}'`:n?.errorOnFail):void 0},Wd=t=>{if(t[t.length-1]!=="n")return;const e=t.slice(0,-1);let n;try{n=BigInt(e)}catch{return}if(Nr.test(e))return n;if(ji.test(e))return b(Wl(t,"bigint"))},Zd="0.46.0",Yd={version:Zd,filename:Od.fileName(),FileConstructor:Fl},jn=Yd,Uo=new Map,wi=Object.create(null),Hi=t=>{const e=Uo.get(t);if(e)return e;let n=Xd(t);return wi[n]?n=`${n}${wi[n]++}`:wi[n]=1,jn[n]=t,Uo.set(t,n),n},Mn=t=>/^[$A-Z_a-z][\w$]*$/.test(t),Xd=t=>{switch(typeof t){case"object":{if(t===null)break;const e=Es(t)??"object";return e[0].toLowerCase()+e.slice(1)}case"function":return Mn(t.name)?t.name:"fn";case"symbol":return t.description&&Mn(t.description)?t.description:"symbol"}return G(`Unexpected attempt to register serializable value of type ${Me(t)}`)},Is=t=>typeof t=="string"?JSON.stringify(t):typeof t=="bigint"?`${t}n`:`${t}`,Qd=(t,e={})=>Tn(t,{onUndefined:"$ark.undefined",onBigInt:n=>`$ark.bigint-${n}`,...e},[]),L=(t,e)=>{switch(Me(t)){case"object":const n=t,r=n.constructor.name;return r==="Object"||r==="Array"?e?.quoteKeys===!1?Tr(n,e?.indent??0,""):JSON.stringify(Tn(n,en,[]),null,e?.indent):Tr(n,e?.indent??0,"");case"symbol":return en.onSymbol(t);default:return Is(t)}},Tr=(t,e,n)=>{if(typeof t=="function")return en.onFunction(t);if(typeof t!="object"||t===null)return Is(t);const r=n+" ".repeat(e);if(Array.isArray(t)){if(t.length===0)return"[]";const s=t.map(o=>Tr(o,e,r)).join(`,
`+r);return e?`[
${r}${s}
${n}]`:`[${s}]`}const i=t.constructor.name;if(i==="Object"){const s=Er(t).map(([o,a])=>{const l=typeof o=="symbol"?en.onSymbol(o):Mn(o)?o:JSON.stringify(o),c=Tr(a,e,r);return`${r}${l}: ${c}`});return s.length===0?"{}":e?`{
${s.join(`,
`)}
${n}}`:`{${s.join(", ")}}`}return t instanceof Date?Hn(t):"expression"in t&&typeof t.expression=="string"?t.expression:i},en={onCycle:()=>"(cycle)",onSymbol:t=>`Symbol(${Hi(t)})`,onFunction:t=>`Function(${Hi(t)})`},Tn=(t,e,n)=>{switch(Me(t)){case"object":{const r=t;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();if(typeof r=="function")return en.onFunction(r);if(n.includes(r))return"(cycle)";const i=[...n,r];if(Array.isArray(r))return r.map(o=>Tn(o,e,i));if(r instanceof Date)return r.toDateString();const s={};for(const o in r)s[o]=Tn(r[o],e,i);for(const o of Object.getOwnPropertySymbols(r))s[e.onSymbol?.(o)??o.toString()]=Tn(r[o],e,i);return s}case"symbol":return en.onSymbol(t);case"bigint":return e.onBigInt?.(t)??`${t}n`;case"undefined":return e.onUndefined??"undefined";case"string":return t.replaceAll("\\","\\\\");default:return t}},Hn=t=>{const e=t.getFullYear(),n=t.getMonth(),r=t.getDate(),i=t.getHours(),s=t.getMinutes(),o=t.getSeconds(),a=t.getMilliseconds();if(n===0&&r===1&&i===0&&s===0&&o===0&&a===0)return`${e}`;const l=`${ep[n]} ${r}, ${e}`;if(i===0&&s===0&&o===0&&a===0)return l;let c=t.toLocaleTimeString();const u=c.endsWith(" AM")||c.endsWith(" PM")?c.slice(-3):"";return u&&(c=c.slice(0,-u.length)),a?c+=`.${np(a,3)}`:tp.test(c)&&(c=c.slice(0,-3)),`${c+u}, ${l}`},ep=["January","February","March","April","May","June","July","August","September","October","November","December"],tp=/:\d\d:00$/,np=(t,e)=>String(t).padStart(e,"0"),Zl=(t,e,...[n])=>{const r=n?.stringifySymbol??L;let i=t;switch(typeof e){case"string":i=Mn(e)?t===""?e:`${t}.${e}`:`${t}[${JSON.stringify(e)}]`;break;case"number":i=`${t}[${e}]`;break;case"symbol":i=`${t}[${r(e)}]`;break;default:n?.stringifyNonKey?i=`${t}[${n.stringifyNonKey(e)}]`:b(`${L(e)} must be a PropertyKey or stringifyNonKey must be passed to options`)}return i},Vn=(t,...e)=>t.reduce((n,r)=>Zl(n,r,...e),"");class Yl extends Pl{cache={};constructor(...e){super(),this.push(...e)}toJSON(){if(this.cache.json)return this.cache.json;this.cache.json=[];for(let e=0;e<this.length;e++)this.cache.json.push(typeof this[e]=="symbol"?L(this[e]):this[e]);return this.cache.json}stringify(){return this.cache.stringify?this.cache.stringify:this.cache.stringify=Vn(this)}stringifyAncestors(){if(this.cache.stringifyAncestors)return this.cache.stringifyAncestors;let e="";const n=[e];for(const r of this)e=Zl(e,r),n.push(e);return this.cache.stringifyAncestors=n}}class rp{chars;i;def;constructor(e){this.def=e,this.chars=[...e],this.i=0}shift(){return this.chars[this.i++]??""}get lookahead(){return this.chars[this.i]??""}get nextLookahead(){return this.chars[this.i+1]??""}get length(){return this.chars.length}shiftUntil(e){let n="";for(;this.lookahead;){if(e(this,n))if(n[n.length-1]===Fi)n=n.slice(0,-1);else break;n+=this.shift()}return n}shiftUntilLookahead(e){return typeof e=="string"?this.shiftUntil(n=>n.lookahead===e):this.shiftUntil(n=>n.lookahead in e)}shiftUntilNonWhitespace(){return this.shiftUntil(()=>!(this.lookahead in Fr))}jumpToIndex(e){this.i=e<0?this.length+e:e}jumpForward(e){this.i+=e}get location(){return this.i}get unscanned(){return this.chars.slice(this.i,this.length).join("")}get scanned(){return this.chars.slice(0,this.i).join("")}sliceChars(e,n){return this.chars.slice(e,n).join("")}lookaheadIs(e){return this.lookahead===e}lookaheadIsIn(e){return this.lookahead in e}}let Vi="$ark",ip=2;for(;Vi in globalThis;)Vi=`$ark${ip++}`;const Xl=Vi;globalThis[Xl]=jn;const y=jn,sp=t=>`${Xl}.${t}`,fe=t=>sp(Hi(t));class Ql extends Bl{argNames;body="";constructor(...e){super(),this.argNames=e;for(const n of e){if(n in this)throw new Error(`Arg name '${n}' would overwrite an existing property on FunctionBody`);this[n]=n}}indentation=0;indent(){return this.indentation+=4,this}dedent(){return this.indentation-=4,this}prop(e,n=!1){return ec(e,n)}index(e,n=!1){return tc(`${e}`,n)}line(e){return this.body+=`${" ".repeat(this.indentation)}${e}
`,this}const(e,n){return this.line(`const ${e} = ${n}`),this}let(e,n){return this.line(`let ${e} = ${n}`)}set(e,n){return this.line(`${e} = ${n}`)}if(e,n){return this.block(`if (${e})`,n)}elseIf(e,n){return this.block(`else if (${e})`,n)}else(e){return this.block("else",e)}for(e,n,r=0){return this.block(`for (let i = ${r}; ${e}; i++)`,n)}forIn(e,n){return this.block(`for (const k in ${e})`,n)}block(e,n,r=""){return this.line(`${e} {`),this.indent(),n(this),this.dedent(),this.line(`}${r}`)}return(e=""){return this.line(`return ${e}`)}write(e="anonymous",n=0){return`${e}(${this.argNames.join(", ")}) { ${n?this.body.split(`
`).map(r=>" ".repeat(n)+`${r}`).join(`
`):this.body} }`}compile(){return new Ed(...this.argNames,this.body)}}const Jn=t=>It(t,"object")||typeof t=="symbol"?fe(t):Is(t),ec=(t,e=!1)=>typeof t=="string"&&Mn(t)?`${e?"?":""}.${t}`:tc(op(t),e),op=t=>typeof t=="symbol"?fe(t):JSON.stringify(t),tc=(t,e=!1)=>`${e?"?.":""}[${t}]`;class $i extends Ql{traversalKind;optimistic;constructor(e){super("data","ctx"),this.traversalKind=e.kind,this.optimistic=e.optimistic===!0}invoke(e,n){const r=n?.arg??this.data,i=typeof e=="string"?!0:this.requiresContextFor(e),s=typeof e=="string"?e:e.id;return i?`${this.referenceToId(s,n)}(${r}, ${this.ctx})`:`${this.referenceToId(s,n)}(${r})`}referenceToId(e,n){const r=n?.kind??this.traversalKind,i=`this.${e}${r}`;return n?.bind?`${i}.bind(${n?.bind})`:i}requiresContextFor(e){return this.traversalKind==="Apply"||e.allowsRequiresContext}initializeErrorCount(){return this.const("errorCount","ctx.currentErrorCount")}returnIfFail(){return this.if("ctx.currentErrorCount > errorCount",()=>this.return())}returnIfFailFast(){return this.if("ctx.failFast && ctx.currentErrorCount > errorCount",()=>this.return())}traverseKey(e,n,r){const i=this.requiresContextFor(r);return i&&this.line(`${this.ctx}.path.push(${e})`),this.check(r,{arg:n}),i&&this.line(`${this.ctx}.path.pop()`),this}check(e,n){return this.traversalKind==="Allows"?this.if(`!${this.invoke(e,n)}`,()=>this.return(!1)):this.line(this.invoke(e,n))}}const nc=t=>z(t,(e,n)=>[e,oe(n)?[...n]:n]),Qe=zl("arkKind"),$=(t,e)=>t?.[Qe]===e,ue=t=>$(t,"root")||$(t,"constraint"),ap=["unit","proto","domain"],Ur=["required","optional","index","sequence"],rc=["pattern","divisor","exactLength","max","min","maxLength","minLength","before","after"],Rs=[...rc,...Ur,"structure","predicate"],jr=["alias","union","morph","unit","intersection","proto","domain"],lp=[...jr,...Rs],ic=z(Rs,(t,e)=>[e,1]),cp=z([...Ur,"undeclared"],(t,e)=>[e,1]),sc=z(lp,(t,e)=>[e,t]),vr=t=>typeof t=="string"&&t in sc,Ir=t=>sc[t],Os=t=>jr.slice(Ir(t)+1);[...Os("union")];[...Os("morph")];const St=t=>typeof t=="string"||typeof t=="boolean"||t===null?t:typeof t=="number"?Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t:Jn(t),Hr=t=>{let e="{ ";for(const[n,r]of Object.entries(t))e+=`${n}: ${Jn(r)}, `;return e+" }"},U=t=>{const e=t;return e.hasAssociatedError&&(e.defaults.expected??=n=>"description"in n?n.description:e.defaults.description(n),e.defaults.actual??=n=>L(n),e.defaults.problem??=n=>`must be ${n.expected}${n.actual?` (was ${n.actual})`:""}`,e.defaults.message??=n=>{if(n.path.length===0)return n.problem;const r=`${n.propString} ${n.problem}`;return r[0]==="["?`value at ${r}`:r}),e};class up extends Error{name="ToJsonSchemaError";code;context;constructor(e,n){super(L(n,{quoteKeys:!1,indent:4})),this.code=e,this.context=n}hasCode(e){return this.code===e}}const hp={dialect:"https://json-schema.org/draft/2020-12/schema",useRefs:!1,fallback:{arrayObject:t=>X.throw("arrayObject",t),arrayPostfix:t=>X.throw("arrayPostfix",t),defaultValue:t=>X.throw("defaultValue",t),domain:t=>X.throw("domain",t),morph:t=>X.throw("morph",t),patternIntersection:t=>X.throw("patternIntersection",t),predicate:t=>X.throw("predicate",t),proto:t=>X.throw("proto",t),symbolKey:t=>X.throw("symbolKey",t),unit:t=>X.throw("unit",t),date:t=>X.throw("date",t)}},X={Error:up,throw:(...t)=>{throw new X.Error(...t)},throwInternalOperandError:(t,e)=>G(`Unexpected JSON Schema input for ${t}: ${L(e)}`),defaultConfig:hp};y.config??={};const Ji=(t,e)=>{if(!e)return t;const n={...t};let r;for(r in e){const i={...t.keywords};if(r==="keywords"){for(const s in e[r]){const o=e.keywords[s];o!==void 0&&(i[s]=typeof o=="string"?{description:o}:o)}n.keywords=i}else r==="toJsonSchema"?n[r]=oc(t.toJsonSchema,e.toJsonSchema):vr(r)?n[r]={...t[r],...e[r]}:n[r]=e[r]}return n},oc=((t,e)=>{if(!t)return e??{};if(!e)return t;const n={...t};let r;for(r in e)r==="fallback"?n.fallback=fp(t.fallback,e.fallback):n[r]=e[r];return n}),fp=(t,e)=>{t=jo(t),e=jo(e);const n={};let r;for(r in X.defaultConfig.fallback)n[r]=e[r]??e.default??t[r]??t.default??X.defaultConfig.fallback[r];return n},jo=t=>typeof t=="function"?{default:t}:t??{};class tn extends Bl{[Qe]="error";path;data;nodeConfig;input;ctx;constructor({prefixPath:e,relativePath:n,...r},i){super(),this.input=r,this.ctx=i,bd(this,r);const s=i.data;r.code==="union"&&(r.errors=r.errors.flatMap(a=>{const l=a.hasCode("union")?a.errors:[a];return!e&&!n?l:l.map(c=>c.transform(u=>({...u,path:ld(e,u.path,n)})))})),this.nodeConfig=i.config[this.code];const o=[...r.path??i.path];n&&o.push(...n),e&&o.unshift(...e),this.path=new Yl(...o),this.data="data"in r?r.data:s}transform(e){return new tn(e({data:this.data,path:this.path,...this.input}),this.ctx)}hasCode(e){return this.code===e}get propString(){return Vn(this.path)}get expected(){if(this.input.expected)return this.input.expected;const e=this.meta?.expected??this.nodeConfig.expected;return typeof e=="function"?e(this.input):e}get actual(){if(this.input.actual)return this.input.actual;const e=this.meta?.actual??this.nodeConfig.actual;return typeof e=="function"?e(this.data):e}get problem(){if(this.input.problem)return this.input.problem;const e=this.meta?.problem??this.nodeConfig.problem;return typeof e=="function"?e(this):e}get message(){if(this.input.message)return this.input.message;const e=this.meta?.message??this.nodeConfig.message;return typeof e=="function"?e(this):e}get flat(){return this.hasCode("intersection")?[...this.errors]:[this]}toJSON(){return{data:this.data,path:this.path,...this.input,expected:this.expected,actual:this.actual,problem:this.problem,message:this.message}}toString(){return this.message}throw(){throw this}}class et extends Pl{[Qe]="errors";ctx;constructor(e){super(),this.ctx=e}byPath=Object.create(null);get flatByPath(){return z(this.byPath,(e,n)=>[e,n.flat])}get flatProblemsByPath(){return z(this.byPath,(e,n)=>[e,n.flat.map(r=>r.problem)])}byAncestorPath=Object.create(null);count=0;mutable=this;throw(){throw this.toTraversalError()}toTraversalError(){return new dp(this)}add(e){this.includes(e)||this._add(e)}transform(e){const n=new et(this.ctx);for(const r of this)n.add(e(r));return n}merge(e){for(const n of e)this.includes(n)||this._add(new tn({...n,path:[...this.ctx.path,...n.path]},this.ctx))}affectsPath(e){return this.length===0?!1:e.stringifyAncestors().some(n=>n in this.byPath)||e.stringify()in this.byAncestorPath}get summary(){return this.toString()}get issues(){return this}toJSON(){return[...this.map(e=>e.toJSON())]}toString(){return this.join(`
`)}_add(e){const n=this.byPath[e.propString];if(n){if(n.hasCode("union")&&n.errors.length===0)return;const r=e.hasCode("union")&&e.errors.length===0?e:new tn({code:"intersection",errors:n.hasCode("intersection")?[...n.errors,e]:[n,e]},this.ctx),i=this.indexOf(n);this.mutable[i===-1?this.length:i]=r,this.byPath[e.propString]=r,this.addAncestorPaths(e)}else this.byPath[e.propString]=e,this.addAncestorPaths(e),this.mutable.push(e);this.count++}addAncestorPaths(e){for(const n of e.path.stringifyAncestors())this.byAncestorPath[n]=P(this.byAncestorPath[n],e)}}class dp extends Error{name="TraversalError";constructor(e){e.length===1?super(e.summary):super(`
`+e.map(n=>`  • ${pp(n)}`).join(`
`)),Object.defineProperty(this,"arkErrors",{value:e,enumerable:!1})}}const pp=t=>t.toString().split(`
`).join(`
  `);class Ft{path=[];errors=new et(this);root;config;queuedMorphs=[];branches=[];seen={};constructor(e,n){this.root=e,this.config=n}get data(){let e=this.root;for(const n of this.path)e=e?.[n];return e}get propString(){return Vn(this.path)}reject(e){return this.error(e),!1}mustBe(e){return this.error(e),!1}error(e){const n=typeof e=="object"?e.code?e:{...e,code:"predicate"}:{code:"predicate",expected:e};return this.errorFromContext(n)}hasError(){return this.currentErrorCount!==0}get currentBranch(){return this.branches.at(-1)}queueMorphs(e){const n={path:new Yl(...this.path),morphs:e};this.currentBranch?this.currentBranch.queuedMorphs.push(n):this.queuedMorphs.push(n)}finalize(e){return this.queuedMorphs.length&&(typeof this.root=="object"&&this.root!==null&&this.config.clone&&(this.root=this.config.clone(this.root)),this.applyQueuedMorphs()),this.hasError()?e?e(this.errors):this.errors:this.root}get currentErrorCount(){return this.currentBranch?this.currentBranch.error?1:0:this.errors.count}get failFast(){return this.branches.length!==0}pushBranch(){this.branches.push({error:void 0,queuedMorphs:[]})}popBranch(){return this.branches.pop()}get external(){return this}errorFromNodeContext(e){return this.errorFromContext(e)}errorFromContext(e){const n=new tn(e,this);return this.currentBranch?this.currentBranch.error=n:this.errors.add(n),n}applyQueuedMorphs(){for(;this.queuedMorphs.length;){const e=this.queuedMorphs;this.queuedMorphs=[];for(const{path:n,morphs:r}of e)this.errors.affectsPath(n)||this.applyMorphsAtPath(n,r)}}applyMorphsAtPath(e,n){const r=e.at(-1);let i;if(r!==void 0){i=this.root;for(let s=0;s<e.length-1;s++)i=i[e[s]]}this.path=[...e];for(const s of n){const o=ue(s),a=s(i===void 0?this.root:i[r],this);if(a instanceof tn){this.errors.add(a);break}if(a instanceof et){o||this.errors.merge(a);break}i===void 0?this.root=a:i[r]=a,this.applyQueuedMorphs()}}}const tt=(t,e,n)=>{if(!n)return e();n.path.push(t);const r=e();return n.path.pop(),r};class ac extends an{attachments;$;onFail;includesTransform;includesContextualPredicate;isCyclic;allowsRequiresContext;rootApplyStrategy;contextFreeMorph;rootApply;referencesById;shallowReferences;flatRefs;flatMorphs;allows;get shallowMorphs(){return[]}constructor(e,n){super((i,s,o=this.onFail)=>s?(this.traverseApply(i,s),s.hasError()?s.errors:s.data):this.rootApply(i,o),{attach:e}),this.attachments=e,this.$=n,this.onFail=this.meta.onFail??this.$.resolvedConfig.onFail,this.includesTransform=this.hasKind("morph")||this.hasKind("structure")&&this.structuralMorph!==void 0,this.includesContextualPredicate=this.hasKind("predicate")&&this.inner.predicate.length!==1,this.isCyclic=this.kind==="alias",this.referencesById={[this.id]:this},this.shallowReferences=this.hasKind("structure")?[this,...this.children]:this.children.reduce((i,s)=>yp(i,s.shallowReferences),[this]);const r=this.isStructural();this.flatRefs=[],this.flatMorphs=[];for(let i=0;i<this.children.length;i++){if(this.includesTransform||=this.children[i].includesTransform,this.includesContextualPredicate||=this.children[i].includesContextualPredicate,this.isCyclic||=this.children[i].isCyclic,!r){const s=this.children[i].flatRefs;for(let o=0;o<s.length;o++){const a=s[o];if(!this.flatRefs.some(l=>lc(l,a))){this.flatRefs.push(a);for(const l of a.node.branches)(l.hasKind("morph")||l.hasKind("intersection")&&l.structure?.structuralMorph!==void 0)&&this.flatMorphs.push({path:a.path,propString:a.propString,node:l})}}}Object.assign(this.referencesById,this.children[i].referencesById)}this.flatRefs.sort((i,s)=>i.path.length>s.path.length?1:i.path.length<s.path.length?-1:i.propString>s.propString?1:i.propString<s.propString||i.node.expression<s.node.expression?-1:1),this.allowsRequiresContext=this.includesContextualPredicate||this.isCyclic,this.rootApplyStrategy=!this.allowsRequiresContext&&this.flatMorphs.length===0?this.shallowMorphs.length===0?"allows":this.shallowMorphs.every(i=>i.length===1||i.name==="$arkStructuralMorph")?this.hasKind("union")?this.branches.some(i=>i.shallowMorphs.length>1)?"contextual":"branchedOptimistic":this.shallowMorphs.length>1?"contextual":"optimistic":"contextual":"contextual",this.rootApply=this.createRootApply(),this.allows=this.allowsRequiresContext?i=>this.traverseAllows(i,new Ft(i,this.$.resolvedConfig)):i=>this.traverseAllows(i)}createRootApply(){switch(this.rootApplyStrategy){case"allows":return(n,r)=>{if(this.allows(n))return n;const i=new Ft(n,this.$.resolvedConfig);return this.traverseApply(n,i),i.finalize(r)};case"contextual":return(n,r)=>{const i=new Ft(n,this.$.resolvedConfig);return this.traverseApply(n,i),i.finalize(r)};case"optimistic":this.contextFreeMorph=this.shallowMorphs[0];const e=this.$.resolvedConfig.clone;return(n,r)=>{if(this.allows(n))return this.contextFreeMorph(e&&(typeof n=="object"&&n!==null||typeof n=="function")?e(n):n);const i=new Ft(n,this.$.resolvedConfig);return this.traverseApply(n,i),i.finalize(r)};case"branchedOptimistic":return this.createBranchedOptimisticRootApply();default:return this.rootApplyStrategy,G(`Unexpected rootApplyStrategy ${this.rootApplyStrategy}`)}}compiledMeta=bp(this.metaJson);cacheGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}get description(){return this.cacheGetter("description",this.meta?.description??this.$.resolvedConfig[this.kind].description(this))}get references(){return Object.values(this.referencesById)}precedence=Ir(this.kind);precompilation;assert=(e,n)=>this(e,n,r=>r.throw());traverse(e,n){return this(e,n,null)}get in(){return this.cacheGetter("in",this.getIo("in"))}get out(){return this.cacheGetter("out",this.getIo("out"))}getIo(e){if(!this.includesTransform)return this;const n={};for(const[r,i]of this.innerEntries){const s=this.impl.keys[r];if(s.reduceIo)s.reduceIo(e,n,i);else if(s.child){const o=i;n[r]=oe(o)?o.map(a=>a[e]):o[e]}else n[r]=i}return this.$.node(this.kind,n)}toJSON(){return this.json}toString(){return`Type<${this.expression}>`}equals(e){const n=ue(e)?e:this.$.parseDefinition(e);return this.innerHash===n.innerHash}ifEquals(e){return this.equals(e)?this:void 0}hasKind(e){return this.kind===e}assertHasKind(e){return this.kind!==e&&Xt(`${this.kind} node was not of asserted kind ${e}`),this}hasKindIn(...e){return e.includes(this.kind)}assertHasKindIn(...e){return mt(e,this.kind)||Xt(`${this.kind} node was not one of asserted kinds ${e}`),this}isBasis(){return mt(ap,this.kind)}isConstraint(){return mt(Rs,this.kind)}isStructural(){return mt(Ur,this.kind)}isRefinement(){return mt(rc,this.kind)}isRoot(){return mt(jr,this.kind)}isUnknown(){return this.hasKind("intersection")&&this.children.length===0}isNever(){return this.hasKind("union")&&this.children.length===0}hasUnit(e){return this.hasKind("unit")&&this.allows(e)}hasOpenIntersection(){return this.impl.intersectionIsOpen}get nestableExpression(){return this.expression}select(e){const n=_n.normalize(e);return this._select(n)}_select(e){let n=_n.applyBoundary[e.boundary??"references"](this);return e.kind&&(n=n.filter(r=>r.kind===e.kind)),e.where&&(n=n.filter(e.where)),_n.applyMethod[e.method??"filter"](n,this,e)}transform(e,n){return this._transform(e,this._createTransformContext(n))}_createTransformContext(e){return{root:this,selected:void 0,seen:{},path:[],parseOptions:{prereduced:e?.prereduced??!1},undeclaredKeyHandling:void 0,...e}}_transform(e,n){const r=n.bindScope??this.$;if(n.seen[this.id])return this.$.lazilyResolve(n.seen[this.id]);if(n.shouldTransform?.(this,n)===!1)return this;let i;n.seen[this.id]=()=>i,this.hasKind("structure")&&this.undeclared!==n.undeclaredKeyHandling&&(n={...n,undeclaredKeyHandling:this.undeclared});const s=z(this.inner,(u,f)=>{if(!this.impl.keys[u].child)return[u,f];const d=f;if(!oe(d)){const p=d._transform(e,n);return p?[u,p]:[]}if(d.length===0)return[u,f];const m=d.flatMap(p=>p._transform(e,n)??[]);return m.length?[u,m]:[]});delete n.seen[this.id];const o=Object.assign(s,{meta:this.meta}),a=n.selected&&!n.selected.includes(this)?o:e(this.kind,o,n);if(a===null)return null;if(ue(a))return i=a;const l=Object.keys(a);return(l.length===0||l.length===1&&l[0]==="meta")&&!Un(this.inner)?null:(this.kind==="required"||this.kind==="optional"||this.kind==="index")&&!("value"in a)?n.undeclaredKeyHandling?{...a,value:y.intrinsic.unknown}:null:(this.kind==="morph"&&(a.in??=y.intrinsic.unknown),i=r.node(this.kind,a,n.parseOptions))}configureReferences(e,n="references"){const r=_n.normalize(n),i=typeof e=="string"?(l,c)=>({...c,meta:{...c.meta,description:e}}):typeof e=="function"?(l,c)=>({...c,meta:e(c.meta)}):(l,c)=>({...c,meta:{...c.meta,...e}});if(r.boundary==="self")return this.$.node(this.kind,i(this.kind,{...this.inner,meta:this.meta}));const s=this._select(r),o=s&&Fn(s),a=r.boundary==="child"?(l,c)=>c.root.children.includes(l):r.boundary==="shallow"?l=>l.kind!=="structure":()=>!0;return this.$.finalize(this.transform(i,{shouldTransform:a,selected:o}))}}const _n={applyBoundary:{self:t=>[t],child:t=>[...t.children],shallow:t=>[...t.shallowReferences],references:t=>[...t.references]},applyMethod:{filter:t=>t,assertFilter:(t,e,n)=>(t.length===0&&Xt(Ho(e,n)),t),find:t=>t[0],assertFind:(t,e,n)=>(t.length===0&&Xt(Ho(e,n)),t[0])},normalize:t=>typeof t=="function"?{boundary:"references",method:"filter",where:t}:typeof t=="string"?Ke(t,_n.applyBoundary)?{method:"filter",boundary:t}:{boundary:"references",method:"filter",kind:t}:{boundary:"references",method:"filter",...t}},Ho=(t,e)=>`${t} had no references matching ${L(e)}.`,mp=t=>Vn(t,{stringifyNonKey:e=>e.expression}),gp=/"(\$ark\.[^"]+)"/g,bp=t=>JSON.stringify(t).replaceAll(gp,"$1"),ct=(t,e)=>({path:t,node:e,propString:mp(t)}),lc=(t,e)=>t.propString===e.propString&&t.node.equals(e.node),Vo=(t,e)=>xt(t,e,{isEqual:lc}),yp=(t,e)=>xt(t,e,{isEqual:(n,r)=>n.equals(r)});class x extends Array{static init(e,n,r,i){return new x({kind:e,l:n,r,path:i?.path??[],optional:i?.optional??!1})}add(e,n,r,i){return this.push({kind:e,l:n,r,path:i?.path??[],optional:i?.optional??!1}),this}get summary(){return this.describeReasons()}describeReasons(){if(this.length===1){const{path:e,l:n,r}=this[0],i=Vn(e);return cc(`Intersection${i&&` at ${i}`} of ${Jo(n,r)}`)}return`The following intersections result in unsatisfiable types:
• ${this.map(({path:e,l:n,r})=>`${e}: ${Jo(n,r)}`).join(`
• `)}`}throw(){return b(this.describeReasons())}invert(){const e=this.map(n=>({...n,l:n.r,r:n.l}));return e instanceof x?e:new x(...e)}withPrefixKey(e,n){return this.map(r=>({...r,path:[e,...r.path],optional:r.optional||n==="optional"}))}toNeverIfDisjoint(){return y.intrinsic.never}}const Jo=(t,e)=>`${Gi(t)} and ${Gi(e)}`,Gi=t=>ue(t)?t.expression:oe(t)?t.map(Gi).join(" | ")||"never":String(t),cc=t=>`${t} results in an unsatisfiable type`,Bt={},nt=(t,e,n)=>ne(t,e,{$:n,invert:!1,pipe:!1}),Wi=(t,e,n)=>ne(t,e,{$:n,invert:!1,pipe:!0}),ne=((t,e,n)=>{const r=n.pipe?"|>":"&",i=`${t.hash}${r}${e.hash}`;if(Bt[i]!==void 0)return Bt[i];if(!n.pipe){const a=`${e.hash}${r}${t.hash}`;if(Bt[a]!==void 0){const l=Bt[a],c=l instanceof x?l.invert():l;return Bt[i]=c,c}}const s=!n.pipe||!t.includesTransform&&!e.includesTransform;if(s&&t.equals(e))return t;let o=s?Zi(t,e,n):t.hasKindIn(...jr)?vp(t,e,n):Zi(t,e,n);return ue(o)&&(t.equals(o)?o=t:e.equals(o)&&(o=e)),Bt[i]=o,o}),Zi=(t,e,n)=>{const r=t.precedence<e.precedence?t.kind:e.kind,i=t.impl.intersections[e.kind]??e.impl.intersections[t.kind];if(i===void 0)return null;if(r===t.kind)return i(t,e,n);{let s=i(e,t,{...n,invert:!n.invert});return s instanceof x&&(s=s.invert()),s}},vp=(t,e,n)=>t.includesTransform||e.includesTransform?n.invert?Go(e,t,n):Go(t,e,n):Zi(t,e,n),Go=(t,e,n)=>t.distribute(r=>kp(r,e,n),r=>{const i=r.filter(ue);if(i.length===0)return x.init("union",t.branches,e.branches);if(i.length<t.branches.length||!t.branches.every((o,a)=>o.in.equals(i[a].in)))return n.$.parseSchema(i);if(i.length===1)return i[0];const s={branches:i};return n.$.parseSchema(s)}),kp=(t,e,n)=>{if(t.hasKind("morph")){const i=[...t.morphs];if(t.lastMorphIfNode){const s=ne(t.lastMorphIfNode,e,n);if(s instanceof x)return s;i[i.length-1]=s}else i.push(e);return n.$.node("morph",{morphs:i,in:t.inner.in})}if(e.hasKind("morph")){const i=ne(t,e.in,n);return i instanceof x?i:n.$.node("morph",{morphs:[e],in:i})}return n.$.node("morph",{morphs:[e],in:t})};class ln extends ac{constructor(e,n){super(e,n),Object.defineProperty(this,Qe,{value:"constraint",enumerable:!1})}impliedSiblings;intersect(e){return nt(this,e,this.$)}}class Vr extends ln{traverseApply=(e,n)=>{this.traverseAllows(e,n)||n.errorFromNodeContext(this.errorContext)};compile(e){e.traversalKind==="Allows"?e.return(this.compiledCondition):e.if(this.compiledNegation,()=>e.line(`${e.ctx}.errorFromNodeContext(${this.compiledErrorContext})`))}get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return Hr(this.errorContext)}}const ge=t=>(e,n)=>{if(oe(e)){if(e.length===0)return;const i=e.map(s=>n.$.node(t,s));return t==="predicate"?i:i.sort((s,o)=>s.hash<o.hash?-1:1)}const r=n.$.node(t,e);return r.hasOpenIntersection()?[r]:r},Rr=t=>{const e=t.r.shift();if(!e){let r=t.l.length===0&&t.kind==="structure"?y.intrinsic.unknown.internal:t.ctx.$.node(t.kind,Object.assign(t.baseInner,xp(t.l)),{prereduced:!0});for(const i of t.roots){if(r instanceof x)return r;r=ne(i,r,t.ctx)}return r}let n=!1;for(let r=0;r<t.l.length;r++){const i=ne(t.l[r],e,t.ctx);if(i!==null){if(i instanceof x)return i;if(n){if(!t.l.includes(i))return G(`Unexpectedly encountered multiple distinct intersection results for refinement ${i}`)}else{if(i.isRoot())return t.roots.push(i),t.l.splice(r),Rr(t);t.l[r]=i,n=!0}}}if(n||t.l.push(e),t.kind==="intersection"&&e.impliedSiblings)for(const r of e.impliedSiblings)xt(t.r,r);return Rr(t)},Or=t=>Object.entries(t).flatMap(([n,r])=>n in ic?r:[]).sort((n,r)=>n.precedence<r.precedence?-1:n.precedence>r.precedence?1:n.kind==="predicate"&&r.kind==="predicate"?0:n.hash<r.hash?-1:1),xp=t=>{const e={};for(const n of t)if(n.hasOpenIntersection())e[n.kind]=P(e[n.kind],n);else{if(e[n.kind])return G(`Unexpected intersection of closed refinements of kind ${n.kind}`);e[n.kind]=n}return e},wp=(...t)=>b($p(...t)),$p=(t,e,n)=>{const r=n.hasKind("morph")?"a morph":n.isUnknown()?"unknown":n.exclude(e).defaultShortDescription;return`${Cd(t)} operand must be ${e.description} (was ${r})`},_p=(t,e,n)=>new Cr(t,e,n,n,null);class uc extends an{}class Cr extends an{[Qe]="generic";paramDefs;bodyDef;$;arg$;baseInstantiation;hkt;description;constructor(e,n,r,i,s){super((...o)=>{const a=z(this.names,(l,c)=>{const u=this.arg$.parse(o[l]);return u.extends(this.constraints[l])||b(Ap(c,this.constraints[l].expression,u.expression)),[c,u]});if(this.defIsLazy()){const l=this.bodyDef(a);return this.$.parse(l)}return this.$.parse(n,{args:a})}),this.paramDefs=e,this.bodyDef=n,this.$=r,this.arg$=i,this.hkt=s,this.description=s?new s().description??`a generic type for ${s.constructor.name}`:"a generic type",this.baseInstantiation=this(...this.constraints)}defIsLazy(){return this.bodyDef instanceof uc}cacheGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}get json(){return this.cacheGetter("json",{params:this.params.map(e=>e[1].isUnknown()?e[0]:[e[0],e[1].json]),body:Qd(this.bodyDef)})}get params(){return this.cacheGetter("params",this.paramDefs.map(e=>typeof e=="string"?[e,y.intrinsic.unknown]:[e[0],this.$.parse(e[1])]))}get names(){return this.cacheGetter("names",this.params.map(e=>e[0]))}get constraints(){return this.cacheGetter("constraints",this.params.map(e=>e[1]))}get internal(){return this}get referencesById(){return this.baseInstantiation.internal.referencesById}get references(){return this.baseInstantiation.internal.references}}const Ap=(t,e,n)=>`${t} must be assignable to ${e} (was ${n})`,Sp=U({kind:"predicate",hasAssociatedError:!0,collapsibleKey:"predicate",keys:{predicate:{}},normalize:t=>typeof t=="function"?{predicate:t}:t,defaults:{description:t=>`valid according to ${t.predicate.name||"an anonymous predicate"}`},intersectionIsOpen:!0,intersections:{predicate:()=>null}});class Ep extends ln{serializedPredicate=fe(this.predicate);compiledCondition=`${this.serializedPredicate}(data, ctx)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=null;expression=this.serializedPredicate;traverseAllows=this.predicate;errorContext={code:"predicate",description:this.description,meta:this.meta};compiledErrorContext=Hr(this.errorContext);traverseApply=(e,n)=>{!this.predicate(e,n.external)&&!n.hasError()&&n.errorFromNodeContext(this.errorContext)};compile(e){if(e.traversalKind==="Allows"){e.return(this.compiledCondition);return}e.if(`${this.compiledNegation} && !ctx.hasError()`,()=>e.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}reduceJsonSchema(e,n){return n.fallback.predicate({code:"predicate",base:e,predicate:this.predicate})}}const hc={implementation:Sp,Node:Ep},Np=U({kind:"divisor",collapsibleKey:"rule",keys:{rule:{parse:t=>Number.isInteger(t)?t:b(Ip(t))}},normalize:t=>typeof t=="number"?{rule:t}:t,hasAssociatedError:!0,defaults:{description:t=>t.rule===1?"an integer":t.rule===2?"even":`a multiple of ${t.rule}`},intersections:{divisor:(t,e,n)=>n.$.node("divisor",{rule:Math.abs(t.rule*e.rule/Rp(t.rule,e.rule))})},obviatesBasisDescription:!0});class Tp extends Vr{traverseAllows=e=>e%this.rule===0;compiledCondition=`data % ${this.rule} === 0`;compiledNegation=`data % ${this.rule} !== 0`;impliedBasis=y.intrinsic.number.internal;expression=`% ${this.rule}`;reduceJsonSchema(e){return e.type="integer",this.rule===1||(e.multipleOf=this.rule),e}}const fc={implementation:Np,Node:Tp},Ip=t=>`divisor must be an integer (was ${t})`,Rp=(t,e)=>{let n,r=t,i=e;for(;i!==0;)n=i,i=r%i,r=n;return r};class cn extends Vr{boundOperandKind=Dp[this.kind];compiledActual=this.boundOperandKind==="value"?"data":this.boundOperandKind==="length"?"data.length":"data.valueOf()";comparator=Lp(this.kind,this.exclusive);numericLimit=this.rule.valueOf();expression=`${this.comparator} ${this.rule}`;compiledCondition=`${this.compiledActual} ${this.comparator} ${this.numericLimit}`;compiledNegation=`${this.compiledActual} ${Op[this.comparator]} ${this.numericLimit}`;stringLimit=this.boundOperandKind==="date"?Pp(this.numericLimit):`${this.numericLimit}`;limitKind=this.comparator[0]==="<"?"upper":"lower";isStricterThan(e){return(this.limitKind==="upper"?this.numericLimit<e.numericLimit:this.numericLimit>e.numericLimit)||this.numericLimit===e.numericLimit&&this.exclusive===!0&&!e.exclusive}overlapsRange(e){return!(this.isStricterThan(e)||this.numericLimit===e.numericLimit&&(this.exclusive||e.exclusive))}overlapIsUnit(e){return this.numericLimit===e.numericLimit&&!this.exclusive&&!e.exclusive}}const Op={"<":">=","<=":">",">":"<=",">=":"<"},Cp={min:"max",minLength:"maxLength",after:"before"},dc={parse:t=>t||void 0},pc=t=>e=>{if(typeof e=="number")return{rule:e};const{exclusive:n,...r}=e;return n?{...r,rule:t==="minLength"?r.rule+1:r.rule-1}:r},mc=t=>e=>{if(typeof e=="number"||typeof e=="string"||e instanceof Date)return{rule:e};const{exclusive:n,...r}=e;if(!n)return r;const i=typeof r.rule=="number"?r.rule:typeof r.rule=="string"?new Date(r.rule).valueOf():r.rule.valueOf();return n?{...r,rule:t==="after"?i+1:i-1}:r},gc=t=>typeof t=="string"||typeof t=="number"?new Date(t):t,Mp=(t,e)=>`${t} bound must be a positive integer (was ${e})`,Cs=t=>e=>((!Number.isInteger(e)||e<0)&&b(Mp(t,e)),e),Dp={min:"value",max:"value",minLength:"length",maxLength:"length",after:"date",before:"date"},Lp=(t,e)=>`${Ke(t,Cp)?">":"<"}${e?"":"="}`,Pp=t=>typeof t=="string"?t:new Date(t).toLocaleString(),zp=t=>`Bounded expression ${t} must be exactly one of number, string, Array, or Date`,qp=U({kind:"after",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:gc,serialize:t=>t.toISOString()}},normalize:mc("after"),defaults:{description:t=>`${t.collapsibleLimitString} or later`,actual:Hn},intersections:{after:(t,e)=>t.isStricterThan(e)?t:e}});class Bp extends cn{impliedBasis=y.intrinsic.Date.internal;collapsibleLimitString=Hn(this.rule);traverseAllows=e=>e>=this.rule;reduceJsonSchema(e,n){return n.fallback.date({code:"date",base:e,after:this.rule})}}const bc={implementation:qp,Node:Bp},Kp=U({kind:"before",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:gc,serialize:t=>t.toISOString()}},normalize:mc("before"),defaults:{description:t=>`${t.collapsibleLimitString} or earlier`,actual:Hn},intersections:{before:(t,e)=>t.isStricterThan(e)?t:e,after:(t,e,n)=>t.overlapsRange(e)?t.overlapIsUnit(e)?n.$.node("unit",{unit:t.rule}):null:x.init("range",t,e)}});class Fp extends cn{collapsibleLimitString=Hn(this.rule);traverseAllows=e=>e<=this.rule;impliedBasis=y.intrinsic.Date.internal;reduceJsonSchema(e,n){return n.fallback.date({code:"date",base:e,before:this.rule})}}const yc={implementation:Kp,Node:Fp},Up=U({kind:"exactLength",collapsibleKey:"rule",keys:{rule:{parse:Cs("exactLength")}},normalize:t=>typeof t=="number"?{rule:t}:t,hasAssociatedError:!0,defaults:{description:t=>`exactly length ${t.rule}`,actual:t=>`${t.length}`},intersections:{exactLength:(t,e,n)=>x.init("unit",n.$.node("unit",{unit:t.rule}),n.$.node("unit",{unit:e.rule}),{path:["length"]}),minLength:(t,e)=>t.rule>=e.rule?t:x.init("range",t,e),maxLength:(t,e)=>t.rule<=e.rule?t:x.init("range",t,e)}});class jp extends Vr{traverseAllows=e=>e.length===this.rule;compiledCondition=`data.length === ${this.rule}`;compiledNegation=`data.length !== ${this.rule}`;impliedBasis=y.intrinsic.lengthBoundable.internal;expression=`== ${this.rule}`;reduceJsonSchema(e){switch(e.type){case"string":return e.minLength=this.rule,e.maxLength=this.rule,e;case"array":return e.minItems=this.rule,e.maxItems=this.rule,e;default:return X.throwInternalOperandError("exactLength",e)}}}const vc={implementation:Up,Node:jp},Hp=U({kind:"max",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:dc},normalize:t=>typeof t=="number"?{rule:t}:t,defaults:{description:t=>t.rule===0?t.exclusive?"negative":"non-positive":`${t.exclusive?"less than":"at most"} ${t.rule}`},intersections:{max:(t,e)=>t.isStricterThan(e)?t:e,min:(t,e,n)=>t.overlapsRange(e)?t.overlapIsUnit(e)?n.$.node("unit",{unit:t.rule}):null:x.init("range",t,e)},obviatesBasisDescription:!0});class Vp extends cn{impliedBasis=y.intrinsic.number.internal;traverseAllows=this.exclusive?e=>e<this.rule:e=>e<=this.rule;reduceJsonSchema(e){return this.exclusive?e.exclusiveMaximum=this.rule:e.maximum=this.rule,e}}const kc={implementation:Hp,Node:Vp},Jp=U({kind:"maxLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Cs("maxLength")}},reduce:(t,e)=>t.rule===0?e.node("exactLength",t):void 0,normalize:pc("maxLength"),defaults:{description:t=>`at most length ${t.rule}`,actual:t=>`${t.length}`},intersections:{maxLength:(t,e)=>t.isStricterThan(e)?t:e,minLength:(t,e,n)=>t.overlapsRange(e)?t.overlapIsUnit(e)?n.$.node("exactLength",{rule:t.rule}):null:x.init("range",t,e)}});class Gp extends cn{impliedBasis=y.intrinsic.lengthBoundable.internal;traverseAllows=e=>e.length<=this.rule;reduceJsonSchema(e){switch(e.type){case"string":return e.maxLength=this.rule,e;case"array":return e.maxItems=this.rule,e;default:return X.throwInternalOperandError("maxLength",e)}}}const xc={implementation:Jp,Node:Gp},Wp=U({kind:"min",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:dc},normalize:t=>typeof t=="number"?{rule:t}:t,defaults:{description:t=>t.rule===0?t.exclusive?"positive":"non-negative":`${t.exclusive?"more than":"at least"} ${t.rule}`},intersections:{min:(t,e)=>t.isStricterThan(e)?t:e},obviatesBasisDescription:!0});class Zp extends cn{impliedBasis=y.intrinsic.number.internal;traverseAllows=this.exclusive?e=>e>this.rule:e=>e>=this.rule;reduceJsonSchema(e){return this.exclusive?e.exclusiveMinimum=this.rule:e.minimum=this.rule,e}}const wc={implementation:Wp,Node:Zp},Yp=U({kind:"minLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Cs("minLength")}},reduce:t=>t.rule===0?y.intrinsic.unknown:void 0,normalize:pc("minLength"),defaults:{description:t=>t.rule===1?"non-empty":`at least length ${t.rule}`,actual:t=>t.length===0?"":`${t.length}`},intersections:{minLength:(t,e)=>t.isStricterThan(e)?t:e}});class Xp extends cn{impliedBasis=y.intrinsic.lengthBoundable.internal;traverseAllows=e=>e.length>=this.rule;reduceJsonSchema(e){switch(e.type){case"string":return e.minLength=this.rule,e;case"array":return e.minItems=this.rule,e;default:return X.throwInternalOperandError("minLength",e)}}}const $c={implementation:Yp,Node:Xp},Qp={min:wc.implementation,max:kc.implementation,minLength:$c.implementation,maxLength:xc.implementation,exactLength:vc.implementation,after:bc.implementation,before:yc.implementation},em={min:wc.Node,max:kc.Node,minLength:$c.Node,maxLength:xc.Node,exactLength:vc.Node,after:bc.Node,before:yc.Node},tm=U({kind:"pattern",collapsibleKey:"rule",keys:{rule:{},flags:{}},normalize:t=>typeof t=="string"?{rule:t}:t instanceof RegExp?t.flags?{rule:t.source,flags:t.flags}:{rule:t.source}:t,obviatesBasisDescription:!0,obviatesBasisExpression:!0,hasAssociatedError:!0,intersectionIsOpen:!0,defaults:{description:t=>`matched by ${t.rule}`},intersections:{pattern:()=>null}});class nm extends Vr{instance=new RegExp(this.rule,this.flags);expression=`${this.instance}`;traverseAllows=this.instance.test.bind(this.instance);compiledCondition=`${this.expression}.test(data)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=y.intrinsic.string.internal;reduceJsonSchema(e,n){return e.pattern?n.fallback.patternIntersection({code:"patternIntersection",base:e,pattern:this.rule}):(e.pattern=this.rule,e)}}const _c={implementation:tm,Node:nm},kr=(t,e)=>{const n=rm(t);return e&&!e.includes(n)?b(`Root of kind ${n} should be one of ${e}`):n},rm=t=>{if($(t,"root"))return t.kind;if(typeof t=="string")return t[0]==="$"?"alias":t in Xe?"domain":"proto";if(typeof t=="function")return"proto";if(typeof t!="object"||t===null)return b(Wo(t));if("morphs"in t)return"morph";if("branches"in t||oe(t))return"union";if("unit"in t)return"unit";if("reference"in t)return"alias";const e=Object.keys(t);return e.length===0||e.some(n=>n in ic)?"intersection":"proto"in t?"proto":"domain"in t?"domain":b(Wo(t))},Wo=t=>`${L(t)} is not a valid type schema`,Zo={},im=t=>oe(t)?t.map(e=>e.collapsibleJson):t.collapsibleJson,Se={};y.nodesByRegisteredId=Se;const Ac=t=>(Zo[t]??=0,`${t}${++Zo[t]}`),Sc=t=>{const e=Jr[t.kind],n=e.applyConfig?.(t.def,t.$.resolvedConfig)??t.def,r={},{meta:i,...s}=n,o=i===void 0?{}:typeof i=="string"?{description:i}:i,a=ql(s).sort(([c],[u])=>vr(c)?vr(u)?Ir(c)-Ir(u):1:vr(u)||c<u?-1:1).filter(([c,u])=>{if(c.startsWith("meta.")){const f=c.slice(5);return o[f]=u,!1}return!0});for(const c of a){const u=c[0],f=e.keys[u];if(!f)return b(`Key ${u} is not valid on ${t.kind} schema`);const d=f.parse?f.parse(c[1],t):c[1];d!==Je&&(d!==void 0||f.preserveUndefined)&&(r[u]=d)}if(e.reduce&&!t.prereduced){const c=e.reduce(r,t.$);if(c)return c instanceof x?c.throw():om(c,o)}return Ms({id:t.id,kind:t.kind,inner:r,meta:o,$:t.$})},Ms=({id:t,kind:e,inner:n,meta:r,$:i,ignoreCache:s})=>{const o=Jr[e],a=ql(n),l=[];let c={};for(const[E,A]of a){const N=o.keys[E],I=N.serialize??(N.child?im:St);if(c[E]=I(A),N.child===!0){const j=A;oe(j)?l.push(...j):l.push(j)}else typeof N.child=="function"&&l.push(...N.child(A))}o.finalizeInnerJson&&(c=o.finalizeInnerJson(c));let u={...c},f={};Un(r)||(f=z(r,(E,A)=>[E,E==="examples"?A:St(A)]),u.meta=hr(f,"description",!0)),c=hr(c,o.collapsibleKey,!1);const d=JSON.stringify({kind:e,...c});u=hr(u,o.collapsibleKey,!1);const m=hr(u,o.collapsibleKey,!0),p=JSON.stringify({kind:e,...u});if(i.nodesByHash[p]&&!s)return i.nodesByHash[p];const v={id:t,kind:e,impl:o,inner:n,innerEntries:a,innerJson:c,innerHash:d,meta:r,metaJson:f,json:u,hash:p,collapsibleJson:m,children:l};if(e!=="intersection")for(const E in n)E!=="in"&&E!=="out"&&(v[E]=n[E]);const _=new fg[e](v,i);return i.nodesByHash[p]=_},sm=(t,e)=>t.id===e?t:(ue(Se[e])&&G(`Unexpected attempt to overwrite node id ${e}`),Ms({id:e,kind:t.kind,inner:t.inner,meta:t.meta,$:t.$,ignoreCache:!0})),om=(t,e,n)=>Ms({id:Ac(e.alias??t.kind),kind:t.kind,inner:t.inner,meta:e,$:t.$}),hr=(t,e,n)=>{const r=Object.keys(t);if(r.length===1&&r[0]===e){const i=t[e];if(n||It(i,"object")&&(Object.keys(i).length===1||Array.isArray(i)))return i}return t},Yi=(t,e,n)=>{if(t.key!==e.key)return null;const r=t.key;let i=ne(t.value,e.value,n);const s=t.required||e.required?"required":"optional";if(i instanceof x)if(s==="optional")i=y.intrinsic.never.internal;else return i.withPrefixKey(t.key,t.required&&e.required?"required":"optional");if(s==="required")return n.$.node("required",{key:r,value:i});const o=t.hasDefault()?e.hasDefault()?t.default===e.default?t.default:b(Nc(t.default,e.default)):t.default:e.hasDefault()?e.default:Je;return n.$.node("optional",{key:r,value:i,default:o})};class Ec extends ln{required=this.kind==="required";optional=this.kind==="optional";impliedBasis=y.intrinsic.object.internal;serializedKey=Jn(this.key);compiledKey=typeof this.key=="string"?this.key:this.serializedKey;flatRefs=P(this.value.flatRefs.map(e=>ct([this.key,...e.path],e.node)),ct([this.key],this.value));_transform(e,n){n.path.push(this.key);const r=super._transform(e,n);return n.path.pop(),r}hasDefault(){return"default"in this.inner}traverseAllows=(e,n)=>this.key in e?tt(this.key,()=>this.value.traverseAllows(e[this.key],n),n):this.optional;traverseApply=(e,n)=>{this.key in e?tt(this.key,()=>this.value.traverseApply(e[this.key],n),n):this.hasKind("required")&&n.errorFromNodeContext(this.errorContext)};compile(e){e.if(`${this.serializedKey} in data`,()=>e.traverseKey(this.serializedKey,`data${e.prop(this.key)}`,this.value)),this.hasKind("required")&&e.else(()=>e.traversalKind==="Apply"?e.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`):e.return(!1)),e.traversalKind==="Allows"&&e.return(!0)}}const Nc=(t,e)=>`Invalid intersection of default values ${L(t)} & ${L(e)}`,am=U({kind:"optional",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(t,e)=>e.$.parseSchema(t)},default:{preserveUndefined:!0}},normalize:t=>t,reduce:(t,e)=>{if(e.resolvedConfig.exactOptionalPropertyTypes===!1&&!t.value.allows(void 0))return e.node("optional",{...t,value:t.value.or(S.undefined)},{prereduced:!0})},defaults:{description:t=>`${t.compiledKey}?: ${t.value.description}`},intersections:{optional:Yi}});class lm extends Ec{constructor(...e){super(...e),"default"in this.inner&&Ls(this.value,this.inner.default,this.key)}get outProp(){if(!this.hasDefault())return this;const{default:e,...n}=this.inner;return this.cacheGetter("outProp",this.$.node("required",n,{prereduced:!0}))}expression=this.hasDefault()?`${this.compiledKey}: ${this.value.expression} = ${L(this.inner.default)}`:`${this.compiledKey}?: ${this.value.expression}`;defaultValueMorph=um(this);defaultValueMorphRef=this.defaultValueMorph&&fe(this.defaultValueMorph)}const Ds={implementation:am,Node:lm},cm={},um=t=>{if(!t.hasDefault())return;const e=`{${t.compiledKey}: ${t.value.id} = ${St(t.default)}}`;return cm[e]??=Tc(t.key,t.value,t.default)},Tc=(t,e,n)=>{if(typeof n=="function")return e.includesTransform?(i,s)=>(tt(t,()=>e(i[t]=n(),s),s),i):i=>(i[t]=n(),i);const r=e.includesTransform?e.assert(n):n;return It(r,"object")?(i,s)=>(tt(t,()=>e(i[t]=n,s),s),i):i=>(i[t]=r,i)},Ls=(t,e,n)=>{const r=Kr(e);It(e,"object")&&!r&&b(hm(n));const i=t.in(r?e():e);if(i instanceof et){n===null&&b(`Default ${i.summary}`);const s=i.transform(o=>o.transform(a=>({...a,prefixPath:[n]})));b(`Default for ${s.summary}`)}return e},hm=t=>`Non-primitive default ${t===null?"":typeof t=="number"?`for value at [${t}] `:`for ${Jn(t)} `}must be specified as a function like () => ({my: 'object'})`;class Gn extends ac{constructor(e,n){super(e,n),Object.defineProperty(this,Qe,{value:"root",enumerable:!1})}get internal(){return this}get"~standard"(){return{vendor:"arktype",version:1,validate:e=>{const n=this(e);return n instanceof et?n:{value:n}}}}as(){return this}brand(e){return e===""?b(fm):this}readonly(){return this}branches=this.hasKind("union")?this.inner.branches:[this];distribute(e,n){const r=this.branches.map(e);return n?.(r)??r}get shortDescription(){return this.meta.description??this.defaultShortDescription}toJsonSchema(e={}){const n=oc(this.$.resolvedConfig.toJsonSchema,e);n.useRefs||=this.isCyclic;const r=typeof n.dialect=="string"?{$schema:n.dialect}:{};return Object.assign(r,this.toJsonSchemaRecurse(n)),n.useRefs&&(r.$defs=z(this.references,(i,s)=>s.isRoot()&&!s.alwaysExpandJsonSchema?[s.id,s.toResolvedJsonSchema(n)]:[])),r}toJsonSchemaRecurse(e){return e.useRefs&&!this.alwaysExpandJsonSchema?{$ref:`#/$defs/${this.id}`}:this.toResolvedJsonSchema(e)}get alwaysExpandJsonSchema(){return this.isBasis()||this.kind==="alias"||this.hasKind("union")&&this.isBoolean}toResolvedJsonSchema(e){const n=this.innerToJsonSchema(e);return Object.assign(n,this.metaJson)}intersect(e){const n=this.$.parseDefinition(e),r=this.rawIntersect(n);return r instanceof x?r:this.$.finalize(r)}rawIntersect(e){return nt(this,e,this.$)}toNeverIfDisjoint(){return this}and(e){const n=this.intersect(e);return n instanceof x?n.throw():n}rawAnd(e){const n=this.rawIntersect(e);return n instanceof x?n.throw():n}or(e){const n=this.$.parseDefinition(e);return this.$.finalize(this.rawOr(n))}rawOr(e){const n=[...this.branches,...e.branches];return this.$.node("union",n)}map(e){return this.$.schema(this.applyStructuralOperation("map",[e]))}pick(...e){return this.$.schema(this.applyStructuralOperation("pick",e))}omit(...e){return this.$.schema(this.applyStructuralOperation("omit",e))}required(){return this.$.schema(this.applyStructuralOperation("required",[]))}partial(){return this.$.schema(this.applyStructuralOperation("partial",[]))}_keyof;keyof(){if(this._keyof)return this._keyof;const e=this.applyStructuralOperation("keyof",[]).reduce((n,r)=>n.intersect(r).toNeverIfDisjoint(),y.intrinsic.unknown.internal);return e.branches.length===0&&b(cc(`keyof ${this.expression}`)),this._keyof=this.$.finalize(e)}get props(){return this.branches.length!==1?b(dm(this.expression)):[...this.applyStructuralOperation("props",[])[0]]}merge(e){const n=this.$.parseDefinition(e);return this.$.schema(n.distribute(r=>this.applyStructuralOperation("merge",[Yo(r)??b(Xo("merge",r.expression))])))}applyStructuralOperation(e,n){return this.distribute(r=>{if(r.equals(y.intrinsic.object)&&e!=="merge")return r;const i=Yo(r);if(i||b(Xo(e,r.expression)),e==="keyof")return i.keyof();if(e==="get")return i.get(...n);if(e==="props")return i.props;const s=e==="required"?"require":e==="partial"?"optionalize":e;return this.$.node("intersection",{...r.inner,structure:i[s](...n)})})}get(...e){return e[0]===void 0?this:this.$.schema(this.applyStructuralOperation("get",e))}extract(e){const n=this.$.parseDefinition(e);return this.$.schema(this.branches.filter(r=>r.extends(n)))}exclude(e){const n=this.$.parseDefinition(e);return this.$.schema(this.branches.filter(r=>!r.extends(n)))}array(){return this.$.schema(this.isUnknown()?{proto:Array}:{proto:Array,sequence:this},{prereduced:!0})}overlaps(e){return!(this.intersect(e)instanceof x)}extends(e){const n=this.intersect(e);return!(n instanceof x)&&this.equals(n)}ifExtends(e){return this.extends(e)?this:void 0}subsumes(e){return this.$.parseDefinition(e).extends(this)}configure(e,n="shallow"){return this.configureReferences(e,n)}describe(e,n="shallow"){return this.configure({description:e},n)}optional(){return[this,"?"]}default(e){return Ls(this,e,null),[this,"=",e]}from(e){return this.assert(e)}_pipe(...e){const n=e.reduce((r,i)=>r.rawPipeOnce(i),this);return this.$.finalize(n)}tryPipe(...e){const n=e.reduce((r,i)=>r.rawPipeOnce($(i,"root")?i:((s,o)=>{try{return i(s,o)}catch(a){return o.error({code:"predicate",predicate:i,actual:`aborted due to error:
    ${a}
`})}})),this);return this.$.finalize(n)}pipe=Object.assign(this._pipe.bind(this),{try:this.tryPipe.bind(this)});to(e){return this.$.finalize(this.toNode(this.$.parseDefinition(e)))}toNode(e){const n=Wi(this,e,this.$);return n instanceof x?n.throw():n}rawPipeOnce(e){return $(e,"root")?this.toNode(e):this.distribute(n=>n.hasKind("morph")?this.$.node("morph",{in:n.inner.in,morphs:[...n.morphs,e]}):this.$.node("morph",{in:n,morphs:[e]}),this.$.parseSchema)}narrow(e){return this.constrainOut("predicate",e)}constrain(e,n){return this._constrain("root",e,n)}constrainIn(e,n){return this._constrain("in",e,n)}constrainOut(e,n){return this._constrain("out",e,n)}_constrain(e,n,r){const i=this.$.node(n,r);if(i.isRoot())return i.isUnknown()?this:G(`Unexpected constraint node ${i}`);const s=e==="root"?this:this[e];if(s.hasKind("morph")||i.impliedBasis&&!s.extends(i.impliedBasis))return wp(n,i.impliedBasis,this);const o=this.$.node("intersection",{[i.kind]:i}),a=e==="out"?Wi(this,o,this.$):nt(this,o,this.$);return a instanceof x&&a.throw(),this.$.finalize(a)}onUndeclaredKey(e){const n=typeof e=="string"?e:e.rule,r=typeof e=="string"?!1:e.deep;return this.$.finalize(this.transform((i,s)=>i==="structure"?n==="ignore"?gd(s,{undeclared:1}):{...s,undeclared:n}:s,r?void 0:{shouldTransform:i=>!mt(Ur,i.kind)}))}hasEqualMorphs(e){return!this.includesTransform&&!e.includesTransform?!0:!(!Yt(this.shallowMorphs,e.shallowMorphs)||!Yt(this.flatMorphs,e.flatMorphs,{isEqual:(n,r)=>n.propString===r.propString&&(n.node.hasKind("morph")&&r.node.hasKind("morph")?n.node.hasEqualMorphs(r.node):n.node.hasKind("intersection")&&r.node.hasKind("intersection")?n.node.structure?.structuralMorphRef===r.node.structure?.structuralMorphRef:!1)}))}onDeepUndeclaredKey(e){return this.onUndeclaredKey({rule:e,deep:!0})}filter(e){return this.constrainIn("predicate",e)}divisibleBy(e){return this.constrain("divisor",e)}matching(e){return this.constrain("pattern",e)}atLeast(e){return this.constrain("min",e)}atMost(e){return this.constrain("max",e)}moreThan(e){return this.constrain("min",Kt(e))}lessThan(e){return this.constrain("max",Kt(e))}atLeastLength(e){return this.constrain("minLength",e)}atMostLength(e){return this.constrain("maxLength",e)}moreThanLength(e){return this.constrain("minLength",Kt(e))}lessThanLength(e){return this.constrain("maxLength",Kt(e))}exactlyLength(e){return this.constrain("exactLength",e)}atOrAfter(e){return this.constrain("after",e)}atOrBefore(e){return this.constrain("before",e)}laterThan(e){return this.constrain("after",Kt(e))}earlierThan(e){return this.constrain("before",Kt(e))}}const fm="Expected a non-empty brand name after #",Kt=t=>typeof t=="object"&&!(t instanceof Date)?{...t,exclusive:!0}:{rule:t,exclusive:!0},fr=(t,e)=>$(e,"root")?$(t,"root")?t.extends(e):e.allows(t):$(t,"root")?t.hasUnit(e):e===t,Yo=t=>t.hasKind("morph")?null:t.hasKind("intersection")?t.inner.structure??(t.basis?.domain==="object"?t.$.bindReference(y.intrinsic.emptyStructure):null):t.isBasis()&&t.domain==="object"?t.$.bindReference(y.intrinsic.emptyStructure):null,dm=t=>`Props cannot be extracted from a union. Use .distribute to extract props from each branch instead. Received:
${t}`,Xo=(t,e)=>`${t} operand must be an object (was ${e})`,Wn=(t,e)=>z(Os(t),(n,r)=>[r,e]),pm=t=>typeof t=="string"?{reference:t}:t,Qo=t=>t instanceof x?y.intrinsic.never.internal:t,mm=U({kind:"alias",hasAssociatedError:!1,collapsibleKey:"reference",keys:{reference:{serialize:t=>t.startsWith("$")?t:`$ark.${t}`},resolve:{}},normalize:pm,defaults:{description:t=>t.reference},intersections:{alias:(t,e,n)=>n.$.lazilyResolve(()=>Qo(ne(t.resolution,e.resolution,n)),`${t.reference}${n.pipe?"=>":"&"}${e.reference}`),...Wn("alias",(t,e,n)=>e.isUnknown()?t:e.isNever()?e:e.isBasis()&&!e.overlaps(y.intrinsic.object)?x.init("assignability",y.intrinsic.object,e):n.$.lazilyResolve(()=>Qo(ne(t.resolution,e,n)),`${t.reference}${n.pipe?"=>":"&"}${e.id}`))}});class gm extends Gn{expression=this.reference;structure=void 0;get resolution(){const e=this._resolve();return Se[this.id]=e}_resolve(){if(this.resolve)return this.resolve();if(this.reference[0]==="$")return this.$.resolveRoot(this.reference.slice(1));const e=this.reference;let n=Se[e];const r=[];for(;$(n,"context");){if(r.includes(n.id))return b(bm(n.id,r));r.push(n.id),n=Se[n.id]}return $(n,"root")?n:G(`Unexpected resolution for reference ${this.reference}
Seen: [${r.join("->")}] 
Resolution: ${L(n)}`)}get resolutionId(){if(this.reference.includes("&")||this.reference.includes("=>"))return this.resolution.id;if(this.reference[0]!=="$")return this.reference;const e=this.reference.slice(1),n=this.$.resolutions[e];return typeof n=="string"?n:$(n,"root")?n.id:G(`Unexpected resolution for reference ${this.reference}: ${L(n)}`)}get defaultShortDescription(){return Xe.object}innerToJsonSchema(e){return this.resolution.toJsonSchemaRecurse(e)}traverseAllows=(e,n)=>{const r=n.seen[this.reference];return r?.includes(e)?!0:(n.seen[this.reference]=P(r,e),this.resolution.traverseAllows(e,n))};traverseApply=(e,n)=>{const r=n.seen[this.reference];r?.includes(e)||(n.seen[this.reference]=P(r,e),this.resolution.traverseApply(e,n))};compile(e){const n=this.resolutionId;e.if(`ctx.seen.${n} && ctx.seen.${n}.includes(data)`,()=>e.return(!0)),e.if(`!ctx.seen.${n}`,()=>e.line(`ctx.seen.${n} = []`)),e.line(`ctx.seen.${n}.push(data)`),e.return(e.invoke(n))}}const bm=(t,e)=>`Alias '${t}' has a shallow resolution cycle: ${[...e,t].join("->")}`,Ps={implementation:mm,Node:gm};class zs extends Gn{traverseApply=(e,n)=>{this.traverseAllows(e,n)||n.errorFromNodeContext(this.errorContext)};get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return Hr(this.errorContext)}compile(e){e.traversalKind==="Allows"?e.return(this.compiledCondition):e.if(this.compiledNegation,()=>e.line(`${e.ctx}.errorFromNodeContext(${this.compiledErrorContext})`))}}const ym=U({kind:"domain",hasAssociatedError:!0,collapsibleKey:"domain",keys:{domain:{},numberAllowsNaN:{}},normalize:t=>typeof t=="string"?{domain:t}:Ss(t,"numberAllowsNaN")&&t.domain!=="number"?b(qs.writeBadAllowNanMessage(t.domain)):t,applyConfig:(t,e)=>t.numberAllowsNaN===void 0&&t.domain==="number"&&e.numberAllowsNaN?{...t,numberAllowsNaN:!0}:t,defaults:{description:t=>Xe[t.domain],actual:t=>Number.isNaN(t)?"NaN":Xe[Me(t)]},intersections:{domain:(t,e)=>t.domain==="number"&&e.domain==="number"?t.numberAllowsNaN?e:t:x.init("domain",t,e)}});class vm extends zs{requiresNaNCheck=this.domain==="number"&&!this.numberAllowsNaN;traverseAllows=this.requiresNaNCheck?e=>typeof e=="number"&&!Number.isNaN(e):e=>Me(e)===this.domain;compiledCondition=this.domain==="object"?'((typeof data === "object" && data !== null) || typeof data === "function")':`typeof data === "${this.domain}"${this.requiresNaNCheck?" && !Number.isNaN(data)":""}`;compiledNegation=this.domain==="object"?'((typeof data !== "object" || data === null) && typeof data !== "function")':`typeof data !== "${this.domain}"${this.requiresNaNCheck?" || Number.isNaN(data)":""}`;expression=this.numberAllowsNaN?"number | NaN":this.domain;get nestableExpression(){return this.numberAllowsNaN?`(${this.expression})`:this.expression}get defaultShortDescription(){return Xe[this.domain]}innerToJsonSchema(e){return this.domain==="bigint"||this.domain==="symbol"?e.fallback.domain({code:"domain",base:{},domain:this.domain}):{type:this.domain}}}const qs={implementation:ym,Node:vm,writeBadAllowNanMessage:t=>`numberAllowsNaN may only be specified with domain "number" (was ${t})`},km=U({kind:"intersection",hasAssociatedError:!0,normalize:t=>{if(ue(t))return t;const{structure:e,...n}=t,r=!!e,i=e??{},s=z(n,(o,a)=>Ke(o,cp)?(r&&b(`Flattened structure key ${o} cannot be specified alongside a root 'structure' key.`),i[o]=a,[]):[o,a]);return($(i,"constraint")||!Un(i))&&(s.structure=i),s},finalizeInnerJson:({structure:t,...e})=>It(t,"object")?{...t,...e}:e,keys:{domain:{child:!0,parse:(t,e)=>e.$.node("domain",t)},proto:{child:!0,parse:(t,e)=>e.$.node("proto",t)},structure:{child:!0,parse:(t,e)=>e.$.node("structure",t),serialize:t=>{if(!t.sequence?.minLength)return t.collapsibleJson;const{sequence:e,...n}=t.collapsibleJson,{minVariadicLength:r,...i}=e,s=i.variadic&&Object.keys(i).length===1?i.variadic:i;return{...n,sequence:s}}},divisor:{child:!0,parse:ge("divisor")},max:{child:!0,parse:ge("max")},min:{child:!0,parse:ge("min")},maxLength:{child:!0,parse:ge("maxLength")},minLength:{child:!0,parse:ge("minLength")},exactLength:{child:!0,parse:ge("exactLength")},before:{child:!0,parse:ge("before")},after:{child:!0,parse:ge("after")},pattern:{child:!0,parse:ge("pattern")},predicate:{child:!0,parse:ge("predicate")}},reduce:(t,e)=>ea({},t,{$:e,invert:!1,pipe:!1}),defaults:{description:t=>{if(t.children.length===0)return"unknown";if(t.structure)return t.structure.description;const e=[];if(t.basis&&!t.refinements.some(n=>n.impl.obviatesBasisDescription)&&e.push(t.basis.description),t.refinements.length){const n=t.refinements.toSorted((r,i)=>r.kind==="min"&&i.kind==="max"?-1:0).map(r=>r.description);e.push(...n)}return t.inner.predicate&&e.push(...t.inner.predicate.map(n=>n.description)),e.join(" and ")},expected:t=>`  ◦ ${t.errors.map(e=>e.expected).join(`
  ◦ `)}`,problem:t=>`(${t.actual}) must be...
${t.expected}`},intersections:{intersection:(t,e,n)=>ea(t.inner,e.inner,n),...Wn("intersection",(t,e,n)=>{if(t.children.length===0)return e;const{domain:r,proto:i,...s}=t.inner,o=i??r,a=o?ne(o,e,n):e;return a instanceof x?a:t?.basis?.equals(a)?t:t.$.node("intersection",{...s,[a.kind]:a},{prereduced:!0})})}});class xm extends Gn{basis=this.inner.domain??this.inner.proto??null;refinements=this.children.filter(e=>e.isRefinement());structure=this.inner.structure;expression=wm(this);get shallowMorphs(){return this.inner.structure?.structuralMorph?[this.inner.structure.structuralMorph]:[]}get defaultShortDescription(){return this.basis?.defaultShortDescription??"present"}innerToJsonSchema(e){return this.children.reduce((n,r)=>r.isBasis()?r.toJsonSchemaRecurse(e):r.reduceJsonSchema(n,e),{})}traverseAllows=(e,n)=>this.children.every(r=>r.traverseAllows(e,n));traverseApply=(e,n)=>{const r=n.currentErrorCount;if(!(this.basis&&(this.basis.traverseApply(e,n),n.currentErrorCount>r))){if(this.refinements.length){for(let i=0;i<this.refinements.length-1;i++)if(this.refinements[i].traverseApply(e,n),n.failFast&&n.currentErrorCount>r)return;if(this.refinements.at(-1).traverseApply(e,n),n.currentErrorCount>r)return}if(!(this.structure&&(this.structure.traverseApply(e,n),n.currentErrorCount>r))&&this.inner.predicate){for(let i=0;i<this.inner.predicate.length-1;i++)if(this.inner.predicate[i].traverseApply(e,n),n.failFast&&n.currentErrorCount>r)return;this.inner.predicate.at(-1).traverseApply(e,n)}}};compile(e){if(e.traversalKind==="Allows"){for(const n of this.children)e.check(n);e.return(!0);return}if(e.initializeErrorCount(),this.basis&&(e.check(this.basis),this.children.length>1&&e.returnIfFail()),this.refinements.length){for(let n=0;n<this.refinements.length-1;n++)e.check(this.refinements[n]),e.returnIfFailFast();e.check(this.refinements.at(-1)),(this.structure||this.inner.predicate)&&e.returnIfFail()}if(this.structure&&(e.check(this.structure),this.inner.predicate&&e.returnIfFail()),this.inner.predicate){for(let n=0;n<this.inner.predicate.length-1;n++)e.check(this.inner.predicate[n]),e.returnIfFail();e.check(this.inner.predicate.at(-1))}}}const Ic={implementation:km,Node:xm},wm=t=>{let e=t.structure?.expression||`${t.basis&&!t.refinements.some(n=>n.impl.obviatesBasisExpression)?t.basis.nestableExpression+" ":""}${t.refinements.map(n=>n.expression).join(" & ")}`||"unknown";return e==="Array == 0"&&(e="[]"),e},ea=(t,e,n)=>{const r={},i=t.proto??t.domain,s=e.proto??e.domain,o=i?s?ne(i,s,n):i:s;return o instanceof x?o:(o&&(r[o.kind]=o),Rr({kind:"intersection",baseInner:r,l:Or(t),r:Or(e),roots:[],ctx:n}))},$m=U({kind:"morph",hasAssociatedError:!1,keys:{in:{child:!0,parse:(t,e)=>e.$.parseSchema(t)},morphs:{parse:Fn,serialize:t=>t.map(e=>$(e,"root")?e.json:fe(e))},declaredIn:{child:!1,serialize:t=>t.json},declaredOut:{child:!1,serialize:t=>t.json}},normalize:t=>t,defaults:{description:t=>`a morph from ${t.in.description} to ${t.out?.description??"unknown"}`},intersections:{morph:(t,e,n)=>{if(!t.hasEqualMorphs(e))return b(Am(t.expression,e.expression));const r=ne(t.in,e.in,n);if(r instanceof x)return r;const i={morphs:t.morphs};if(t.declaredIn||e.declaredIn){const s=ne(t.in,e.in,n);if(s instanceof x)return s.throw();i.declaredIn=s}if(t.declaredOut||e.declaredOut){const s=ne(t.out,e.out,n);if(s instanceof x)return s.throw();i.declaredOut=s}return r.distribute(s=>n.$.node("morph",{...i,in:s}),n.$.parseSchema)},...Wn("morph",(t,e,n)=>{const r=t.inner.in?ne(t.inner.in,e,n):e;return r instanceof x?r:r.equals(t.inner.in)?t:n.$.node("morph",{...t.inner,in:r})})}});class _m extends Gn{serializedMorphs=this.morphs.map(fe);compiledMorphs=`[${this.serializedMorphs}]`;lastMorph=this.inner.morphs.at(-1);lastMorphIfNode=$(this.lastMorph,"root")?this.lastMorph:void 0;introspectableIn=this.inner.in;introspectableOut=this.lastMorphIfNode?Object.assign(this.referencesById,this.lastMorphIfNode.referencesById)&&this.lastMorphIfNode.out:void 0;get shallowMorphs(){return Array.isArray(this.inner.in?.shallowMorphs)?[...this.inner.in.shallowMorphs,...this.morphs]:this.morphs}get in(){return this.declaredIn??this.inner.in?.in??y.intrinsic.unknown.internal}get out(){return this.declaredOut??this.introspectableOut??y.intrinsic.unknown.internal}declareIn(e){return this.$.node("morph",{...this.inner,declaredIn:e})}declareOut(e){return this.$.node("morph",{...this.inner,declaredOut:e})}expression=`(In: ${this.in.expression}) => ${this.lastMorphIfNode?"To":"Out"}<${this.out.expression}>`;get defaultShortDescription(){return this.in.meta.description??this.in.defaultShortDescription}innerToJsonSchema(e){return e.fallback.morph({code:"morph",base:this.in.toJsonSchemaRecurse(e),out:this.introspectableOut?.toJsonSchemaRecurse(e)??null})}compile(e){if(e.traversalKind==="Allows"){if(!this.introspectableIn)return;e.return(e.invoke(this.introspectableIn));return}this.introspectableIn&&e.line(e.invoke(this.introspectableIn)),e.line(`ctx.queueMorphs(${this.compiledMorphs})`)}traverseAllows=(e,n)=>!this.introspectableIn||this.introspectableIn.traverseAllows(e,n);traverseApply=(e,n)=>{this.introspectableIn&&this.introspectableIn.traverseApply(e,n),n.queueMorphs(this.morphs)};hasEqualMorphs(e){return Yt(this.morphs,e.morphs,{isEqual:(n,r)=>n===r||$(n,"root")&&$(r,"root")&&n.equals(r)})}}const Rc={implementation:$m,Node:_m},Am=(t,e)=>`The intersection of distinct morphs at a single path is indeterminate:
Left: ${t}
Right: ${e}`,Sm=U({kind:"proto",hasAssociatedError:!0,collapsibleKey:"proto",keys:{proto:{serialize:t=>Ns(t)??St(t)},dateAllowsInvalid:{}},normalize:t=>{const e=typeof t=="string"?{proto:Qt[t]}:typeof t=="function"?ue(t)?t:{proto:t}:typeof t.proto=="string"?{...t,proto:Qt[t.proto]}:t;return typeof e.proto!="function"&&b(Mr.writeInvalidSchemaMessage(e.proto)),Ss(e,"dateAllowsInvalid")&&e.proto!==Date&&b(Mr.writeBadInvalidDateMessage(e.proto)),e},applyConfig:(t,e)=>t.dateAllowsInvalid===void 0&&t.proto===Date&&e.dateAllowsInvalid?{...t,dateAllowsInvalid:!0}:t,defaults:{description:t=>t.builtinName?_d[t.builtinName]:`an instance of ${t.proto.name}`,actual:t=>t instanceof Date&&t.toString()==="Invalid Date"?"an invalid Date":Ki(t)},intersections:{proto:(t,e)=>t.proto===Date&&e.proto===Date?t.dateAllowsInvalid?e:t:Ko(t.proto,e.proto)?t:Ko(e.proto,t.proto)?e:x.init("proto",t,e),domain:(t,e)=>e.domain==="object"?t:x.init("domain",y.intrinsic.object.internal,e)}});class Em extends zs{builtinName=Ns(this.proto);serializedConstructor=this.json.proto;requiresInvalidDateCheck=this.proto===Date&&!this.dateAllowsInvalid;traverseAllows=this.requiresInvalidDateCheck?e=>e instanceof Date&&e.toString()!=="Invalid Date":e=>e instanceof this.proto;compiledCondition=`data instanceof ${this.serializedConstructor}${this.requiresInvalidDateCheck?' && data.toString() !== "Invalid Date"':""}`;compiledNegation=`!(${this.compiledCondition})`;innerToJsonSchema(e){switch(this.builtinName){case"Array":return{type:"array"};case"Date":return e.fallback.date?.({code:"date",base:{}})??e.fallback.proto({code:"proto",base:{},proto:this.proto});default:return e.fallback.proto({code:"proto",base:{},proto:this.proto})}}expression=this.dateAllowsInvalid?"Date | InvalidDate":this.proto.name;get nestableExpression(){return this.dateAllowsInvalid?`(${this.expression})`:this.expression}domain="object";get defaultShortDescription(){return this.description}}const Mr={implementation:Sm,Node:Em,writeBadInvalidDateMessage:t=>`dateAllowsInvalid may only be specified with constructor Date (was ${t.name})`,writeInvalidSchemaMessage:t=>`instanceOf operand must be a function (was ${Me(t)})`},Nm=U({kind:"union",hasAssociatedError:!0,collapsibleKey:"branches",keys:{ordered:{},branches:{child:!0,parse:(t,e)=>{const n=[];for(const r of t){const i=$(r,"root")?r.branches:e.$.parseSchema(r).branches;for(const s of i)if(s.hasKind("morph")){const o=n.findIndex(a=>a.hasKind("morph")&&a.hasEqualMorphs(s));if(o===-1)n.push(s);else{const a=n[o];n[o]=e.$.node("morph",{...a.inner,in:a.in.rawOr(s.in)})}}else n.push(s)}return e.def.ordered||n.sort((r,i)=>r.hash<i.hash?-1:1),n}}},normalize:t=>oe(t)?{branches:t}:t,reduce:(t,e)=>{const n=qm(t);if(n.length===1)return n[0];if(n.length!==t.branches.length)return e.node("union",{...t,branches:n},{prereduced:!0})},defaults:{description:t=>t.distribute(e=>e.description,Vt),expected:t=>{const e=cd(t.errors,"propString"),n=Object.entries(e).map(([r,i])=>{const s=[];for(const l of i)xt(s,l.expected);const o=Vt(s),a=i.every(l=>l.actual===i[0].actual)?i[0].actual:L(i[0].data);return`${r&&`${r} `}must be ${o}${a&&` (was ${a})`}`});return Vt(n)},problem:t=>t.expected,message:t=>t.problem},intersections:{union:(t,e,n)=>{if(t.isNever!==e.isNever)return x.init("presence",t,e);let r;return t.ordered?(e.ordered&&b(Km(t.expression,e.expression)),r=_i(e.branches,t.branches,n),r instanceof x&&r.invert()):r=_i(t.branches,e.branches,n),r instanceof x?r:n.$.parseSchema(t.ordered||e.ordered?{branches:r,ordered:!0}:{branches:r})},...Wn("union",(t,e,n)=>{const r=_i(t.branches,[e],n);return r instanceof x?r:r.length===1?r[0]:n.$.parseSchema(t.ordered?{branches:r,ordered:!0}:{branches:r})})}});class Tm extends Gn{isBoolean=this.branches.length===2&&this.branches[0].hasUnit(!1)&&this.branches[1].hasUnit(!0);get branchGroups(){const e=[];let n=-1;for(const r of this.branches){if(r.hasKind("unit")&&r.domain==="boolean"){n===-1?(n=e.length,e.push(r)):e[n]=y.intrinsic.boolean;continue}e.push(r)}return e}unitBranches=this.branches.filter(e=>e.in.hasKind("unit"));discriminant=this.discriminate();discriminantJson=this.discriminant?Lm(this.discriminant):null;expression=this.distribute(e=>e.nestableExpression,zm);createBranchedOptimisticRootApply(){return(e,n)=>{const r=this.traverseOptimistic(e);if(r!==Je)return r;const i=new Ft(e,this.$.resolvedConfig);return this.traverseApply(e,i),i.finalize(n)}}get shallowMorphs(){return this.branches.reduce((e,n)=>xt(e,n.shallowMorphs),[])}get defaultShortDescription(){return this.distribute(e=>e.defaultShortDescription,Vt)}innerToJsonSchema(e){if(this.branchGroups.length===1&&this.branchGroups[0].equals(y.intrinsic.boolean))return{type:"boolean"};const n=this.branchGroups.map(r=>r.toJsonSchemaRecurse(e));return n.every(r=>Object.keys(r).length===1&&Ss(r,"const"))?{enum:n.map(r=>r.const)}:{anyOf:n}}traverseAllows=(e,n)=>this.branches.some(r=>r.traverseAllows(e,n));traverseApply=(e,n)=>{const r=[];for(let i=0;i<this.branches.length;i++){if(n.pushBranch(),this.branches[i].traverseApply(e,n),!n.hasError())return this.branches[i].includesTransform?n.queuedMorphs.push(...n.popBranch().queuedMorphs):n.popBranch();r.push(n.popBranch().error)}n.errorFromNodeContext({code:"union",errors:r,meta:this.meta})};traverseOptimistic=e=>{for(let n=0;n<this.branches.length;n++){const r=this.branches[n];if(r.traverseAllows(e))return r.contextFreeMorph?r.contextFreeMorph(e):e}return Je};compile(e){if(!this.discriminant||this.unitBranches.length===this.branches.length&&this.branches.length===2)return this.compileIndiscriminable(e);let n=this.discriminant.optionallyChainedPropString;this.discriminant.kind==="domain"&&(n=`typeof ${n} === "object" ? ${n} === null ? "null" : "object" : typeof ${n} === "function" ? "object" : typeof ${n}`);const r=this.discriminant.cases,i=Object.keys(r),{optimistic:s}=e;if(e.optimistic=!1,e.block(`switch(${n})`,()=>{for(const u in r){const f=r[u],d=u==="default"?u:`case ${u}`;e.line(`${d}: return ${f===!0?s?e.data:f:s?`${e.invoke(f)} ? ${f.contextFreeMorph?`${fe(f.contextFreeMorph)}(${e.data})`:e.data} : "${Je}"`:e.invoke(f)}`)}return e}),e.traversalKind==="Allows"){e.return(s?`"${Je}"`:!1);return}const o=Vt(this.discriminant.kind==="domain"?i.map(u=>{const f=u.slice(1,-1);return f==="function"?Xe.object:Xe[f]}):i),a=this.discriminant.path.map(u=>typeof u=="symbol"?fe(u):JSON.stringify(u)),l=JSON.stringify(o),c=this.discriminant.kind==="domain"?`${Mm}[${n}]`:`${Dm}(${n})`;e.line(`ctx.errorFromNodeContext({
	code: "predicate",
	expected: ${l},
	actual: ${c},
	relativePath: [${a}],
	meta: ${this.compiledMeta}
})`)}compileIndiscriminable(e){if(e.traversalKind==="Apply"){e.const("errors","[]");for(const n of this.branches)e.line("ctx.pushBranch()").line(e.invoke(n)).if("!ctx.hasError()",()=>e.return(n.includesTransform?"ctx.queuedMorphs.push(...ctx.popBranch().queuedMorphs)":"ctx.popBranch()")).line("errors.push(ctx.popBranch().error)");e.line(`ctx.errorFromNodeContext({ code: "union", errors, meta: ${this.compiledMeta} })`)}else{const{optimistic:n}=e;e.optimistic=!1;for(const r of this.branches)e.if(`${e.invoke(r)}`,()=>e.return(n?r.contextFreeMorph?`${fe(r.contextFreeMorph)}(${e.data})`:e.data:!0));e.return(n?`"${Je}"`:!1)}}get nestableExpression(){return this.isBoolean?"boolean":`(${this.expression})`}discriminate(){if(this.branches.length<2||this.isCyclic)return null;if(this.unitBranches.length===this.branches.length){const s=z(this.unitBranches,(o,a)=>[`${a.in.serializedValue}`,a.hasKind("morph")?a:!0]);return{kind:"unit",path:[],optionallyChainedPropString:"data",cases:s}}const e=[];for(let s=0;s<this.branches.length-1;s++){const o=this.branches[s];for(let a=s+1;a<this.branches.length;a++){const l=this.branches[a],c=nt(o.in,l.in,o.$);if(c instanceof x)for(const u of c){if(!u.kind||u.optional)continue;let f,d;if(u.kind==="domain"){const p=u.l,v=u.r;f=`"${typeof p=="string"?p:p.domain}"`,d=`"${typeof v=="string"?v:v.domain}"`}else if(u.kind==="unit")f=u.l.serializedValue,d=u.r.serializedValue;else continue;const m=e.find(p=>Yt(p.path,u.path)&&p.kind===u.kind);m?(m.cases[f]?m.cases[f].branchIndices=xt(m.cases[f].branchIndices,s):m.cases[f]??={branchIndices:[s],condition:u.l},m.cases[d]?m.cases[d].branchIndices=xt(m.cases[d].branchIndices,a):m.cases[d]??={branchIndices:[a],condition:u.r}):e.push({kind:u.kind,cases:{[f]:{branchIndices:[s],condition:u.l},[d]:{branchIndices:[a],condition:u.r}},path:u.path})}}}const n=this.ordered?Om(e,this.branches):e;if(!n.length)return null;const r=Im(n,this),i={};for(const s in r.best.cases){const o=Rm(r,s);if(o===null){i[s]=!0;continue}if(o.length===this.branches.length)return null;this.ordered&&o.sort((c,u)=>c.originalIndex-u.originalIndex);const a=o.map(c=>c.branch),l=a.length===1?a[0]:this.$.node("union",this.ordered?{branches:a,ordered:!0}:a);Object.assign(this.referencesById,l.referencesById),i[s]=l}if(r.defaultEntries.length){const s=r.defaultEntries.map(o=>o.branch);i.default=this.$.node("union",this.ordered?{branches:s,ordered:!0}:s,{prereduced:!0}),Object.assign(this.referencesById,i.default.referencesById)}return Object.assign(r.location,{cases:i})}}const Im=(t,e)=>{const n=t.sort((s,o)=>Object.keys(o.cases).length-Object.keys(s.cases).length)[0],r={kind:n.kind,path:n.path,optionallyChainedPropString:Oc(n.path)},i=e.branches.map((s,o)=>({originalIndex:o,branch:s}));return{best:n,location:r,defaultEntries:i,node:e}},Rm=(t,e)=>{const n=t.best.cases[e],r=Cm(n.condition,t.location.path,t.node.$);let i=[];const s=[];for(let o=0;o<t.defaultEntries.length;o++){const a=t.defaultEntries[o];if(n.branchIndices.includes(a.originalIndex)){const l=ta(t.node.branches[a.originalIndex],t.location);l===null?i=null:i?.push({originalIndex:a.originalIndex,branch:l})}else if(a.branch.hasKind("alias")&&r.hasKind("domain")&&r.domain==="object")i?.push(a);else{if(a.branch.in.overlaps(r)){const l=ta(a.branch,t.location);i?.push({originalIndex:a.originalIndex,branch:l})}s.push(a)}}return t.defaultEntries=s,i},Om=(t,e)=>t.filter(r=>{const i=Object.values(r.cases).map(s=>s.branchIndices);for(let s=0;s<i.length-1;s++){const o=i[s];for(let a=s+1;a<i.length;a++){const l=i[a];for(const c of o)for(const u of l)if(c>u&&e[c].overlaps(e[u]))return!1}}return!0}),Cm=(t,e,n)=>{let r=t==="undefined"?n.node("unit",{unit:void 0}):t==="null"?n.node("unit",{unit:null}):t==="boolean"?n.units([!0,!1]):t;for(let i=e.length-1;i>=0;i--){const s=e[i];r=n.node("intersection",typeof s=="number"?{proto:"Array",sequence:[...ad(s).map(o=>({})),r]}:{domain:"object",required:[{key:s,value:r}]})}return r},Oc=t=>t.reduce((e,n)=>e+ec(n,!0),"data"),Mm=fe(ud),Dm=fe(L),Cc={implementation:Nm,Node:Tm},Lm=t=>({kind:t.kind,path:t.path.map(e=>typeof e=="string"?e:Jn(e)),cases:z(t.cases,(e,n)=>[e,n===!0?n:n.hasKind("union")&&n.discriminantJson?n.discriminantJson:n.json])}),Pm={delimiter:" | ",finalDelimiter:" | "},zm=t=>Vt(t,Pm),Vt=(t,e)=>{const n=e?.delimiter??", ",r=e?.finalDelimiter??" or ";if(t.length===0)return"never";if(t.length===1)return t[0];if(t.length===2&&t[0]==="false"&&t[1]==="true"||t[0]==="true"&&t[1]==="false")return"boolean";const i={},s=t.filter(a=>i[a]?!1:i[a]=!0),o=s.pop();return`${s.join(n)}${s.length?r:""}${o}`},_i=(t,e,n)=>{const r=e.map(()=>[]);for(let s=0;s<t.length;s++){let o={};for(let a=0;a<e.length;a++){if(r[a]===null)continue;if(t[s].equals(e[a])){r[a]=null,o={};break}const l=ne(t[s],e[a],n);if(!(l instanceof x)){if(l.equals(t[s])){r[a].push(t[s]),o={};break}l.equals(e[a])?r[a]=null:o[a]=l}}for(const a in o)r[a][s]=o[a]}const i=r.flatMap((s,o)=>s?.flatMap(a=>a.branches)??e[o]);return i.length===0?x.init("union",t,e):i},qm=({branches:t,ordered:e})=>{if(t.length<2)return t;const n=t.map(()=>!0);for(let r=0;r<t.length;r++)for(let i=r+1;i<t.length&&n[r]&&n[i];i++){if(t[r].equals(t[i])){n[i]=!1;continue}const s=nt(t[r].in,t[i].in,t[0].$);s instanceof x||(e||Bm(t[r],t[i]),s.equals(t[r].in)?n[r]=!!e:s.equals(t[i].in)&&(n[i]=!1))}return t.filter((r,i)=>n[i])},Bm=(t,e)=>{!t.includesTransform&&!e.includesTransform||(Yt(t.shallowMorphs,e.shallowMorphs)||b(na(t.expression,e.expression)),Yt(t.flatMorphs,e.flatMorphs,{isEqual:(n,r)=>n.propString===r.propString&&(n.node.hasKind("morph")&&r.node.hasKind("morph")?n.node.hasEqualMorphs(r.node):n.node.hasKind("intersection")&&r.node.hasKind("intersection")?n.node.structure?.structuralMorphRef===r.node.structure?.structuralMorphRef:!1)})||b(na(t.expression,e.expression)))},ta=(t,e)=>t.transform((n,r)=>n==="domain"||n==="unit"?null:r,{shouldTransform:(n,r)=>{const i=Oc(r.path);return e.optionallyChainedPropString.startsWith(i)?n.hasKind("domain")&&n.domain==="object"||(n.hasKind("domain")||e.kind==="unit")&&i===e.optionallyChainedPropString?!0:n.children.length!==0&&n.kind!=="index":!1}}),na=(t,e)=>`An unordered union of a type including a morph and a type with overlapping input is indeterminate:
Left: ${t}
Right: ${e}`,Km=(t,e)=>`The intersection of two ordered unions is indeterminate:
Left: ${t}
Right: ${e}`,Fm=U({kind:"unit",hasAssociatedError:!0,keys:{unit:{preserveUndefined:!0,serialize:t=>t instanceof Date?t.toISOString():St(t)}},normalize:t=>t,defaults:{description:t=>L(t.unit),problem:({expected:t,actual:e})=>`${t===e?`must be reference equal to ${t} (serialized to the same value)`:`must be ${t} (was ${e})`}`},intersections:{unit:(t,e)=>x.init("unit",t,e),...Wn("unit",(t,e)=>{if(e.allows(t.unit))return t;const n=e.hasKind("intersection")?e.basis:e;if(n){const r=n.hasKind("domain")?n:y.intrinsic.object;if(t.domain!==r.domain){const i=t.domain==="undefined"||t.domain==="null"||t.domain==="boolean"?t.domain:y.intrinsic[t.domain];return x.init("domain",i,r)}}return x.init("assignability",t,e.hasKind("intersection")?e.children.find(r=>!r.allows(t.unit)):e)})}});class Um extends zs{compiledValue=this.json.unit;serializedValue=typeof this.unit=="string"||this.unit instanceof Date?JSON.stringify(this.compiledValue):`${this.compiledValue}`;compiledCondition=ra(this.unit,this.serializedValue);compiledNegation=ra(this.unit,this.serializedValue,"negated");expression=L(this.unit);domain=Me(this.unit);get defaultShortDescription(){return this.domain==="object"?Xe.object:this.description}innerToJsonSchema(e){return this.unit===null?{type:"null"}:y.intrinsic.jsonPrimitive.allows(this.unit)?{const:this.unit}:e.fallback.unit({code:"unit",base:{},unit:this.unit})}traverseAllows=this.unit instanceof Date?e=>e instanceof Date&&e.toISOString()===this.compiledValue:Number.isNaN(this.unit)?e=>Number.isNaN(e):e=>e===this.unit}const Mc={implementation:Fm,Node:Um},ra=(t,e,n)=>{if(t instanceof Date){const r=`data instanceof Date && data.toISOString() === ${e}`;return n?`!(${r})`:r}return Number.isNaN(t)?`${n?"!":""}Number.isNaN(data)`:`data ${n?"!":"="}== ${e}`},jm=U({kind:"index",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{signature:{child:!0,parse:(t,e)=>{const n=e.$.parseSchema(t);if(!n.extends(y.intrinsic.key))return b(Jm(n.expression));const r=n.branches.filter(i=>i.hasKind("unit"));return r.length?b(Vm(r.map(i=>L(i.unit)))):n}},value:{child:!0,parse:(t,e)=>e.$.parseSchema(t)}},normalize:t=>t,defaults:{description:t=>`[${t.signature.expression}]: ${t.value.description}`},intersections:{index:(t,e,n)=>{if(t.signature.equals(e.signature)){const r=ne(t.value,e.value,n),i=r instanceof x?y.intrinsic.never.internal:r;return n.$.node("index",{signature:t.signature,value:i})}return t.signature.extends(e.signature)&&t.value.subsumes(e.value)?e:e.signature.extends(t.signature)&&e.value.subsumes(t.value)?t:null}}});class Hm extends ln{impliedBasis=y.intrinsic.object.internal;expression=`[${this.signature.expression}]: ${this.value.expression}`;flatRefs=P(this.value.flatRefs.map(e=>ct([this.signature,...e.path],e.node)),ct([this.signature],this.value));traverseAllows=(e,n)=>Er(e).every(r=>this.signature.traverseAllows(r[0],n)?tt(r[0],()=>this.value.traverseAllows(r[1],n),n):!0);traverseApply=(e,n)=>{for(const r of Er(e))this.signature.traverseAllows(r[0],n)&&tt(r[0],()=>this.value.traverseApply(r[1],n),n)};_transform(e,n){n.path.push(this.signature);const r=super._transform(e,n);return n.path.pop(),r}compile(){}}const Dc={implementation:jm,Node:Hm},Vm=t=>`Index keys ${t.join(", ")} should be specified as named props.`,Jm=t=>`Indexed key definition '${t}' must be a string or symbol`,Gm=U({kind:"required",hasAssociatedError:!0,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(t,e)=>e.$.parseSchema(t)}},normalize:t=>t,defaults:{description:t=>`${t.compiledKey}: ${t.value.description}`,expected:t=>t.missingValueDescription,actual:()=>"missing"},intersections:{required:Yi,optional:Yi}});class Wm extends Ec{expression=`${this.compiledKey}: ${this.value.expression}`;errorContext=Object.freeze({code:"required",missingValueDescription:this.value.defaultShortDescription,relativePath:[this.key],meta:this.meta});compiledErrorContext=Hr(this.errorContext)}const Lc={implementation:Gm,Node:Wm},Zm=U({kind:"sequence",hasAssociatedError:!1,collapsibleKey:"variadic",keys:{prefix:{child:!0,parse:(t,e)=>{if(t.length!==0)return t.map(n=>e.$.parseSchema(n))}},optionals:{child:!0,parse:(t,e)=>{if(t.length!==0)return t.map(n=>e.$.parseSchema(n))}},defaultables:{child:t=>t.map(e=>e[0]),parse:(t,e)=>{if(t.length!==0)return t.map(n=>{const r=e.$.parseSchema(n[0]);return Ls(r,n[1],null),[r,n[1]]})},serialize:t=>t.map(e=>[e[0].collapsibleJson,St(e[1])])},variadic:{child:!0,parse:(t,e)=>e.$.parseSchema(t,e)},minVariadicLength:{parse:t=>t===0?void 0:t},postfix:{child:!0,parse:(t,e)=>{if(t.length!==0)return t.map(n=>e.$.parseSchema(n))}}},normalize:t=>{if(typeof t=="string")return{variadic:t};if("variadic"in t||"prefix"in t||"defaultables"in t||"optionals"in t||"postfix"in t||"minVariadicLength"in t){if(t.postfix?.length){if(!t.variadic)return b(tg);if(t.optionals?.length||t.defaultables?.length)return b(zc)}return t.minVariadicLength&&!t.variadic?b("minVariadicLength may not be specified without a variadic element"):t}return{variadic:t}},reduce:(t,e)=>{let n=t.minVariadicLength??0;const r=t.prefix?.slice()??[],i=t.defaultables?.slice()??[],s=t.optionals?.slice()??[],o=t.postfix?.slice()??[];if(t.variadic){for(;s.at(-1)?.equals(t.variadic);)s.pop();if(s.length===0&&i.length===0)for(;r.at(-1)?.equals(t.variadic);)r.pop(),n++;for(;o[0]?.equals(t.variadic);)o.shift(),n++}else s.length===0&&i.length===0&&r.push(...o.splice(0));if(n!==t.minVariadicLength||t.prefix&&t.prefix.length!==r.length)return e.node("sequence",{...t,prefix:r,defaultables:i,optionals:s,postfix:o,minVariadicLength:n},{prereduced:!0})},defaults:{description:t=>t.isVariadicOnly?`${t.variadic.nestableExpression}[]`:`[${t.tuple.map(n=>n.kind==="defaultables"?`${n.node.nestableExpression} = ${L(n.default)}`:n.kind==="optionals"?`${n.node.nestableExpression}?`:n.kind==="variadic"?`...${n.node.nestableExpression}[]`:n.node.expression).join(", ")}]`},intersections:{sequence:(t,e,n)=>{const r=An({l:t.tuple,r:e.tuple,disjoint:new x,result:[],fixedVariants:[],ctx:n}),i=r.disjoint.length===0?[r,...r.fixedVariants]:r.fixedVariants;return i.length===0?r.disjoint:i.length===1?n.$.node("sequence",ia(i[0].result)):n.$.node("union",i.map(s=>({proto:Array,sequence:ia(s.result)})))}}});class Ym extends ln{impliedBasis=y.intrinsic.Array.internal;tuple=eg(this.inner);prefixLength=this.prefix?.length??0;defaultablesLength=this.defaultables?.length??0;optionalsLength=this.optionals?.length??0;postfixLength=this.postfix?.length??0;defaultablesAndOptionals=[];prevariadic=this.tuple.filter(e=>e.kind==="defaultables"||e.kind==="optionals"?(this.defaultablesAndOptionals.push(e.node),!0):e.kind==="prefix");variadicOrPostfix=bt(this.variadic&&[this.variadic],this.postfix);flatRefs=this.addFlatRefs();addFlatRefs(){return Vo(this.flatRefs,this.prevariadic.flatMap((e,n)=>P(e.node.flatRefs.map(r=>ct([`${n}`,...r.path],r.node)),ct([`${n}`],e.node)))),Vo(this.flatRefs,this.variadicOrPostfix.flatMap(e=>P(e.flatRefs.map(n=>ct([y.intrinsic.nonNegativeIntegerString.internal,...n.path],n.node)),ct([y.intrinsic.nonNegativeIntegerString.internal],e)))),this.flatRefs}isVariadicOnly=this.prevariadic.length+this.postfixLength===0;minVariadicLength=this.inner.minVariadicLength??0;minLength=this.prefixLength+this.minVariadicLength+this.postfixLength;minLengthNode=this.minLength===0?null:this.$.node("minLength",this.minLength);maxLength=this.variadic?null:this.tuple.length;maxLengthNode=this.maxLength===null?null:this.$.node("maxLength",this.maxLength);impliedSiblings=this.minLengthNode?this.maxLengthNode?[this.minLengthNode,this.maxLengthNode]:[this.minLengthNode]:this.maxLengthNode?[this.maxLengthNode]:[];defaultValueMorphs=Qm(this);defaultValueMorphsReference=this.defaultValueMorphs.length?fe(this.defaultValueMorphs):void 0;elementAtIndex(e,n){if(n<this.prevariadic.length)return this.tuple[n];const r=e.length-this.postfixLength;return n>=r?{kind:"postfix",node:this.postfix[n-r]}:{kind:"variadic",node:this.variadic??G(`Unexpected attempt to access index ${n} on ${this}`)}}traverseAllows=(e,n)=>{for(let r=0;r<e.length;r++)if(!this.elementAtIndex(e,r).node.traverseAllows(e[r],n))return!1;return!0};traverseApply=(e,n)=>{let r=0;for(;r<e.length;r++)tt(r,()=>this.elementAtIndex(e,r).node.traverseApply(e[r],n),n)};get element(){return this.cacheGetter("element",this.$.node("union",this.children))}compile(e){if(this.prefix)for(const[n,r]of this.prefix.entries())e.traverseKey(`${n}`,`data[${n}]`,r);for(const[n,r]of this.defaultablesAndOptionals.entries()){const i=`${n+this.prefixLength}`;e.if(`${i} >= ${e.data}.length`,()=>e.traversalKind==="Allows"?e.return(!0):e.return()),e.traverseKey(i,`data[${i}]`,r)}if(this.variadic&&(this.postfix&&e.const("firstPostfixIndex",`${e.data}.length${this.postfix?`- ${this.postfix.length}`:""}`),e.for(`i < ${this.postfix?"firstPostfixIndex":"data.length"}`,()=>e.traverseKey("i","data[i]",this.variadic),this.prevariadic.length),this.postfix))for(const[n,r]of this.postfix.entries()){const i=`firstPostfixIndex + ${n}`;e.traverseKey(i,`data[${i}]`,r)}e.traversalKind==="Allows"&&e.return(!0)}_transform(e,n){n.path.push(y.intrinsic.nonNegativeIntegerString.internal);const r=super._transform(e,n);return n.path.pop(),r}expression=this.description;reduceJsonSchema(e,n){if(this.prevariadic.length&&(e.prefixItems=this.prevariadic.map(r=>{const i=r.node.toJsonSchemaRecurse(n);if(r.kind==="defaultables"){const s=typeof r.default=="function"?r.default():r.default;i.default=y.intrinsic.jsonData.allows(s)?s:n.fallback.defaultValue({code:"defaultValue",base:i,value:s})}return i})),this.minLength&&(e.minItems=this.minLength),this.variadic){const r=Object.assign(e,{items:this.variadic.toJsonSchemaRecurse(n)});if(this.maxLength&&(r.maxItems=this.maxLength),this.postfix){const i=this.postfix.map(s=>s.toJsonSchemaRecurse(n));e=n.fallback.arrayPostfix({code:"arrayPostfix",base:r,elements:i})}}else e.items=!1,delete e.maxItems;return e}}const Xm={},Qm=t=>{if(!t.defaultables)return[];const e=[];let n="[";const r=t.prefixLength+t.defaultablesLength-1;for(let i=t.prefixLength;i<=r;i++){const[s,o]=t.defaultables[i-t.prefixLength];e.push(Tc(i,s,o)),n+=`${i}: ${s.id} = ${St(o)}, `}return n+="]",Xm[n]??=e},Pc={implementation:Zm,Node:Ym},eg=t=>{const e=[];if(t.prefix)for(const n of t.prefix)e.push({kind:"prefix",node:n});if(t.defaultables)for(const[n,r]of t.defaultables)e.push({kind:"defaultables",node:n,default:r});if(t.optionals)for(const n of t.optionals)e.push({kind:"optionals",node:n});if(t.variadic&&e.push({kind:"variadic",node:t.variadic}),t.postfix)for(const n of t.postfix)e.push({kind:"postfix",node:n});return e},ia=t=>t.reduce((e,n)=>(n.kind==="variadic"?e.variadic=n.node:n.kind==="defaultables"?e.defaultables=P(e.defaultables,[[n.node,n.default]]):e[n.kind]=P(e[n.kind],n.node),e),{}),zc="A postfix required element cannot follow an optional or defaultable element",tg="A postfix element requires a variadic element",An=t=>{const[e,...n]=t.l,[r,...i]=t.r;if(!e||!r)return t;const s=n.at(-1)?.kind==="postfix",o=i.at(-1)?.kind==="postfix",a=e.kind==="prefix"||r.kind==="prefix"?"prefix":e.kind==="postfix"||r.kind==="postfix"?"postfix":e.kind==="variadic"&&r.kind==="variadic"?"variadic":s||o?"prefix":e.kind==="defaultables"||r.kind==="defaultables"?"defaultables":"optionals";if(e.kind==="prefix"&&r.kind==="variadic"&&o){const f=An({...t,fixedVariants:[],r:i.map(d=>({...d,kind:"prefix"}))});f.disjoint.length===0&&t.fixedVariants.push(f)}else if(r.kind==="prefix"&&e.kind==="variadic"&&s){const f=An({...t,fixedVariants:[],l:n.map(d=>({...d,kind:"prefix"}))});f.disjoint.length===0&&t.fixedVariants.push(f)}const l=ne(e.node,r.node,t.ctx);if(l instanceof x)if(a==="prefix"||a==="postfix")t.disjoint.push(...l.withPrefixKey(a==="prefix"?t.result.length:`-${n.length+1}`,"required")),t.result=[...t.result,{kind:a,node:y.intrinsic.never.internal}];else return a==="optionals"||a==="defaultables"?t:An({...t,fixedVariants:[],l:n.map(f=>({...f,kind:"prefix"})),r:n.map(f=>({...f,kind:"prefix"}))});else a==="defaultables"?(e.kind==="defaultables"&&r.kind==="defaultables"&&e.default!==r.default&&b(Nc(e.default,r.default)),t.result=[...t.result,{kind:a,node:l,default:e.kind==="defaultables"?e.default:r.kind==="defaultables"?r.default:G(`Unexpected defaultable intersection from ${e.kind} and ${r.kind} elements.`)}]):t.result=[...t.result,{kind:a,node:l}];const c=t.l.length,u=t.r.length;return(e.kind!=="variadic"||c>=u&&(r.kind==="variadic"||u===1))&&(t.l=n),(r.kind!=="variadic"||u>=c&&(e.kind==="variadic"||c===1))&&(t.r=i),An(t)},qc=t=>e=>{if(e.props.length||e.index){const n=e.index?.map(i=>i[t])??[];for(const i of e.props)n.push(i[t]);e.undeclared&&n.push(`+ (undeclared): ${e.undeclared}`);const r=`{ ${n.join(", ")} }`;return e.sequence?`${r} & ${e.sequence.description}`:r}return e.sequence?.description??"{}"},ng=qc("description"),rg=qc("expression"),sa=(t,e,n)=>{const r=t.required?"required":"optional";if(!e.signature.allows(t.key))return null;const i=nt(t.value,e.value,n);return i instanceof x?r==="optional"?n.node("optional",{key:t.key,value:y.intrinsic.never.internal}):i.withPrefixKey(t.key,t.kind):null},ig=U({kind:"structure",hasAssociatedError:!1,normalize:t=>t,applyConfig:(t,e)=>!t.undeclared&&e.onUndeclaredKey!=="ignore"?{...t,undeclared:e.onUndeclaredKey}:t,keys:{required:{child:!0,parse:ge("required"),reduceIo:(t,e,n)=>{e.required=P(e.required,n.map(r=>r[t]))}},optional:{child:!0,parse:ge("optional"),reduceIo:(t,e,n)=>{if(t==="in"){e.optional=n.map(r=>r.in);return}for(const r of n)e[r.outProp.kind]=P(e[r.outProp.kind],r.outProp.out)}},index:{child:!0,parse:ge("index")},sequence:{child:!0,parse:ge("sequence")},undeclared:{parse:t=>t==="ignore"?void 0:t,reduceIo:(t,e,n)=>{n==="delete"&&(t==="in"?delete e.undeclared:e.undeclared="reject")}}},defaults:{description:ng},intersections:{structure:(t,e,n)=>{const r={...t.inner},i={...e.inner},s=new x;if(t.undeclared){const l=t.keyof();for(const c of e.requiredKeys)l.allows(c)||s.add("presence",y.intrinsic.never.internal,e.propsByKey[c].value,{path:[c]});i.optional&&(i.optional=i.optional.filter(c=>l.allows(c.key))),i.index&&(i.index=i.index.flatMap(c=>{if(c.signature.extends(l))return c;const u=nt(l,c.signature,n.$);if(u instanceof x)return[];const f=Xi(u,c.value,n.$);return f.required&&(i.required=bt(i.required,f.required)),f.optional&&(i.optional=bt(i.optional,f.optional)),f.index??[]}))}if(e.undeclared){const l=e.keyof();for(const c of t.requiredKeys)l.allows(c)||s.add("presence",t.propsByKey[c].value,y.intrinsic.never.internal,{path:[c]});r.optional&&(r.optional=r.optional.filter(c=>l.allows(c.key))),r.index&&(r.index=r.index.flatMap(c=>{if(c.signature.extends(l))return c;const u=nt(l,c.signature,n.$);if(u instanceof x)return[];const f=Xi(u,c.value,n.$);return f.required&&(r.required=bt(r.required,f.required)),f.optional&&(r.optional=bt(r.optional,f.optional)),f.index??[]}))}const o={};(t.undeclared||e.undeclared)&&(o.undeclared=t.undeclared==="reject"||e.undeclared==="reject"?"reject":"delete");const a=Rr({kind:"structure",baseInner:o,l:Or(r),r:Or(i),roots:[],ctx:n});return a instanceof x&&s.push(...a),s.length?s:a}},reduce:(t,e)=>{if(t.index){if(!(t.required||t.optional))return;let n=!1;const r=t.required??[],i=t.optional??[],s=[...i];for(const o of t.index){for(const a of r){const l=sa(a,o,e);if(l instanceof x)return l}for(const[a,l]of i.entries()){const c=sa(l,o,e);if(c instanceof x)return c;c!==null&&(s[a]=c,n=!0)}}if(n)return e.node("structure",{...t,optional:s},{prereduced:!0})}}});class sg extends ln{impliedBasis=y.intrinsic.object.internal;impliedSiblings=this.children.flatMap(e=>e.impliedSiblings??[]);props=bt(this.required,this.optional);propsByKey=z(this.props,(e,n)=>[n.key,n]);propsByKeyReference=fe(this.propsByKey);expression=rg(this);requiredKeys=this.required?.map(e=>e.key)??[];optionalKeys=this.optional?.map(e=>e.key)??[];literalKeys=[...this.requiredKeys,...this.optionalKeys];_keyof;keyof(){if(this._keyof)return this._keyof;let e=this.$.units(this.literalKeys).branches;if(this.index)for(const{signature:n}of this.index)e=e.concat(n.branches);return this._keyof=this.$.node("union",e)}map(e){return this.$.node("structure",this.props.flatMap(e).reduce((n,r)=>{const i=this.propsByKey[r.key];if(ue(r))return r.kind!=="required"&&r.kind!=="optional"?b(`Map result must have kind "required" or "optional" (was ${r.kind})`):(n[r.kind]=P(n[r.kind],r),n);const s=r.kind??i?.kind??"required",o=z(r,(a,l)=>a in Ds.implementation.keys?[a,l]:[]);return n[s]=P(n[s],this.$.node(s,o)),n},{}))}assertHasKeys(e){const n=e.filter(r=>!fr(r,this.keyof()));if(n.length)return b(oa(this.expression,n))}get(e,...n){let r,i=!1;const s=cg(e);if((typeof s=="string"||typeof s=="symbol")&&this.propsByKey[s]&&(r=this.propsByKey[s].value,i=this.propsByKey[s].required),this.index)for(const a of this.index)fr(s,a.signature)&&(r=r?.and(a.value)??a.value);if(this.sequence&&fr(s,y.intrinsic.nonNegativeIntegerString))if($(s,"root"))this.sequence.variadic&&(r=r?.and(this.sequence.element)??this.sequence.element);else{const a=Number.parseInt(s);if(a<this.sequence.prevariadic.length){const l=this.sequence.prevariadic[a].node;r=r?.and(l)??l,i||=a<this.sequence.prefixLength}else if(this.sequence.variadic){const l=this.$.node("union",this.sequence.variadicOrPostfix);r=r?.and(l)??l}}if(!r)return this.sequence?.variadic&&$(s,"root")&&s.extends(y.intrinsic.number)?b(ug(s.expression,this.sequence.expression)):b(oa(this.expression,[s]));const o=r.get(...n);return i?o:o.or(y.intrinsic.undefined)}pick(...e){return this.assertHasKeys(e),this.$.node("structure",this.filterKeys("pick",e))}omit(...e){return this.assertHasKeys(e),this.$.node("structure",this.filterKeys("omit",e))}optionalize(){const{required:e,...n}=this.inner;return this.$.node("structure",{...n,optional:this.props.map(r=>r.hasKind("required")?this.$.node("optional",r.inner):r)})}require(){const{optional:e,...n}=this.inner;return this.$.node("structure",{...n,required:this.props.map(r=>r.hasKind("optional")?{key:r.key,value:r.value}:r)})}merge(e){const n=this.filterKeys("omit",[e.keyof()]);return e.required&&(n.required=P(n.required,e.required)),e.optional&&(n.optional=P(n.optional,e.optional)),e.index&&(n.index=P(n.index,e.index)),e.sequence&&(n.sequence=e.sequence),e.undeclared?n.undeclared=e.undeclared:delete n.undeclared,this.$.node("structure",n)}filterKeys(e,n){const r=nc(this.inner),i=s=>{const o=n.some(a=>fr(s,a));return e==="pick"?o:!o};return r.required&&(r.required=r.required.filter(s=>i(s.key))),r.optional&&(r.optional=r.optional.filter(s=>i(s.key))),r.index&&(r.index=r.index.filter(s=>i(s.signature))),r}traverseAllows=(e,n)=>this._traverse("Allows",e,n);traverseApply=(e,n)=>this._traverse("Apply",e,n);_traverse=(e,n,r)=>{const i=r?.currentErrorCount??0;for(let s=0;s<this.props.length;s++)if(e==="Allows"){if(!this.props[s].traverseAllows(n,r))return!1}else if(this.props[s].traverseApply(n,r),r.failFast&&r.currentErrorCount>i)return!1;if(this.sequence){if(e==="Allows"){if(!this.sequence.traverseAllows(n,r))return!1}else if(this.sequence.traverseApply(n,r),r.failFast&&r.currentErrorCount>i)return!1}if(this.index||this.undeclared==="reject"){const s=Object.keys(n);s.push(...Object.getOwnPropertySymbols(n));for(let o=0;o<s.length;o++){const a=s[o];if(this.index){for(const l of this.index)if(l.signature.traverseAllows(a,r)){if(e==="Allows"){if(!tt(a,()=>l.value.traverseAllows(n[a],r),r))return!1}else if(tt(a,()=>l.value.traverseApply(n[a],r),r),r.failFast&&r.currentErrorCount>i)return!1}}if(this.undeclared==="reject"&&!this.declaresKey(a)&&(e==="Allows"||(r.errorFromNodeContext({code:"predicate",expected:"removed",actual:"",relativePath:[a],meta:this.meta}),r.failFast)))return!1}}return this.structuralMorph&&r&&!r.hasError()&&r.queueMorphs([this.structuralMorph]),!0};get defaultable(){return this.cacheGetter("defaultable",this.optional?.filter(e=>e.hasDefault())??[])}declaresKey=e=>e in this.propsByKey||this.index?.some(n=>n.signature.allows(e))||this.sequence!==void 0&&y.intrinsic.nonNegativeIntegerString.allows(e);_compileDeclaresKey(e){const n=[];if(this.props.length&&n.push(`k in ${this.propsByKeyReference}`),this.index)for(const r of this.index)n.push(e.invoke(r.signature,{kind:"Allows",arg:"k"}));return this.sequence&&n.push("$ark.intrinsic.nonNegativeIntegerString.allows(k)"),n.join(" || ")||"false"}get structuralMorph(){return this.cacheGetter("structuralMorph",ag(this))}structuralMorphRef=this.structuralMorph&&fe(this.structuralMorph);compile(e){e.traversalKind==="Apply"&&e.initializeErrorCount();for(const n of this.props)e.check(n),e.traversalKind==="Apply"&&e.returnIfFailFast();if(this.sequence&&(e.check(this.sequence),e.traversalKind==="Apply"&&e.returnIfFailFast()),(this.index||this.undeclared==="reject")&&(e.const("keys","Object.keys(data)"),e.line("keys.push(...Object.getOwnPropertySymbols(data))"),e.for("i < keys.length",()=>this.compileExhaustiveEntry(e))),e.traversalKind==="Allows")return e.return(!0);this.structuralMorphRef&&e.if("ctx && !ctx.hasError()",()=>(e.line("ctx.queueMorphs(["),lg(e,this),e.line("])")))}compileExhaustiveEntry(e){if(e.const("k","keys[i]"),this.index)for(const n of this.index)e.if(`${e.invoke(n.signature,{arg:"k",kind:"Allows"})}`,()=>e.traverseKey("k","data[k]",n.value));return this.undeclared==="reject"&&e.if(`!(${this._compileDeclaresKey(e)})`,()=>e.traversalKind==="Allows"?e.return(!1):e.line(`ctx.errorFromNodeContext({ code: "predicate", expected: "removed", actual: "", relativePath: [k], meta: ${this.compiledMeta} })`).if("ctx.failFast",()=>e.return())),e}reduceJsonSchema(e,n){switch(e.type){case"object":return this.reduceObjectJsonSchema(e,n);case"array":const r=this.sequence?.reduceJsonSchema(e,n)??e;return this.props.length||this.index?n.fallback.arrayObject({code:"arrayObject",base:r,object:this.reduceObjectJsonSchema({type:"object"},n)}):r;default:return X.throwInternalOperandError("structure",e)}}reduceObjectJsonSchema(e,n){if(this.props.length){e.properties={};for(const r of this.props){const i=r.value.toJsonSchemaRecurse(n);if(typeof r.key=="symbol"){n.fallback.symbolKey({code:"symbolKey",base:e,key:r.key,value:i,optional:r.optional});continue}if(r.hasDefault()){const s=typeof r.default=="function"?r.default():r.default;i.default=y.intrinsic.jsonData.allows(s)?s:n.fallback.defaultValue({code:"defaultValue",base:i,value:s})}e.properties[r.key]=i}this.requiredKeys.length&&e.properties&&(e.required=this.requiredKeys.filter(r=>typeof r=="string"&&r in e.properties))}if(this.index)for(const r of this.index){const i=r.value.toJsonSchemaRecurse(n);if(r.signature.equals(y.intrinsic.string)){e.additionalProperties=i;continue}for(const s of r.signature.branches){if(!s.extends(y.intrinsic.string)){e=n.fallback.symbolKey({code:"symbolKey",base:e,key:null,value:i,optional:!1});continue}let o={type:"string"};if(s.hasKind("morph")&&(o=n.fallback.morph({code:"morph",base:s.in.toJsonSchemaRecurse(n),out:s.out.toJsonSchemaRecurse(n)})),!s.hasKind("intersection"))return G(`Unexpected index branch kind ${s.kind}.`);const{pattern:a}=s.inner;if(a){const l=Object.assign(o,{pattern:a[0].rule});for(let c=1;c<a.length;c++)o=n.fallback.patternIntersection({code:"patternIntersection",base:l,pattern:a[c].rule});e.patternProperties??={},e.patternProperties[l.pattern]=i}}}return this.undeclared&&!e.additionalProperties&&(e.additionalProperties=!1),e}}const Ai={},og=t=>{let e="";for(let n=0;n<t.defaultable.length;n++)e+=t.defaultable[n].defaultValueMorphRef;if(t.sequence?.defaultValueMorphsReference&&(e+=t.sequence?.defaultValueMorphsReference),t.undeclared==="delete"){if(e+="delete !(",t.required)for(const n of t.required)e+=n.compiledKey+" | ";if(t.optional)for(const n of t.optional)e+=n.compiledKey+" | ";if(t.index)for(const n of t.index)e+=n.signature.id+" | ";if(t.sequence)if(t.sequence.maxLength===null)e+=S.nonNegativeIntegerString.id;else for(let n=0;n<t.sequence.tuple.length;n++)e+=n+" | ";e+=")"}return e},ag=t=>{const e=og(t);if(!e)return;if(Ai[e])return Ai[e];const n=(r,i)=>{for(let s=0;s<t.defaultable.length;s++)t.defaultable[s].key in r||t.defaultable[s].defaultValueMorph(r,i);if(t.sequence?.defaultables)for(let s=r.length-t.sequence.prefixLength;s<t.sequence.defaultables.length;s++)t.sequence.defaultValueMorphs[s](r,i);if(t.undeclared==="delete")for(const s in r)t.declaresKey(s)||delete r[s];return r};return Ai[e]=n},lg=(t,e)=>{const r=`(data${e.defaultable.some(i=>i.defaultValueMorph.length===2)||e.sequence?.defaultValueMorphs.some(i=>i.length===2)?", ctx":""})`;return t.block(`${r} => `,i=>{for(let s=0;s<e.defaultable.length;s++){const{serializedKey:o,defaultValueMorphRef:a}=e.defaultable[s];i.if(`!(${o} in data)`,l=>l.line(`${a}${r}`))}return e.sequence?.defaultables&&i.for(`i < ${e.sequence.defaultables.length}`,s=>s.set("data[i]",5),`data.length - ${e.sequence.prefixLength}`),e.undeclared==="delete"&&i.forIn("data",s=>s.if(`!(${e._compileDeclaresKey(s)})`,o=>o.line("delete data[k]"))),i.return("data")})},Bc={implementation:ig,Node:sg},cg=t=>($(t,"root")&&t.hasKind("unit")&&(t=t.unit),typeof t=="number"&&(t=`${t}`),t),ug=(t,e)=>`${t} is not allowed as an array index on ${e}. Use the 'nonNegativeIntegerString' keyword instead.`,Xi=(t,e,n)=>{const[r,i]=od(t.branches,o=>o.hasKind("unit"));if(!r.length)return{index:n.node("index",{signature:t,value:e})};const s={};for(const o of r){const a=n.node("required",{key:o.unit,value:e});s[a.kind]=P(s[a.kind],a)}return i.length&&(s.index=n.node("index",{signature:i,value:e})),s},hg=t=>$(t,"root")?t.expression:L(t),oa=(t,e)=>`Key${e.length===1?"":"s"} ${e.map(hg).join(", ")} ${e.length===1?"does":"do"} not exist on ${t}`,Jr={...Qp,alias:Ps.implementation,domain:qs.implementation,unit:Mc.implementation,proto:Mr.implementation,union:Cc.implementation,morph:Rc.implementation,intersection:Ic.implementation,divisor:fc.implementation,pattern:_c.implementation,predicate:hc.implementation,required:Lc.implementation,optional:Ds.implementation,index:Dc.implementation,sequence:Pc.implementation,structure:Bc.implementation};y.defaultConfig=yd(Object.assign(z(Jr,(t,e)=>[t,e.defaults]),{jitless:Nd(),clone:Ad,onUndeclaredKey:"ignore",exactOptionalPropertyTypes:!0,numberAllowsNaN:!1,dateAllowsInvalid:!1,onFail:null,keywords:{},toJsonSchema:X.defaultConfig}));y.resolvedConfig=Ji(y.defaultConfig,y.config);const fg={...em,alias:Ps.Node,domain:qs.Node,unit:Mc.Node,proto:Mr.Node,union:Cc.Node,morph:Rc.Node,intersection:Ic.Node,divisor:fc.Node,pattern:_c.Node,predicate:hc.Node,required:Lc.Node,optional:Ds.Node,index:Dc.Node,sequence:Pc.Node,structure:Bc.Node};class Qi extends dd{get[Qe](){return"module"}}const Kc=(t,e)=>new Qi(z(t,(n,r)=>[n,$(r,"module")?Kc(r,e):e.bindReference(r)])),dg=t=>oe(t)?t:"branches"in t&&oe(t.branches)?t.branches:void 0,pg=(t,e)=>b(`Node of kind ${e} is not valid as a ${t} definition`),aa=t=>`#${t} duplicates public alias ${t}`,Si={};y.ambient??={};let la;const Fc="function $",mg=t=>Uc(t,jc(t)),Uc=(t,e)=>{const n=e.write(Fc,4),r=e.compile()();for(const i of t)i.precompilation||(i.traverseAllows=r[`${i.id}Allows`].bind(r),i.isRoot()&&!i.allowsRequiresContext&&(i.allows=i.traverseAllows),i.traverseApply=r[`${i.id}Apply`].bind(r),r[`${i.id}Optimistic`]&&(i.traverseOptimistic=r[`${i.id}Optimistic`].bind(r)),i.precompilation=n)},jc=t=>new Ql().return(t.reduce((e,n)=>{const r=new $i({kind:"Allows"}).indent();n.compile(r);const i=r.write(`${n.id}Allows`),s=new $i({kind:"Apply"}).indent();n.compile(s);const o=s.write(`${n.id}Apply`),a=`${e}${i},
${o},
`;if(!n.hasKind("union"))return a;const l=new $i({kind:"Allows",optimistic:!0}).indent();n.compile(l);const c=l.write(`${n.id}Optimistic`);return`${a}${c},
`},`{
`)+"}");class Hc{config;resolvedConfig;name;get[Qe](){return"scope"}referencesById={};references=[];resolutions={};exportedNames=[];aliases={};resolved=!1;nodesByHash={};intrinsic;constructor(e,n){this.config=Ji(y.config,n),this.resolvedConfig=Ji(y.resolvedConfig,n),this.name=this.resolvedConfig.name??`anonymousScope${Object.keys(Si).length}`,this.name in Si&&b(`A Scope already named ${this.name} already exists`),Si[this.name]=this;const r=Object.entries(e).map(i=>this.preparseOwnAliasEntry(...i));for(const[i,s]of r){let o=i;if(i[0]==="#"?(o=i.slice(1),o in this.aliases&&b(aa(o)),this.aliases[o]=s):(o in this.aliases&&b(aa(i)),this.aliases[o]=s,this.exportedNames.push(o)),!$(s,"module")&&!$(s,"generic")&&!Kr(s)){const a=this.preparseOwnDefinitionFormat(s,{alias:o});this.resolutions[o]=$(a,"root")?this.bindReference(a):this.createParseContext(a).id}}la??=this.node("union",{branches:["string","number","object","bigint","symbol",{unit:!0},{unit:!1},{unit:void 0},{unit:null}]},{prereduced:!0}),this.nodesByHash[la.hash]=this.node("intersection",{},{prereduced:!0}),this.intrinsic=y.intrinsic?z(y.intrinsic,(i,s)=>i.startsWith("json")?[]:[i,this.bindReference(s)]):{}}cacheGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}get internal(){return this}_json;get json(){return this._json||this.export(),this._json}defineSchema(e){return e}generic=(...e)=>{const n=this;return(r,i)=>new Cr(e,i?new uc(r):r,n,n,i??null)};units=(e,n)=>{const r=[];for(const s of e)r.includes(s)||r.push(s);const i=r.map(s=>this.node("unit",{unit:s},n));return this.node("union",i,{...n,prereduced:!0})};lazyResolutions=[];lazilyResolve(e,n){const r=this.node("alias",{reference:n??"synthetic",resolve:e},{prereduced:!0});return this.resolved||this.lazyResolutions.push(r),r}schema=(e,n)=>this.finalize(this.parseSchema(e,n));parseSchema=(e,n)=>this.node(kr(e),e,n);preparseNode(e,n,r){let i=typeof e=="string"?e:kr(n,e);if(ue(n)&&n.kind===i)return n;if(i==="alias"&&!r?.prereduced){const{reference:a}=Ps.implementation.normalize(n,this);if(a.startsWith("$")){const l=this.resolveRoot(a.slice(1));n=l,i=l.kind}}else if(i==="union"&&It(n,"object")){const a=dg(n);a?.length===1&&(n=a[0],i=kr(n))}if(ue(n)&&n.kind===i)return n;const o=Jr[i].normalize?.(n,this)??n;return ue(o)?o.kind===i?o:pg(i,o.kind):{...r,$:this,kind:i,def:o,prefix:r.alias??i}}bindReference(e){let n;return ue(e)?n=e.$===this?e:new e.constructor(e.attachments,this):n=e.$===this?e:new Cr(e.params,e.bodyDef,e.$,this,e.hkt),this.resolved||Object.assign(this.referencesById,n.referencesById),n}resolveRoot(e){return this.maybeResolveRoot(e)??b(Wc(e))}maybeResolveRoot(e){const n=this.maybeResolve(e);if(!$(n,"generic"))return n}maybeResolveSubalias(e){return es(this.aliases,e)??es(this.ambient,e)}get ambient(){return y.ambient}maybeResolve(e){const n=this.resolutions[e];if(n){if(typeof n!="string")return this.bindReference(n);const i=Se[n];if($(i,"root"))return this.resolutions[e]=i;if($(i,"context")){if(i.phase==="resolving")return this.node("alias",{reference:`$${e}`},{prereduced:!0});if(i.phase==="resolved")return G(`Unexpected resolved context for was uncached by its scope: ${L(i)}`);i.phase="resolving";const s=this.bindReference(this.parseOwnDefinitionFormat(i.def,i));return i.phase="resolved",Se[s.id]=s,Se[i.id]=s,this.resolutions[e]=s}return G(`Unexpected nodesById entry for ${n}: ${L(i)}`)}let r=this.aliases[e]??this.ambient?.[e];return r?(r=this.normalizeRootScopeValue(r),$(r,"generic")?this.resolutions[e]=this.bindReference(r):$(r,"module")?(r.root||b(Zc(e)),this.resolutions[e]=this.bindReference(r.root)):this.resolutions[e]=this.parse(r,{alias:e})):this.maybeResolveSubalias(e)}createParseContext(e){const n=e.id??Ac(e.prefix);return Se[n]=Object.assign(e,{[Qe]:"context",$:this,id:n,phase:"unresolved"})}traversal(e){return new Ft(e,this.resolvedConfig)}import(...e){return new Qi(z(this.export(...e),(n,r)=>[`#${n}`,r]))}precompilation;_exportedResolutions;_exports;export(...e){if(!this._exports){this._exports={};for(const r of this.exportedNames){const i=this.aliases[r];this._exports[r]=$(i,"module")?Kc(i,this):ca(this.maybeResolve(r))}for(const r of this.lazyResolutions)r.resolution;if(this._exportedResolutions=Gc(this,this._exports),this._json=Jc(this._exportedResolutions),Object.assign(this.resolutions,this._exportedResolutions),this.references=Object.values(this.referencesById),!this.resolvedConfig.jitless){const r=jc(this.references);this.precompilation=r.write(Fc,4),Uc(this.references,r)}this.resolved=!0}const n=e.length?e:this.exportedNames;return new Qi(z(n,(r,i)=>[i,this._exports[i]]))}resolve(e){return this.export()[e]}node=(e,n,r={})=>{const i=this.preparseNode(e,n,r);if(ue(i))return this.bindReference(i);const s=this.createParseContext(i),o=Sc(s),a=this.bindReference(o);return Se[s.id]=a};parse=(e,n={})=>this.finalize(this.parseDefinition(e,n));parseDefinition(e,n={}){if($(e,"root"))return this.bindReference(e);const r=this.preparseOwnDefinitionFormat(e,n);if($(r,"root"))return this.bindReference(r);const i=this.createParseContext(r);Se[i.id]=i;let s=this.bindReference(this.parseOwnDefinitionFormat(e,i));return s.isCyclic&&(s=sm(s,i.id)),Se[i.id]=s,s}finalize(e){return ca(e),!e.precompilation&&!this.resolvedConfig.jitless&&mg(e.references),e}}class Vc extends Hc{parseOwnDefinitionFormat(e,n){return Sc(n)}preparseOwnDefinitionFormat(e,n){return this.preparseNode(kr(e),e,n)}preparseOwnAliasEntry(e,n){return[e,n]}normalizeRootScopeValue(e){return e}}const ca=t=>{const e=t.references.filter(n=>n.hasKind("alias"));for(const n of e){Object.assign(n.referencesById,n.resolution.referencesById);for(const r of t.references)n.id in r.referencesById&&Object.assign(r.referencesById,n.referencesById)}return t},Jc=t=>z(t,(e,n)=>[e,$(n,"root")||$(n,"generic")?n.json:$(n,"module")?Jc(n):G(`Unexpected resolution ${L(n)}`)]),es=(t,e)=>{const n=e.indexOf(".");if(n===-1)return;const r=e.slice(0,n),i=t[r];if(i===void 0)return;if(!$(i,"module"))return b(gg(r));const s=e.slice(n+1),o=i[s];if(o===void 0)return es(i,s);if($(o,"root")||$(o,"generic"))return o;if($(o,"module"))return o.root??b(Zc(e));G(`Unexpected resolution for alias '${e}': ${L(o)}`)},Bs=(t,e)=>new Vc(t,e),Zn=new Vc({}),Gc=(t,e)=>{const n={};for(const r in e){const i=e[r];if($(i,"module")){const s=Gc(t,i),o=z(s,(a,l)=>[`${r}.${a}`,l]);Object.assign(n,o)}else $(i,"root")||$(i,"generic")?n[r]=i:G(`Unexpected scope resolution ${L(i)}`)}return n},Wc=t=>`'${t}' is unresolvable`,gg=t=>`'${t}' must reference a module to be accessed using dot syntax`,Zc=t=>`Reference to submodule '${t}' must specify an alias`;Zn.export();const q=Zn.schema,Ks=Zn.node;Zn.defineSchema;const rt=Zn.generic,Yc="^(?:0|[1-9]\\d*)$",bg=new RegExp(Yc);fe(bg);const Xc=Bs({bigint:"bigint",boolean:[{unit:!1},{unit:!0}],false:{unit:!1},never:[],null:{unit:null},number:"number",object:"object",string:"string",symbol:"symbol",true:{unit:!0},unknown:{},undefined:{unit:void 0},Array,Date},{prereducedAliases:!0}).export();y.intrinsic={...Xc};const Qc=Bs({integer:{domain:"number",divisor:1},lengthBoundable:["string",Array],key:["string","symbol"],nonNegativeIntegerString:{domain:"string",pattern:Yc}},{prereducedAliases:!0}).export();Object.assign(y.intrinsic,Qc);const yg=Bs({jsonPrimitive:["string","number",{unit:!0},{unit:!1},{unit:null}],jsonObject:{domain:"object",index:{signature:"string",value:"$jsonData"}},jsonData:["$jsonPrimitive","$jsonObject"]},{prereducedAliases:!0}).export(),S={...Xc,...Qc,...yg,emptyStructure:Ks("structure",{},{prereduced:!0})};y.intrinsic={...S};const vg=t=>typeof t=="string"&&t[0]==="d"&&(t[1]==="'"||t[1]==='"')&&t.at(-1)===t[1],ua=t=>t.toString()!=="Invalid Date",kg=t=>t.slice(2,-1),eu=t=>`'${t}' could not be parsed by the Date constructor`,xg=(t,e)=>wg(t,e),wg=(t,e)=>{const n=new Date(t);if(ua(n))return n;const r=Vd(t);if(r!==void 0){const i=new Date(r);if(ua(i))return i}return e?b(e===!0?eu(t):e):void 0},ha=(t,e)=>{const n=t.scanner.shiftUntil(_g[nu[e]]);if(t.scanner.lookahead==="")return t.error(Sg(n,e));if(t.scanner.shift(),e==="/"){try{new RegExp(n)}catch(r){b(String(r))}t.root=t.ctx.$.node("intersection",{domain:"string",pattern:n},{prereduced:!0})}else if(Ke(e,tu))t.root=t.ctx.$.node("unit",{unit:n});else{const r=xg(n,eu(n));t.root=t.ctx.$.node("unit",{meta:n,unit:r})}},tu={"'":1,'"':1},$g={"/":1,"'":1,'"':1},nu={"d'":"'",'d"':'"',"'":"'",'"':'"',"/":"/"},_g={"'":t=>t.lookahead==="'",'"':t=>t.lookahead==='"',"/":t=>t.lookahead==="/"},Ag={'"':"double-quote","'":"single-quote","/":"forward slash"},Sg=(t,e)=>`${e}${t} requires a closing ${Ag[nu[e]]}`,Eg=t=>`Private type references should not include '#'. Use '${t}' instead.`,ru="Optional definitions like 'string?' are only valid as properties in an object or tuple",iu="Defaultable definitions like 'number = 0' are only valid as properties in an object or tuple",Ng={">":!0,">=":!0},Tg={"<":!0,"<=":!0},Dr={"<":">",">":"<","<=":">=",">=":"<=","==":"=="},Ig=t=>`Unmatched )${t===""?"":` before ${t}`}`,su=t=>`Missing ${t}`,Rg=(t,e)=>`Left bounds are only valid when paired with right bounds (try ...${e}${t})`,ou=t=>`Left-bounded expressions must specify their limits using < or <= (was ${t})`,Og=(t,e,n,r)=>`An expression may have at most one left bound (parsed ${t}${Dr[e]}, ${n}${Dr[r]})`,Cg=(t,e,n)=>au(t,e,n,[]),au=(t,e,n,r)=>{const i=n.parseUntilFinalizer();return r.push(i.root),i.finalizer===">"?r.length!==e.params.length?n.error(lu(t,e.names,r.map(s=>s.expression))):r:i.finalizer===","?au(t,e,n,r):i.error(su(">"))},lu=(t,e,n)=>`${t}<${e.join(", ")}> requires exactly ${e.length} args (got ${n.length}${n.length===0?"":`: ${n.join(", ")}`})`,fa=t=>{const e=t.scanner.shiftUntilNextTerminator();e==="keyof"?t.addPrefix("keyof"):t.root=Dg(t,e)},Mg=(t,e,n)=>{if(n.scanner.shiftUntilNonWhitespace(),n.scanner.shift()!=="<")return n.error(lu(t,e.names,[]));const i=Cg(t,e,n);return e(...i)},Dg=(t,e)=>Lg(t,e)??Pg(t,e)??t.error(e===""?t.scanner.lookahead==="#"?Eg(t.shiftedByOne().scanner.shiftUntilNextTerminator()):cu(t):Wc(e)),Lg=(t,e)=>{if(t.ctx.args?.[e]){const r=t.ctx.args[e];return typeof r!="string"?r:t.ctx.$.node("alias",{reference:r},{prereduced:!0})}const n=t.ctx.$.maybeResolve(e);if($(n,"root"))return n;if(n!==void 0)return $(n,"generic")?Mg(e,n,t):b(`Unexpected resolution ${L(n)}`)},Pg=(t,e)=>{const n=Jd(e);if(n!==void 0)return t.ctx.$.node("unit",{unit:n});const r=Wd(e);if(r!==void 0)return t.ctx.$.node("unit",{unit:r})},cu=t=>{const e=t.previousOperator();return e?uu(e,t.scanner.unscanned):zg(t.scanner.unscanned)},uu=(t,e="")=>`Token '${t}' requires a right operand${e?` before '${e}'`:""}`,zg=t=>`Expected an expression${t?` before '${t}'`:""}`,hu=t=>t.scanner.lookahead===""?t.error(cu(t)):t.scanner.lookahead==="("?t.shiftedByOne().reduceGroupOpen():t.scanner.lookaheadIsIn($g)?ha(t,t.scanner.shift()):t.scanner.lookaheadIsIn(Fr)?hu(t.shiftedByOne()):t.scanner.lookahead==="d"&&t.scanner.nextLookahead in tu?ha(t,`${t.scanner.shift()}${t.scanner.shift()}`):fa(t);class nn extends rp{shiftUntilNextTerminator(){return this.shiftUntilNonWhitespace(),this.shiftUntil(()=>this.lookahead in nn.terminatingChars)}static terminatingChars={"<":1,">":1,"=":1,"|":1,"&":1,")":1,"[":1,"%":1,",":1,":":1,"?":1,"#":1,...Fr};static finalizingLookaheads={">":1,",":1,"":1,"=":1,"?":1};static lookaheadIsFinalizing=(e,n)=>e===">"?n[0]==="="?n[1]==="=":n.trimStart()===""||Ke(n.trimStart()[0],nn.terminatingChars):e==="="?n[0]!=="=":e===","||e==="?"}const qg=(t,e)=>{const n=Kg(t,e);if(t.root.hasKind("unit")){if(typeof t.root.unit=="number"){t.reduceLeftBound(t.root.unit,n),t.unsetRoot();return}if(t.root.unit instanceof Date){const r=`d'${t.root.description??t.root.unit.toISOString()}'`;t.unsetRoot(),t.reduceLeftBound(r,n);return}}return Ug(t,n)},Bg={"<":1,">":1,"=":1},Kg=(t,e)=>t.scanner.lookaheadIs("=")?`${e}${t.scanner.shift()}`:e,da=(t,e,n,r)=>n.extends(y.intrinsic.number)?typeof e!="number"?b(ts(t,e,r)):t==="=="?["min","max"]:t[0]===">"?["min"]:["max"]:n.extends(y.intrinsic.lengthBoundable)?typeof e!="number"?b(ts(t,e,r)):t==="=="?["exactLength"]:t[0]===">"?["minLength"]:["maxLength"]:n.extends(y.intrinsic.Date)?t==="=="?["after","before"]:t[0]===">"?["after"]:["before"]:b(zp(n.expression)),Fg=t=>({rule:vg(t.limit)?kg(t.limit):t.limit,exclusive:t.comparator.length===1}),Ug=(t,e)=>{const n=t.unsetRoot(),r=t.scanner.location;t.parseOperand();const i=t.unsetRoot(),s=t.scanner.sliceChars(r,t.scanner.location);if(t.root=n,!i.hasKind("unit")||typeof i.unit!="number"&&!(i.unit instanceof Date))return t.error(ts(e,s,"right"));const o=i.unit,a=e.length===1,l=da(e,typeof o=="number"?o:s,n,"right");for(const u of l)t.constrainRoot(u,e==="=="?{rule:o}:{rule:o,exclusive:a});if(!t.branches.leftBound)return;if(!Ke(e,Tg))return t.error(ou(e));const c=da(t.branches.leftBound.comparator,t.branches.leftBound.limit,n,"left");t.constrainRoot(c[0],Fg(t.branches.leftBound)),t.branches.leftBound=null},ts=(t,e,n)=>`Comparator ${n==="left"?Dr[t]:t} must be ${n==="left"?"preceded":"followed"} by a corresponding literal (was ${e})`,jg=t=>{t.scanner.shiftUntilNonWhitespace();const e=t.scanner.shiftUntilNextTerminator();t.root=t.root.brand(e)},Hg=t=>{const e=t.scanner.shiftUntilNextTerminator(),n=Gd(e,{errorOnFail:pa(e)});n===0&&t.error(pa(0)),t.root=t.root.constrain("divisor",n)},pa=t=>`% operator must be followed by a non-zero integer literal (was ${t})`,fu=t=>{const e=t.scanner.shift();return e===""?t.finalize(""):e==="["?t.scanner.shift()==="]"?t.setRoot(t.root.array()):t.error(Vg):e==="|"?t.scanner.lookahead===">"?t.shiftedByOne().pushRootToBranch("|>"):t.pushRootToBranch(e):e==="&"?t.pushRootToBranch(e):e===")"?t.finalizeGroup():nn.lookaheadIsFinalizing(e,t.scanner.unscanned)?t.finalize(e):Ke(e,Bg)?qg(t,e):e==="%"?Hg(t):e==="#"?jg(t):e in Fr?fu(t):t.error(Fs(e))},Fs=(t,e="")=>`'${t}' is not allowed here${e&&` (should be ${e})`}`,Vg="Missing expected ']'",Jg=t=>{const e=t.unsetRoot();t.parseOperand();const n=t.unsetRoot();if(!n.hasKind("unit"))return t.error(Gg(n.expression));const r=n.unit instanceof Date?()=>new Date(n.unit):n.unit;return[e,"=",r]},Gg=t=>`Default value '${t}' must a literal value`,ma=(t,e)=>{const n=e.$.maybeResolveRoot(t);if(n)return n;if(t.endsWith("[]")){const s=e.$.maybeResolveRoot(t.slice(0,-2));if(s)return s.array()}const r=new Gr(new nn(t),e),i=Wg(r);return r.finalizer===">"&&b(Fs(">")),i},Wg=t=>{t.parseOperand();let e=Us(t).root;return e?(t.finalizer==="="?e=Jg(t):t.finalizer==="?"&&(e=[e,"?"]),t.scanner.shiftUntilNonWhitespace(),t.scanner.lookahead&&b(Fs(t.scanner.lookahead)),e):G(`Root was unexpectedly unset after parsing string '${t.scanner.scanned}'`)},Us=t=>{for(;t.finalizer===void 0;)Zg(t);return t},Zg=t=>t.hasRoot()?t.parseOperator():t.parseOperand();class Gr{root;branches={prefixes:[],leftBound:null,intersection:null,union:null,pipe:null};finalizer;groups=[];scanner;ctx;constructor(e,n){this.scanner=e,this.ctx=n}error(e){return b(e)}hasRoot(){return this.root!==void 0}setRoot(e){this.root=e}unsetRoot(){const e=this.root;return this.root=void 0,e}constrainRoot(...e){this.root=this.root.constrain(e[0],e[1])}finalize(e){if(this.groups.length)return this.error(su(")"));this.finalizeBranches(),this.finalizer=e}reduceLeftBound(e,n){const r=Dr[n];if(!Ke(r,Ng))return this.error(ou(n));if(this.branches.leftBound)return this.error(Og(this.branches.leftBound.limit,this.branches.leftBound.comparator,e,r));this.branches.leftBound={comparator:r,limit:e}}finalizeBranches(){if(this.assertRangeUnset(),this.branches.pipe){this.pushRootToBranch("|>"),this.root=this.branches.pipe;return}if(this.branches.union){this.pushRootToBranch("|"),this.root=this.branches.union;return}if(this.branches.intersection){this.pushRootToBranch("&"),this.root=this.branches.intersection;return}this.applyPrefixes()}finalizeGroup(){this.finalizeBranches();const e=this.groups.pop();if(!e)return this.error(Ig(this.scanner.unscanned));this.branches=e}addPrefix(e){this.branches.prefixes.push(e)}applyPrefixes(){for(;this.branches.prefixes.length;){const e=this.branches.prefixes.pop();this.root=e==="keyof"?this.root.keyof():G(`Unexpected prefix '${e}'`)}}pushRootToBranch(e){this.assertRangeUnset(),this.applyPrefixes();const n=this.root;this.root=void 0,this.branches.intersection=this.branches.intersection?.rawAnd(n)??n,e!=="&"&&(this.branches.union=this.branches.union?.rawOr(this.branches.intersection)??this.branches.intersection,this.branches.intersection=null,e!=="|"&&(this.branches.pipe=this.branches.pipe?.rawPipeOnce(this.branches.union)??this.branches.union,this.branches.union=null))}parseUntilFinalizer(){return Us(new Gr(this.scanner,this.ctx))}parseOperator(){return fu(this)}parseOperand(){return hu(this)}assertRangeUnset(){if(this.branches.leftBound)return this.error(Rg(this.branches.leftBound.limit,this.branches.leftBound.comparator))}reduceGroupOpen(){this.groups.push(this.branches),this.branches={prefixes:[],leftBound:null,union:null,intersection:null,pipe:null}}previousOperator(){return this.branches.leftBound?.comparator??this.branches.prefixes.at(-1)??(this.branches.intersection?"&":this.branches.union?"|":this.branches.pipe?"|>":void 0)}shiftedByOne(){return this.scanner.shift(),this}}const Yg="An empty string is not a valid generic parameter name",ns=(t,e,n)=>{t.shiftUntilNonWhitespace();const r=t.shiftUntilNextTerminator();return r===""?t.lookahead===""&&e.length?e:b(Yg):(t.shiftUntilNonWhitespace(),Xg(t,r,e,n))},ga="extends ",Xg=(t,e,n,r)=>{if(t.shiftUntilNonWhitespace(),t.unscanned.startsWith(ga))t.jumpForward(ga.length);else return t.lookahead===","&&t.shift(),n.push(e),ns(t,n,r);const i=Us(new Gr(t,r));return n.push([e,i.root]),ns(t,n,r)};class Qg extends an{$;constructor(e){super((...n)=>new dr(e)(...n),{bind:e}),this.$=e}in(e){return new dr(this.$,e===void 0?void 0:this.$.parse(e))}at(e,n){return new dr(this.$).at(e,n)}case(e,n){return new dr(this.$).case(e,n)}}class dr extends an{$;in;key;branches=[];constructor(e,n){super(r=>this.caseEntries(Object.entries(r).map(([i,s])=>i==="default"?[i,s]:[this.$.parse(i),s]))),this.$=e,this.in=n}at(e,n){return this.key&&b(tb),this.branches.length&&b(eb),this.key=e,n?this.match(n):this}case(e,n){return this.caseEntry(this.$.parse(e),n)}caseEntry(e,n){const i=(this.key?this.$.parse({[this.key]:e}):e).pipe(n);return this.branches.push(i),this}match(e){return this(e)}strings(e){return this.caseEntries(Object.entries(e).map(([n,r])=>n==="default"?[n,r]:[this.$.node("unit",{unit:n}),r]))}caseEntries(e){for(let n=0;n<e.length;n++){const[r,i]=e[n];if(r==="default")return n!==e.length-1&&b("default may only be specified as the last key of a switch definition"),this.default(i);if(typeof i!="function")return b(`Value for case "${r}" must be a function (was ${Me(i)})`);this.caseEntry(r,i)}return this}default(e){typeof e=="function"&&this.case(S.unknown,e);const n={branches:this.branches,ordered:!0};(e==="never"||e==="assert")&&(n.meta={onFail:ba});const r=this.$.node("union",n);if(!this.in)return this.$.finalize(r);let i=this.in.pipe(r);return(e==="never"||e==="assert")&&(i=i.configureReferences({onFail:ba},"self")),this.$.finalize(i)}}const ba=t=>t.throw(),eb="A key matcher must be specified before the first case i.e. match.at('foo') or match.in<object>().at('bar')",tb="At most one key matcher may be specified per expression",du=(t,e)=>{if(oe(t)){if(t[1]==="=")return[e.$.parseOwnDefinitionFormat(t[0],e),"=",t[2]];if(t[1]==="?")return[e.$.parseOwnDefinitionFormat(t[0],e),"?"]}return ku(t,e)},nb="Only required keys may make their values optional, e.g. { [mySymbol]: ['number', '?'] }",rb="Only required keys may specify default values, e.g. { value: 'number = 0' }",ib=(t,e)=>{let n;const r={},i=Er(t);for(const[o,a]of i){const l=ab(o);if(l.kind==="spread"){if(!Un(r))return b(ob);const m=e.$.parseOwnDefinitionFormat(a,e);if(m.equals(S.object))continue;if(!m.hasKind("intersection")||!m.basis?.equals(S.object))return b(lb(m.expression));n=m.structure;continue}if(l.kind==="undeclared"){a!=="reject"&&a!=="delete"&&a!=="ignore"&&b(sb(a)),r.undeclared=a;continue}const c=du(a,e),u=l;if(l.kind==="required"){oe(c)?Ei(r,"optional",c[1]==="="?{key:l.normalized,value:c[0],default:c[2]}:{key:l.normalized,value:c[0]},e):Ei(r,"required",{key:l.normalized,value:c},e);continue}if(oe(c)&&(c[1]==="?"&&b(nb),c[1]==="="&&b(rb)),l.kind==="optional"){Ei(r,"optional",{key:l.normalized,value:c},e);continue}const f=e.$.parseOwnDefinitionFormat(u.normalized,e),d=Xi(f,c,e.$);d.index&&(r.index=P(r.index,d.index)),d.required&&(r.required=P(r.required,d.required))}const s=e.$.node("structure",r);return e.$.parseSchema({domain:"object",structure:n?.merge(s)??s})},Ei=(t,e,n,r)=>{t[e]=P(t[e],r.$.node(e,n))},sb=t=>`Value of '+' key must be 'reject', 'delete', or 'ignore' (was ${L(t)})`,ob="Spread operator may only be used as the first key in an object",ab=t=>typeof t=="symbol"?{kind:"required",normalized:t}:t.at(-1)==="?"?t.at(-2)===Fi?{kind:"required",normalized:`${t.slice(0,-2)}?`}:{kind:"optional",normalized:t.slice(0,-1)}:t[0]==="["&&t.at(-1)==="]"?{kind:"index",normalized:t.slice(1,-1)}:t[0]===Fi&&t[1]==="["&&t.at(-1)==="]"?{kind:"required",normalized:t.slice(1)}:t==="..."?{kind:"spread"}:t==="+"?{kind:"undeclared"}:{kind:"required",normalized:t==="\\..."?"...":t==="\\+"?"+":t},lb=t=>`Spread operand must resolve to an object literal type (was ${t})`,cb=(t,e)=>vb(t)?bu[t[0]](t,e):bb(t)?gu[t[1]](t,e):null,ub=(t,e)=>e.$.parseOwnDefinitionFormat(t[1],e).keyof(),Ni=(t,e)=>{if(t[2]===void 0)return b(uu(t[1],""));const n=e.$.parseOwnDefinitionFormat(t[0],e),r=e.$.parseOwnDefinitionFormat(t[2],e);if(t[1]==="|")return e.$.node("union",{branches:[n,r]});const i=t[1]==="&"?nt(n,r,e.$):Wi(n,r,e.$);return i instanceof x?i.throw():i},hb=(t,e)=>e.$.parseOwnDefinitionFormat(t[0],e).array(),fb=(t,e)=>typeof t[2]!="function"?b(pu("=>",t[2])):e.$.parseOwnDefinitionFormat(t[0],e).pipe(t[2]),pu=(t,e)=>`${t===":"?"Narrow":"Morph"} expression requires a function following '${t}' (was ${typeof e})`,db=(t,e)=>typeof t[2]!="function"?b(pu(":",t[2])):e.$.parseOwnDefinitionFormat(t[0],e).constrain("predicate",t[2]),pb=(t,e)=>e.$.parseOwnDefinitionFormat(t[0],e).configureReferences(t[2],"shallow"),mu=t=>t,mb=mu({"[]":hb,"?":()=>b(ru)}),gb=mu({"|":Ni,"&":Ni,":":db,"=>":fb,"|>":Ni,"@":pb,"=":()=>b(iu)}),gu={...mb,...gb},bb=t=>gu[t[1]]!==void 0,yb=t=>t,bu=yb({keyof:ub,instanceof:(t,e)=>{if(typeof t[1]!="function")return b(ya(Ki(t[1])));const n=t.slice(1).map(r=>typeof r=="function"?e.$.node("proto",{proto:r}):b(ya(Ki(r))));return n.length===1?n[0]:e.$.node("union",{branches:n})},"===":(t,e)=>e.$.units(t.slice(1))}),vb=t=>bu[t[0]]!==void 0,ya=t=>`Expected a constructor following 'instanceof' operator (was ${t})`,kb=(t,e)=>{let n=[{}],r=0;for(;r<t.length;){let i=!1;t[r]==="..."&&r<t.length-1&&(i=!0,r++);const s=du(t[r],e),[o,a,l]=oe(s)?s:[s];if(r++,i){if(!o.extends(y.intrinsic.Array))return b($b(o.expression));n=n.flatMap(c=>o.distribute(u=>wb(nc(c),u)))}else n=n.map(c=>a==="?"?yu(c,o):a==="="?xb(c,o,l):rs(c,o))}return e.$.parseSchema(n.map(i=>Un(i)?{proto:Array,exactLength:0}:{proto:Array,sequence:i}))},rs=(t,e)=>t.defaultables||t.optionals?b(t.variadic?zc:_b):(t.variadic?t.postfix=P(t.postfix,e):t.prefix=P(t.prefix,e),t),yu=(t,e)=>t.variadic?b(vu):(t.optionals=P(t.optionals,e),t),xb=(t,e,n)=>t.variadic?b(vu):t.optionals?b(Ab):(t.defaultables=P(t.defaultables,[[e,n]]),t),va=(t,e)=>(t.postfix&&b(ka),t.variadic?t.variadic.equals(e)||b(ka):t.variadic=e.internal,t),wb=(t,e)=>{const n=e.select({method:"find",kind:"sequence"});if(!n)return va(t,y.intrinsic.unknown);if(n.prefix)for(const r of n.prefix)rs(t,r);if(n.optionals)for(const r of n.optionals)yu(t,r);if(n.variadic&&va(t,n.variadic),n.postfix)for(const r of n.postfix)rs(t,r);return t},$b=t=>`Spread element must be an array (was ${t})`,ka="A tuple may have at most one variadic element",_b="A required element may not follow an optional element",vu="An optional element may not follow a variadic element",Ab="A defaultable element may not follow an optional element without a default",Sb={},ku=(t,e)=>{if(typeof t=="string"){if(e.args&&Object.keys(e.args).some(r=>t.includes(r)))return ma(t,e);const n=Sb[e.$.name]??={};return n[t]??=ma(t,e)}return It(t,"object")?Eb(t,e):b(is(Me(t)))},Eb=(t,e)=>{const n=Es(t);switch(n){case void 0:return $(t,"root")?t:ib(t,e);case"Array":return Nb(t,e);case"RegExp":return e.$.node("intersection",{domain:"string",pattern:t},{prereduced:!0});case"Function":{const r=Kr(t)?t():t;return $(r,"root")?r:b(is("Function"))}default:return b(is(n??L(t)))}},Nb=(t,e)=>cb(t,e)??kb(t,e),is=t=>`Type definitions must be strings or objects (was ${t})`;class Tb extends an{constructor(e){const n=Object.assign({errors:et,hkt:Fe,$:e,raw:e.parse,module:e.constructor.module,scope:e.constructor.scope,define:e.define,match:e.match,generic:e.generic,schema:e.schema,keywords:e.ambient,unit:e.unit,enumerated:e.enumerated,instanceOf:e.instanceOf,valueOf:e.valueOf,or:e.or,and:e.and,merge:e.merge,pipe:e.pipe},e.ambientAttachments);super((...r)=>{if(r.length===1)return e.parse(r[0]);if(r.length===2&&typeof r[0]=="string"&&r[0][0]==="<"&&r[0].at(-1)===">"){const i=r[0].slice(1,-1),s=e.parseGenericParams(i,{});return new Cr(s,r[1],e,e,null)}return e.parse(r)},{bind:e,attach:n})}}const Dn=y;class Wr extends Hc{get ambientAttachments(){if(Dn.typeAttachments)return this.cacheGetter("ambientAttachments",z(Dn.typeAttachments,(e,n)=>[e,this.bindReference(n)]))}preparseOwnAliasEntry(e,n){const r=e.indexOf("<");if(r===-1){if($(n,"module")||$(n,"generic"))return[e,n];const o=this.name==="ark"?e:e==="root"?this.name:`${this.name}.${e}`,a=this.resolvedConfig.keywords?.[o];return a&&(n=[n,"@",a]),[e,n]}e.at(-1)!==">"&&b("'>' must be the last character of a generic declaration in a scope");const i=e.slice(0,r),s=e.slice(r+1,-1);return[i,()=>{const o=this.parseGenericParams(s,{alias:i});return _p(o,n,this)}]}parseGenericParams(e,n){return ns(new nn(e),[],this.createParseContext({...n,def:e,prefix:"generic"}))}normalizeRootScopeValue(e){return Kr(e)&&!$(e,"generic")?e():e}preparseOwnDefinitionFormat(e,n){return{...n,def:e,prefix:n.alias??"type"}}parseOwnDefinitionFormat(e,n){!(n.alias&&n.alias in this.aliases)&&!n.args&&(n.args={this:n.id});const i=ku(e,n);if(oe(i)){if(i[1]==="=")return b(iu);if(i[1]==="?")return b(ru)}return i}unit=e=>this.units([e]);valueOf=e=>this.units(vd(e));enumerated=(...e)=>this.units(e);instanceOf=e=>this.node("proto",{proto:e},{prereduced:!0});or=(...e)=>this.schema(e.map(n=>this.parse(n)));and=(...e)=>e.reduce((n,r)=>n.and(this.parse(r)),this.intrinsic.unknown);merge=(...e)=>e.reduce((n,r)=>n.merge(this.parse(r)),this.intrinsic.object);pipe=(...e)=>this.intrinsic.unknown.pipe(...e);match=new Qg(this);declare=()=>({type:this.type});define(e){return e}type=new Tb(this);static scope=((e,n={})=>new Wr(e,n));static module=((e,n={})=>this.scope(e,n).export())}const Ib=Object.assign(Wr.scope,{define:t=>t}),R=Wr;class Rb extends Fe{description='merge an object\'s properties onto another like `Merge(User, { isAdmin: "true" })`'}const Ob=rt(["base",S.object],["props",S.object])(t=>t.base.merge(t.props),Rb),Cb=R.module({Key:S.key,Merge:Ob});class Mb extends Fe{}const Db=rt("element")(t=>{const e=t.element.exclude(S.Array),n=e.array();return e.rawOr(n).pipe(Fn).distribute(r=>r.assertHasKind("morph").declareOut(n),q)},Mb),Lb=R.module({root:S.Array,readonly:"root",index:S.nonNegativeIntegerString,liftFrom:Db},{name:"Array"}),ss=q(["string",jn.FileConstructor]),Pb=ss.rawOr(ss.array()),xa=q({meta:"an object representing parsed form data",domain:"object",index:{signature:"string",value:Pb}}),zb=R.module({root:["instanceof",FormData],value:ss,parsed:xa,parse:q({in:FormData,morphs:t=>{const e={};for(const[n,r]of t)if(n in e){const i=e[n];typeof i=="string"||i instanceof jn.FileConstructor?e[n]=[i,r]:i.push(r)}else e[n]=r;return e},declaredOut:xa})},{name:"FormData"}),qb=R.module({Int8:["instanceof",Int8Array],Uint8:["instanceof",Uint8Array],Uint8Clamped:["instanceof",Uint8ClampedArray],Int16:["instanceof",Int16Array],Uint16:["instanceof",Uint16Array],Int32:["instanceof",Int32Array],Uint32:["instanceof",Uint32Array],Float32:["instanceof",Float32Array],Float64:["instanceof",Float64Array],BigInt64:["instanceof",BigInt64Array],BigUint64:["instanceof",BigUint64Array]},{name:"TypedArray"}),Bb={Boolean:1,Number:1,String:1},Kb=R.module({...z({...Kl,...Ul},(t,e)=>t in Bb?[]:[t,["instanceof",e]]),Array:Lb,TypedArray:qb,FormData:zb}),Fb=q({domain:{domain:"number",meta:"a number representing a Unix timestamp"},divisor:{rule:1,meta:"an integer representing a Unix timestamp"},min:{rule:-864e13,meta:"a Unix timestamp after -8640000000000000"},max:{rule:864e13,meta:"a Unix timestamp before 8640000000000000"},meta:"an integer representing a safe Unix timestamp"}),Ub=q({domain:"number",divisor:1}),xu=R.module({root:S.number,integer:Ub,epoch:Fb,safe:q({domain:{domain:"number",numberAllowsNaN:!1},min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER}),NaN:["===",Number.NaN],Infinity:["===",Number.POSITIVE_INFINITY],NegativeInfinity:["===",Number.NEGATIVE_INFINITY]},{name:"number"}),B=(t,e,n)=>{const r={domain:"string",pattern:{rule:t.source,flags:t.flags,meta:e}};return n&&(r.meta={format:n}),Ks("intersection",r)},wa=B(Nr,"a well-formed integer string"),wu=R.module({root:wa,parse:q({in:wa,morphs:(t,e)=>{const n=Number.parseInt(t);return Number.isSafeInteger(n)?n:e.error("an integer in the range Number.MIN_SAFE_INTEGER to Number.MAX_SAFE_INTEGER")},declaredOut:S.integer})},{name:"string.integer"}),jb=B(/^[\dA-Fa-f]+$/,"hex characters only"),Hb=R.module({root:B(/^(?:[\d+/A-Za-z]{4})*(?:[\d+/A-Za-z]{2}==|[\d+/A-Za-z]{3}=)?$/,"base64-encoded"),url:B(/^(?:[\w-]{4})*(?:[\w-]{2}(?:==|%3D%3D)?|[\w-]{3}(?:=|%3D)?)?$/,"base64url-encoded")},{name:"string.base64"}),$a=B(/^[A-Z].*$/,"capitalized"),Vb=R.module({root:q({in:"string",morphs:t=>t.charAt(0).toUpperCase()+t.slice(1),declaredOut:$a}),preformatted:$a},{name:"string.capitalize"}),Jb=t=>{const e=t.replaceAll(/[ -]+/g,"");let n=0,r,i,s=!1;for(let o=e.length-1;o>=0;o--)r=e.substring(o,o+1),i=Number.parseInt(r,10),s?(i*=2,n+=i>=10?i%10+1:i):n+=i,s=!s;return!!(n%10===0&&e)},Gb=/^(?:4\d{12}(?:\d{3,6})?|5[1-5]\d{14}|(222[1-9]|22[3-9]\d|2[3-6]\d{2}|27[01]\d|2720)\d{12}|6(?:011|5\d\d)\d{12,15}|3[47]\d{13}|3(?:0[0-5]|[68]\d)\d{11}|(?:2131|1800|35\d{3})\d{11}|6[27]\d{14}|^(81\d{14,17}))$/,Wb=q({domain:"string",pattern:{meta:"a credit card number",rule:Gb.source},predicate:{meta:"a credit card number",predicate:Jb}}),Zb=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))(T((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([,.]\d+(?!:))?)?(\17[0-5]\d([,.]\d+)?)?([Zz]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,Yb=t=>!Number.isNaN(new Date(t).valueOf()),_a=q({domain:"string",predicate:{meta:"a parsable date",predicate:Yb}}).assertHasKind("intersection"),Aa=wu.root.internal.narrow((t,e)=>{const n=Number.parseInt(t),r=xu.epoch(n);return r instanceof et?(e.errors.merge(r),!1):!0}).configure({description:"an integer string representing a safe Unix timestamp"},"self").assertHasKind("intersection"),Xb=R.module({root:Aa,parse:q({in:Aa,morphs:t=>new Date(t),declaredOut:S.Date})},{name:"string.date.epoch"}),Sa=B(Zb,"an ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ) date").internal.assertHasKind("intersection"),Qb=R.module({root:Sa,parse:q({in:Sa,morphs:t=>new Date(t),declaredOut:S.Date})},{name:"string.date.iso"}),ey=R.module({root:_a,parse:q({declaredIn:_a,in:"string",morphs:(t,e)=>{const n=new Date(t);return Number.isNaN(n.valueOf())?e.error("a parsable date"):n},declaredOut:S.Date}),iso:Qb,epoch:Xb},{name:"string.date"}),ty=B(/^[\w%+.-]+@[\d.A-Za-z-]+\.[A-Za-z]{2,}$/,"an email address","email"),Ea="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",st=`(${Ea}[.]){3}${Ea}`,ny=new RegExp(`^${st}$`),V="(?:[0-9a-fA-F]{1,4})",ry=new RegExp(`^((?:${V}:){7}(?:${V}|:)|(?:${V}:){6}(?:${st}|:${V}|:)|(?:${V}:){5}(?::${st}|(:${V}){1,2}|:)|(?:${V}:){4}(?:(:${V}){0,1}:${st}|(:${V}){1,3}|:)|(?:${V}:){3}(?:(:${V}){0,2}:${st}|(:${V}){1,4}|:)|(?:${V}:){2}(?:(:${V}){0,3}:${st}|(:${V}){1,5}|:)|(?:${V}:){1}(?:(:${V}){0,4}:${st}|(:${V}){1,6}|:)|(?::((?::${V}){0,5}:${st}|(?::${V}){1,7}|:)))(%[0-9a-zA-Z.]{1,})?$`),iy=R.module({root:["v4 | v6","@","an IP address"],v4:B(ny,"an IPv4 address","ipv4"),v6:B(ry,"an IPv6 address","ipv6")},{name:"string.ip"}),Jt="a JSON string",$u=t=>{if(!(t instanceof SyntaxError))throw t;return`must be ${Jt} (${t})`},sy=q({meta:Jt,domain:"string",predicate:{meta:Jt,predicate:(t,e)=>{try{return JSON.parse(t),!0}catch(n){return e.reject({code:"predicate",expected:Jt,problem:$u(n)})}}}}),oy=(t,e)=>{if(t.length===0)return e.error({code:"predicate",expected:Jt,actual:"empty"});try{return JSON.parse(t)}catch(n){return e.error({code:"predicate",expected:Jt,problem:$u(n)})}},ay=R.module({root:sy,parse:q({meta:"safe JSON string parser",in:"string",morphs:oy,declaredOut:S.jsonObject})},{name:"string.json"}),Na=B(/^[a-z]*$/,"only lowercase letters"),ly=R.module({root:q({in:"string",morphs:t=>t.toLowerCase(),declaredOut:Na}),preformatted:Na},{name:"string.lower"}),_u=["NFC","NFD","NFKC","NFKD"],Yn=z(_u,(t,e)=>[e,q({domain:"string",predicate:n=>n.normalize(e)===n,meta:`${e}-normalized unicode`})]),Zr=z(_u,(t,e)=>[e,q({in:"string",morphs:n=>n.normalize(e),declaredOut:Yn[e]})]),cy=R.module({root:Zr.NFC,preformatted:Yn.NFC},{name:"string.normalize.NFC"}),uy=R.module({root:Zr.NFD,preformatted:Yn.NFD},{name:"string.normalize.NFD"}),hy=R.module({root:Zr.NFKC,preformatted:Yn.NFKC},{name:"string.normalize.NFKC"}),fy=R.module({root:Zr.NFKD,preformatted:Yn.NFKD},{name:"string.normalize.NFKD"}),dy=R.module({root:"NFC",NFC:cy,NFD:uy,NFKC:hy,NFKD:fy},{name:"string.normalize"}),Ta=B(Ui,"a well-formed numeric string"),py=R.module({root:Ta,parse:q({in:Ta,morphs:t=>Number.parseFloat(t),declaredOut:S.number})},{name:"string.numeric"}),Ia="a regex pattern",my=q({domain:"string",predicate:{meta:Ia,predicate:(t,e)=>{try{return new RegExp(t),!0}catch(n){return e.reject({code:"predicate",expected:Ia,problem:String(n)})}}},meta:{format:"regex"}}),gy=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*)(?:\.(?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*))*))?(?:\+([\dA-Za-z-]+(?:\.[\dA-Za-z-]+)*))?$/,by=B(gy,"a semantic version (see https://semver.org/)"),Ra=B(/^\S.*\S$|^\S?$/,"trimmed"),yy=R.module({root:q({in:"string",morphs:t=>t.trim(),declaredOut:Ra}),preformatted:Ra},{name:"string.trim"}),Oa=B(/^[A-Z]*$/,"only uppercase letters"),vy=R.module({root:q({in:"string",morphs:t=>t.toUpperCase(),declaredOut:Oa}),preformatted:Oa},{name:"string.upper"}),ky=t=>{if(URL.canParse)return URL.canParse(t);try{return new URL(t),!0}catch{return!1}},Ca=q({domain:"string",predicate:{meta:"a URL string",predicate:ky},meta:{format:"uri"}}),xy=R.module({root:Ca,parse:q({declaredIn:Ca,in:"string",morphs:(t,e)=>{try{return new URL(t)}catch{return e.error("a URL string")}},declaredOut:q(URL)})},{name:"string.url"}),wy=R.module({root:["versioned | nil | max","@",{description:"a UUID",format:"uuid"}],"#nil":"'00000000-0000-0000-0000-000000000000'","#max":"'ffffffff-ffff-ffff-ffff-ffffffffffff'","#versioned":/[\da-f]{8}-[\da-f]{4}-[1-8][\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}/i,v1:B(/^[\da-f]{8}-[\da-f]{4}-1[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv1"),v2:B(/^[\da-f]{8}-[\da-f]{4}-2[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv2"),v3:B(/^[\da-f]{8}-[\da-f]{4}-3[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv3"),v4:B(/^[\da-f]{8}-[\da-f]{4}-4[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv4"),v5:B(/^[\da-f]{8}-[\da-f]{4}-5[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv5"),v6:B(/^[\da-f]{8}-[\da-f]{4}-6[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv6"),v7:B(/^[\da-f]{8}-[\da-f]{4}-7[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv7"),v8:B(/^[\da-f]{8}-[\da-f]{4}-8[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv8")},{name:"string.uuid"}),$y=R.module({root:S.string,alpha:B(/^[A-Za-z]*$/,"only letters"),alphanumeric:B(/^[\dA-Za-z]*$/,"only letters and digits 0-9"),hex:jb,base64:Hb,capitalize:Vb,creditCard:Wb,date:ey,digits:B(/^\d*$/,"only digits 0-9"),email:ty,integer:wu,ip:iy,json:ay,lower:ly,normalize:dy,numeric:py,regex:my,semver:by,trim:yy,upper:vy,url:xy,uuid:wy},{name:"string"}),_y=R.module({bigint:S.bigint,boolean:S.boolean,false:S.false,never:S.never,null:S.null,number:S.number,object:S.object,string:S.string,symbol:S.symbol,true:S.true,unknown:S.unknown,undefined:S.undefined}),Ay=R.module({root:S.unknown,any:S.unknown},{name:"unknown"}),Sy=R.module({root:S.jsonObject,stringify:Ks("morph",{in:S.jsonObject,morphs:t=>JSON.stringify(t),declaredOut:S.string})},{name:"object.json"}),Ey=R.module({root:S.object,json:Sy},{name:"object"});class Ny extends Fe{description='instantiate an object from an index signature and corresponding value type like `Record("string", "number")`'}const Ty=rt(["K",S.key],"V")(t=>({domain:"object",index:{signature:t.K,value:t.V}}),Ny);class Iy extends Fe{description='pick a set of properties from an object like `Pick(User, "name | age")`'}const Ry=rt(["T",S.object],["K",S.key])(t=>t.T.pick(t.K),Iy);class Oy extends Fe{description='omit a set of properties from an object like `Omit(User, "age")`'}const Cy=rt(["T",S.object],["K",S.key])(t=>t.T.omit(t.K),Oy);class My extends Fe{description="make all named properties of an object optional like `Partial(User)`"}const Dy=rt(["T",S.object])(t=>t.T.partial(),My);class Ly extends Fe{description="make all named properties of an object required like `Required(User)`"}const Py=rt(["T",S.object])(t=>t.T.required(),Ly);class zy extends Fe{description='exclude branches of a union like `Exclude("boolean", "true")`'}const qy=rt("T","U")(t=>t.T.exclude(t.U),zy);class By extends Fe{description='extract branches of a union like `Extract("0 | false | 1", "number")`'}const Ky=rt("T","U")(t=>t.T.extract(t.U),By),Fy=R.module({Exclude:qy,Extract:Ky,Omit:Cy,Partial:Dy,Pick:Ry,Record:Ty,Required:Py}),Rt=Ib({..._y,...Fy,...Kb,...Cb,string:$y,number:xu,object:Ey,unknown:Ay},{prereducedAliases:!0,name:"ark"}),te=Rt.export();Object.assign(Dn.ambient,te);Dn.typeAttachments={string:te.string.root,number:te.number.root,bigint:te.bigint,boolean:te.boolean,symbol:te.symbol,undefined:te.undefined,null:te.null,object:te.object.root,unknown:te.unknown.root,false:te.false,true:te.true,never:te.never,arrayIndex:te.Array.index,Key:te.Key,Record:te.Record,Array:te.Array.root,Date:te.Date};const Au=Object.assign(Rt.type,Dn.typeAttachments);Rt.match;Rt.generic;Rt.schema;Rt.define;Rt.declare;async function Uy(){const t=new URL("./index.json",Ll),n=await(await fetch(t)).json(),r=Jy(n);if(r instanceof et)throw r.toTraversalError();return r}async function jy(t,e){const n=`./${t.filename}`,r=new URL(n,Ll),o=(await(await fetch(r)).bytes()).map(f=>f^e),l=new TextDecoder("utf-8").decode(o),c=await D.parse(l);return id.sanitize(c)}function Hy(t){function e(i){let s=(1+Math.sqrt(5))/2,o=Math.pow(s,i)/Math.sqrt(5);return Math.round(o)}const n=new Array(t.length);for(let i=0;i<t.length;i++){const s=t.codePointAt(i);if(s===void 0)throw new Error(`No char at position ${i} in encryption key`);n[i]=s*e(i)}let r=836610;for(let i=0;i<n.length;i++)r+=n[i];return r=r%256,r}const Vy=Au({type:"'major'",filename:"string"}),Jy=Au({timestamp:"number",keytest:"number[]",reports:Vy.array()});function Gy(t,e,n,r,i,s){t.key=="Enter"&&(e()?n.passwordSuccess(J(r)):(i(),s()))}function Wy(t,e,n,r,i,s){e()?n.passwordSuccess(J(r)):(i(),s())}var Zy=Bn('<main class="svelte-1e273kg"><h1 class="svelte-1e273kg"> </h1> <input type="password" name="password" class="svelte-1e273kg"/> <button class="svelte-1e273kg">Enter</button></main>');function Yy(t,e){Pn(e,!0);let n=Ae(""),r=dh(()=>Hy(J(n))),i=Ae("Hello!");function s(){return e.keytest.map(p=>p^J(r)).map(p=>String.fromCodePoint(p)).join("")==="sunshine"}function o(){ve(n,"")}function a(){ve(i,"Nuh uh, try again"),setTimeout(()=>{ve(i,"Hello!")},2e3)}var l=Zy(),c=Ci(l),u=Ci(c),f=Mi(c,2);f.__keydown=[Gy,s,e,r,a,o];var d=Mi(f,2);d.__click=[Wy,s,e,r,a,o],nl(()=>{qh(u,J(i)),Zh(f,"placeholder",sd)}),Xh(f,()=>J(n),m=>ve(n,m)),qe(t,l),zn()}Ph(["keydown","click"]);var Xy=Bn('<div class="text svelte-z7z7xr"><!></div>'),Qy=Bn("<h3>fetching content and decrypting...</h3>");function ev(t,e){Pn(e,!0);const n=jy(e.report,e.key);var r=gr(),i=En(r);bl(i,()=>n,s=>{var o=Qy();qe(s,o)},(s,o)=>{var a=Xy(),l=Ci(a);Jh(l,()=>J(o)),qe(s,a)}),qe(t,r),zn()}var tv=Bn('<header class="svelte-i1sesk"><h1>Hi Sophia!</h1></header> <main class="svelte-i1sesk"></main>',1);function nv(t,e){Pn(e,!0),new Date(e.index.timestamp);var n=tv(),r=Mi(En(n),2);Hh(r,21,()=>e.index.reports,Uh,(i,s)=>{ev(i,{get key(){return e.key},get report(){return J(s)}})}),qe(t,n),zn()}var rv=Bn("<h1>I broke something my bad</h1>");function iv(t,e){Pn(e,!0);let n=Ae("lock"),r=Ae(0);function i(a){ve(r,a,!0),ve(n,"viewer")}var s=gr(),o=En(s);bl(o,Uy,a=>{var l=zh("loading...");qe(a,l)},(a,l)=>{var c=gr(),u=En(c);{var f=m=>{Yy(m,{passwordSuccess:i,get keytest(){return J(l).keytest}})},d=m=>{var p=gr(),v=En(p);{var _=A=>{nv(A,{get index(){return J(l)},get key(){return J(r)}})},E=A=>{var N=rv();qe(A,N)};So(v,A=>{J(n)==="viewer"?A(_):A(E,!1)},!0)}qe(m,p)};So(u,m=>{J(n)==="lock"?m(f):m(d,!1)})}qe(a,c)}),qe(t,s),zn()}Bh(iv,{target:document.body});
